<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Regular Expressions - CS305 Formal Language Theory</title>
<style>
* { box-sizing: border-box; margin: 0; padding: 0; }
body { font-family: 'Segoe UI', system-ui, -apple-system, sans-serif; background: #0f172a; color: #e2e8f0; }
.slide { display: none; min-height: 100vh; padding: 40px 60px; position: relative; }
.slide.active { display: flex; flex-direction: column; justify-content: center; }
.slide-number { position: absolute; bottom: 20px; right: 40px; color: #64748b; font-size: 14px; }
.nav { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); display: flex; gap: 12px; z-index: 100; }
.nav button { background: #334155; border: 1px solid #475569; color: #e2e8f0; padding: 8px 20px; border-radius: 8px; cursor: pointer; font-size: 14px; transition: all 0.2s; }
.nav button:hover { background: #475569; }
.nav button:disabled { opacity: 0.3; cursor: not-allowed; }
.progress { position: fixed; top: 0; left: 0; height: 3px; background: linear-gradient(90deg, #3b82f6, #8b5cf6); transition: width 0.3s; z-index: 100; }
h1 { font-size: 2.8em; margin-bottom: 20px; background: linear-gradient(135deg, #3b82f6, #8b5cf6); -webkit-background-clip: text; -webkit-text-fill-color: transparent; line-height: 1.2; }
h2 { font-size: 2em; margin-bottom: 16px; color: #93c5fd; }
h3 { font-size: 1.4em; margin-bottom: 12px; color: #a5b4fc; }
p, li { font-size: 1.15em; line-height: 1.7; color: #cbd5e1; margin-bottom: 10px; }
.subtitle { font-size: 1.3em; color: #94a3b8; margin-bottom: 30px; }
.two-col { display: grid; grid-template-columns: 1fr 1fr; gap: 40px; align-items: start; }
.center { text-align: center; }
.mt { margin-top: 20px; }
.diagram { background: #1e293b; border: 1px solid #334155; border-radius: 12px; padding: 24px; font-family: 'SF Mono', 'Fira Code', 'Consolas', monospace; font-size: 1em; line-height: 1.6; white-space: pre; overflow-x: auto; margin: 16px 0; color: #a5f3fc; }
.diagram.small { font-size: 0.85em; }
.key-idea { background: linear-gradient(135deg, rgba(59,130,246,0.15), rgba(139,92,246,0.15)); border-left: 4px solid #3b82f6; border-radius: 0 12px 12px 0; padding: 20px 24px; margin: 16px 0; }
.key-idea h3 { margin-bottom: 8px; }
.warning { background: rgba(245,158,11,0.12); border-left: 4px solid #f59e0b; border-radius: 0 12px 12px 0; padding: 20px 24px; margin: 16px 0; }
.warning h3 { color: #fbbf24; }
.analogy { background: rgba(16,185,129,0.12); border-left: 4px solid #10b981; border-radius: 0 12px 12px 0; padding: 20px 24px; margin: 16px 0; }
.analogy h3 { color: #34d399; }
table { border-collapse: collapse; margin: 16px 0; width: auto; }
th, td { border: 1px solid #475569; padding: 10px 16px; text-align: center; }
th { background: #334155; color: #93c5fd; font-weight: 600; }
td { background: #1e293b; color: #e2e8f0; }
tr.highlight td { background: rgba(59,130,246,0.2); }
.fade-in { animation: fadeIn 0.5s ease-in; }
@keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
.step { opacity: 0.25; transition: opacity 0.4s; margin: 8px 0; padding: 8px 12px; border-radius: 8px; }
.step.revealed { opacity: 1; background: rgba(59,130,246,0.08); }
ul { padding-left: 24px; }
ul li { margin-bottom: 8px; }

/* RE Parse Tree Explorer */
.re-tree-container { background: #1e293b; border: 1px solid #334155; border-radius: 12px; padding: 24px; margin: 16px 0; min-height: 280px; display: flex; flex-direction: column; align-items: center; }
.re-tree-btns { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; justify-content: center; }
.re-tree-btn { background: #334155; border: 1px solid #475569; color: #e2e8f0; padding: 8px 16px; border-radius: 8px; cursor: pointer; font-size: 0.95em; font-family: 'SF Mono', 'Fira Code', monospace; transition: all 0.2s; }
.re-tree-btn:hover { background: #475569; }
.re-tree-btn.active { background: rgba(59,130,246,0.3); border-color: #3b82f6; color: #93c5fd; }
.re-tree-area { display: flex; flex-direction: column; align-items: center; gap: 0; width: 100%; }
.re-tree-level { display: flex; justify-content: center; gap: 20px; margin: 0; }
.re-tree-node { background: #1e293b; border: 2px solid #3b82f6; border-radius: 8px; padding: 6px 14px; color: #93c5fd; font-family: 'SF Mono', 'Fira Code', monospace; display: inline-block; font-size: 0.95em; opacity: 0; transform: scale(0.7); transition: opacity 0.4s, transform 0.4s; }
.re-tree-node.visible { opacity: 1; transform: scale(1); }
.re-tree-node.op { border-color: #8b5cf6; color: #a5b4fc; }
.re-tree-node.leaf { border-color: #10b981; color: #34d399; }
.re-tree-lines { display: flex; justify-content: center; gap: 0; margin: 4px 0; }
.re-tree-line { width: 2px; height: 20px; background: #475569; opacity: 0; transition: opacity 0.4s; }
.re-tree-line.visible { opacity: 1; }
.re-tree-connector { display: flex; align-items: center; justify-content: center; height: 20px; position: relative; opacity: 0; transition: opacity 0.4s; }
.re-tree-connector.visible { opacity: 1; }
.re-tree-connector svg { overflow: visible; }
.re-tree-lang { color: #f59e0b; font-size: 1.05em; margin-top: 16px; opacity: 0; transition: opacity 0.5s; }
.re-tree-lang.visible { opacity: 1; }

/* Thompson Visualizer */
.re-thompson-container { background: #1e293b; border: 1px solid #334155; border-radius: 12px; padding: 20px; margin: 12px 0; }
.re-viz-controls { display: flex; gap: 10px; align-items: center; margin-bottom: 12px; flex-wrap: wrap; }
.re-viz-btn { background: #334155; border: 1px solid #475569; color: #e2e8f0; padding: 6px 16px; border-radius: 8px; cursor: pointer; font-size: 0.9em; transition: all 0.2s; }
.re-viz-btn:hover { background: #475569; }
.re-viz-btn:disabled { opacity: 0.3; cursor: not-allowed; }
.re-viz-btn.active { background: rgba(59,130,246,0.3); border-color: #3b82f6; }
.re-viz-step-label { color: #94a3b8; font-size: 0.9em; margin-left: auto; }
.re-viz-svg { width: 100%; border: 1px solid #334155; border-radius: 8px; background: #0f172a; margin-bottom: 12px; }
.re-viz-log { background: #0f172a; border: 1px solid #334155; border-radius: 8px; padding: 12px; max-height: 120px; overflow-y: auto; font-family: 'SF Mono', monospace; font-size: 0.85em; line-height: 1.8; }
.re-viz-log-item { color: #64748b; padding: 2px 0; }
.re-viz-log-item.done { color: #34d399; }
.re-viz-log-item.current { color: #f59e0b; font-weight: 600; }

/* State Elimination Visualizer */
.re-se-container { background: #1e293b; border: 1px solid #334155; border-radius: 12px; padding: 20px; margin: 12px 0; }

/* Quiz */
.re-quiz-container { background: #1e293b; border: 1px solid #334155; border-radius: 12px; padding: 30px; margin: 16px 0; text-align: center; }
.re-quiz-question { font-size: 1.3em; color: #e2e8f0; margin-bottom: 24px; line-height: 1.6; }
.re-quiz-options { display: flex; gap: 16px; justify-content: center; flex-wrap: wrap; }
.re-quiz-btn { background: #334155; border: 2px solid #475569; color: #e2e8f0; padding: 12px 28px; border-radius: 10px; cursor: pointer; font-size: 1.05em; transition: all 0.3s; min-width: 160px; }
.re-quiz-btn:hover { background: #475569; border-color: #64748b; }
.re-quiz-btn.correct { background: rgba(16,185,129,0.3); border-color: #10b981; color: #34d399; cursor: default; }
.re-quiz-btn.wrong { background: rgba(239,68,68,0.3); border-color: #ef4444; color: #f87171; cursor: default; }
.re-quiz-btn:disabled { cursor: default; }
.re-quiz-explanation { margin-top: 16px; font-size: 1em; color: #94a3b8; opacity: 0; transition: opacity 0.4s; }
.re-quiz-explanation.visible { opacity: 1; }
.re-quiz-score { font-size: 1.6em; color: #93c5fd; margin-top: 20px; }
.re-quiz-progress { color: #64748b; font-size: 0.9em; margin-bottom: 16px; }

/* Slide 4: Operation SVGs */
.re-op-svg { width: 100%; max-width: 300px; margin: 8px 0; }

/* Slide 5: Formal Definition Explorer */
.re-fd-container { background: #1e293b; border: 1px solid #334155; border-radius: 12px; padding: 24px; margin: 16px 0; }
.re-fd-btns { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; justify-content: center; }
.re-fd-btn { background: #334155; border: 1px solid #475569; color: #e2e8f0; padding: 8px 18px; border-radius: 8px; cursor: pointer; font-size: 1em; font-family: 'SF Mono', 'Fira Code', monospace; transition: all 0.2s; }
.re-fd-btn:hover { background: #475569; }
.re-fd-btn.active { background: rgba(59,130,246,0.3); border-color: #3b82f6; color: #93c5fd; }
.re-fd-result { margin-top: 16px; }
.re-fd-result h4 { color: #93c5fd; font-size: 1.1em; margin-bottom: 4px; }
.re-fd-result p { color: #94a3b8; margin-bottom: 6px; }
.re-fd-strings { display: flex; gap: 8px; flex-wrap: wrap; margin: 12px 0; }
.re-fd-chip { background: rgba(16,185,129,0.2); border: 1px solid #10b981; border-radius: 16px; padding: 4px 12px; color: #34d399; font-family: monospace; font-size: 0.9em; }
.re-fd-test { display: flex; gap: 10px; align-items: center; margin-top: 12px; }
.re-fd-input { background: #0f172a; border: 1px solid #475569; color: #e2e8f0; padding: 6px 12px; border-radius: 6px; font-family: monospace; font-size: 1em; width: 160px; }
.re-fd-check-btn { background: #334155; border: 1px solid #475569; color: #e2e8f0; padding: 6px 16px; border-radius: 6px; cursor: pointer; font-size: 0.95em; transition: all 0.2s; }
.re-fd-check-btn:hover { background: #475569; }
.re-fd-verdict { font-size: 1em; font-weight: 600; }
.re-fd-verdict.accept { color: #34d399; }
.re-fd-verdict.reject { color: #f87171; }

/* Slide 6: Precedence Playground */
.re-prec-container { background: #1e293b; border: 1px solid #334155; border-radius: 12px; padding: 24px; margin: 16px 0; }
.re-prec-btns { display: flex; gap: 10px; margin: 16px 0; justify-content: center; }
.re-prec-btn { background: #334155; border: 1px solid #475569; color: #e2e8f0; padding: 8px 18px; border-radius: 8px; cursor: pointer; font-size: 1em; font-family: 'SF Mono', 'Fira Code', monospace; transition: all 0.2s; }
.re-prec-btn:hover { background: #475569; }
.re-prec-btn.active { background: rgba(59,130,246,0.3); border-color: #3b82f6; color: #93c5fd; }
.re-prec-comparison { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
.re-prec-panel { background: #0f172a; border-radius: 10px; padding: 16px; border: 2px solid #334155; }
.re-prec-panel.correct { border-color: #10b981; }
.re-prec-panel.wrong { border-color: #ef4444; }
.re-prec-panel h4 { font-size: 1.05em; margin-bottom: 8px; }
.re-prec-panel.correct h4 { color: #34d399; }
.re-prec-panel.wrong h4 { color: #f87171; }
.re-prec-parse { color: #94a3b8; font-family: monospace; margin: 8px 0; font-size: 0.95em; }
.re-prec-lang { display: flex; gap: 6px; flex-wrap: wrap; margin: 8px 0; }
.re-prec-lang .re-fd-chip { font-size: 0.85em; }
.re-prec-panel.correct .re-fd-chip { background: rgba(16,185,129,0.2); border-color: #10b981; color: #34d399; }
.re-prec-panel.wrong .re-fd-chip { background: rgba(239,68,68,0.15); border-color: #ef4444; color: #f87171; }
</style>
</head>
<body>

<div class="progress" id="progress"></div>

<!-- ===================== SLIDE 1: TITLE ===================== -->
<div class="slide" id="s1">
  <div class="center">
    <h1>Regular Expressions</h1>
    <p class="subtitle">CS305 -- Formal Language Theory</p>
    <div class="diagram" style="display:inline-block; text-align:left; font-size:0.9em;">
    "The algebraic notation for regular languages"

         ____  _____
        |  _ \| ____|
        | |_) |  _|
        |  _ &lt;| |___
        |_| \_\_____|

    Pattern  -->  Language  -->  Machine
    </div>
    <p class="mt" style="color:#64748b;">Use Arrow Keys or Space to navigate | Press S to reveal steps</p>
  </div>
  <div class="slide-number">1 / 21</div>
</div>

<!-- ===================== SLIDE 2: BIG PICTURE ===================== -->
<div class="slide" id="s2">
  <h2>The Big Picture: Three Equivalent Views</h2>
  <p>Regular Expressions, DFAs, and NFAs all describe the <strong>exact same class</strong> of languages: the <strong>regular languages</strong>.</p>
  <div class="diagram">
                    Regular Expressions (RE)
                          /         \
                         /           \
                   convert            convert
                   to NFA             from DFA
                       /               \
                      v                 v
                   NFA  &lt;----------&gt;  DFA
                      subset construction
                      &amp; vice versa

   +-----------+     +-----------+     +-----------+
   |           |     |           |     |           |
   |    RE     | === |    NFA    | === |    DFA    |
   |           |     |           |     |           |
   +-----------+     +-----------+     +-----------+
        All three recognize EXACTLY the regular languages
  </div>
  <div class="key-idea">
    <h3>Key Idea</h3>
    <p>Any language you can describe with an RE, you can build a DFA for -- and vice versa. They are <strong>equally powerful</strong>. The proofs go around the triangle: RE --> NFA --> DFA --> RE.</p>
  </div>
  <div class="slide-number">2 / 21</div>
</div>

<!-- ===================== SLIDE 3: WHAT IS A RE ===================== -->
<div class="slide" id="s3">
  <h2>What Is a Regular Expression?</h2>
  <div class="two-col">
    <div>
      <p>A <strong>regular expression</strong> is a compact, algebraic notation for describing a <strong>set of strings</strong> (i.e., a language).</p>
      <ul class="mt">
        <li>Every RE defines a language L(R)</li>
        <li>Built from a small set of operations</li>
        <li>No memory, no counting -- just patterns</li>
        <li>Equivalent in power to finite automata</li>
      </ul>
      <div class="analogy mt">
        <h3>Analogy</h3>
        <p><strong>Regex is to languages what arithmetic is to numbers.</strong> Just as 3 + 5 x 2 is a compact way to describe the number 13, the expression <code>(0|1)*01</code> is a compact way to describe "all binary strings ending in 01."</p>
      </div>
    </div>
    <div>
      <h3>Quick Examples</h3>
      <table>
        <tr><th>RE</th><th>Language</th></tr>
        <tr><td><code>0</code></td><td>{ "0" }</td></tr>
        <tr><td><code>0|1</code></td><td>{ "0", "1" }</td></tr>
        <tr><td><code>01</code></td><td>{ "01" }</td></tr>
        <tr><td><code>0*</code></td><td>{ "", "0", "00", "000", ... }</td></tr>
        <tr><td><code>(0|1)*</code></td><td>All binary strings</td></tr>
        <tr class="highlight"><td><code>(0|1)*01</code></td><td>Binary strings ending in 01</td></tr>
      </table>
    </div>
  </div>
  <div class="slide-number">3 / 21</div>
</div>

<!-- ===================== SLIDE 4: THREE BASIC OPS ===================== -->
<div class="slide" id="s4">
  <h2>The Three Basic Operations</h2>
  <p>Every regular expression is built from just <strong>three operations</strong>:</p>
  <div class="two-col mt">
    <div>
      <div class="step">
        <h3>1. Union (|)</h3>
        <p>R1 | R2 = "either R1 or R2"</p>
        <svg class="re-op-svg" viewBox="0 0 300 120">
          <defs>
            <marker id="re-op-arr1" viewBox="0 0 10 7" refX="10" refY="3.5" markerWidth="8" markerHeight="6" orient="auto"><polygon points="0 0, 10 3.5, 0 7" fill="#475569"/></marker>
          </defs>
          <!-- Start dot -->
          <circle cx="20" cy="60" r="6" fill="#93c5fd"/>
          <!-- Branch up to R1 -->
          <path d="M 26,60 Q 50,30 75,30" fill="none" stroke="#475569" stroke-width="2" marker-end="url(#re-op-arr1)"/>
          <!-- R1 box -->
          <rect x="80" y="10" width="80" height="40" rx="8" fill="rgba(59,130,246,0.1)" stroke="#3b82f6" stroke-width="2" stroke-dasharray="5 3"/>
          <text x="120" y="35" fill="#93c5fd" text-anchor="middle" font-size="14" font-family="system-ui">R1</text>
          <!-- R1 to end -->
          <path d="M 160,30 Q 200,30 220,60" fill="none" stroke="#475569" stroke-width="2" marker-end="url(#re-op-arr1)"/>
          <!-- Branch down to R2 -->
          <path d="M 26,60 Q 50,90 75,90" fill="none" stroke="#475569" stroke-width="2" marker-end="url(#re-op-arr1)"/>
          <!-- R2 box -->
          <rect x="80" y="70" width="80" height="40" rx="8" fill="rgba(59,130,246,0.1)" stroke="#3b82f6" stroke-width="2" stroke-dasharray="5 3"/>
          <text x="120" y="95" fill="#93c5fd" text-anchor="middle" font-size="14" font-family="system-ui">R2</text>
          <!-- R2 to end -->
          <path d="M 160,90 Q 200,90 220,60" fill="none" stroke="#475569" stroke-width="2" marker-end="url(#re-op-arr1)"/>
          <!-- End dot -->
          <circle cx="230" cy="60" r="6" fill="#93c5fd"/>
          <circle cx="230" cy="60" r="9" fill="none" stroke="#93c5fd" stroke-width="1.5"/>
          <!-- Labels -->
          <text x="50" y="20" fill="#f59e0b" font-size="11" font-family="system-ui">or</text>
        </svg>
        <p>L(R1 | R2) = L(R1) &cup; L(R2)</p>
        <p style="color:#94a3b8; font-size:0.95em;">Example: 0 | 1 = { "0", "1" }</p>
      </div>
      <div class="step">
        <h3>2. Concatenation (.)</h3>
        <p>R1 R2 = "R1 followed by R2"</p>
        <svg class="re-op-svg" viewBox="0 0 300 80">
          <defs>
            <marker id="re-op-arr2" viewBox="0 0 10 7" refX="10" refY="3.5" markerWidth="8" markerHeight="6" orient="auto"><polygon points="0 0, 10 3.5, 0 7" fill="#475569"/></marker>
          </defs>
          <!-- Start arrow -->
          <line x1="10" y1="40" x2="38" y2="40" stroke="#475569" stroke-width="2" marker-end="url(#re-op-arr2)"/>
          <!-- R1 box -->
          <rect x="42" y="15" width="80" height="50" rx="8" fill="rgba(59,130,246,0.1)" stroke="#3b82f6" stroke-width="2" stroke-dasharray="5 3"/>
          <text x="82" y="45" fill="#93c5fd" text-anchor="middle" font-size="14" font-family="system-ui">R1</text>
          <!-- Arrow between -->
          <line x1="122" y1="40" x2="158" y2="40" stroke="#475569" stroke-width="2" marker-end="url(#re-op-arr2)"/>
          <!-- R2 box -->
          <rect x="162" y="15" width="80" height="50" rx="8" fill="rgba(59,130,246,0.1)" stroke="#3b82f6" stroke-width="2" stroke-dasharray="5 3"/>
          <text x="202" y="45" fill="#93c5fd" text-anchor="middle" font-size="14" font-family="system-ui">R2</text>
          <!-- End arrow -->
          <line x1="242" y1="40" x2="280" y2="40" stroke="#475569" stroke-width="2" marker-end="url(#re-op-arr2)"/>
          <!-- End dot -->
          <circle cx="284" cy="40" r="5" fill="#93c5fd"/>
          <circle cx="284" cy="40" r="8" fill="none" stroke="#93c5fd" stroke-width="1.5"/>
        </svg>
        <p>L(R1 . R2) = { xy : x &in; L(R1), y &in; L(R2) }</p>
        <p style="color:#94a3b8; font-size:0.95em;">Example: 0 . 1 = { "01" }</p>
      </div>
    </div>
    <div>
      <div class="step">
        <h3>3. Kleene Star (*)</h3>
        <p>R* = "zero or more copies of R"</p>
        <svg class="re-op-svg" viewBox="0 0 300 120">
          <defs>
            <marker id="re-op-arr3" viewBox="0 0 10 7" refX="10" refY="3.5" markerWidth="8" markerHeight="6" orient="auto"><polygon points="0 0, 10 3.5, 0 7" fill="#475569"/></marker>
            <marker id="re-op-arr3b" viewBox="0 0 10 7" refX="10" refY="3.5" markerWidth="8" markerHeight="6" orient="auto"><polygon points="0 0, 10 3.5, 0 7" fill="#f59e0b"/></marker>
          </defs>
          <!-- Start arrow -->
          <line x1="10" y1="60" x2="58" y2="60" stroke="#475569" stroke-width="2" marker-end="url(#re-op-arr3)"/>
          <!-- R box -->
          <rect x="62" y="35" width="100" height="50" rx="8" fill="rgba(59,130,246,0.1)" stroke="#3b82f6" stroke-width="2" stroke-dasharray="5 3"/>
          <text x="112" y="65" fill="#93c5fd" text-anchor="middle" font-size="14" font-family="system-ui">R</text>
          <!-- End arrow -->
          <line x1="162" y1="60" x2="210" y2="60" stroke="#475569" stroke-width="2" marker-end="url(#re-op-arr3)"/>
          <!-- End dot -->
          <circle cx="218" cy="60" r="5" fill="#93c5fd"/>
          <circle cx="218" cy="60" r="8" fill="none" stroke="#93c5fd" stroke-width="1.5"/>
          <!-- Loop-back arrow on top -->
          <path d="M 155,35 Q 155,8 112,8 Q 69,8 69,35" fill="none" stroke="#f59e0b" stroke-width="2" marker-end="url(#re-op-arr3b)"/>
          <text x="112" y="6" fill="#f59e0b" font-size="11" text-anchor="middle" font-family="system-ui">repeat</text>
          <!-- Bypass arrow below -->
          <path d="M 50,75 Q 50,105 112,105 Q 175,105 210,75" fill="none" stroke="#f59e0b" stroke-width="2" stroke-dasharray="5 3" marker-end="url(#re-op-arr3b)"/>
          <text x="112" y="118" fill="#f59e0b" font-size="11" text-anchor="middle" font-family="system-ui">bypass (&epsilon;)</text>
        </svg>
        <p>L(R*) = { &epsilon;, w, ww, www, ... : w &in; L(R) }</p>
        <p style="color:#94a3b8; font-size:0.95em;">Example: 0* = { "", "0", "00", "000", ... }</p>
      </div>
      <div class="key-idea">
        <h3>That's It!</h3>
        <p>Union, Concatenation, and Kleene Star -- these three operations are <strong>all you need</strong> to build every regular expression. They are like LEGO bricks: simple pieces, infinite combinations.</p>
      </div>
    </div>
  </div>
  <div class="slide-number">4 / 21</div>
</div>

<!-- ===================== SLIDE 5: FORMAL DEFINITION ===================== -->
<div class="slide" id="s5">
  <h2>Formal Definition (Recursive)</h2>
  <p>A regular expression over alphabet &Sigma; is defined <strong>inductively</strong>. Click an RE below to explore its definition:</p>
  <div class="re-fd-container">
    <div class="re-fd-btns">
      <button class="re-fd-btn" onclick="re_fdSelect(0)">&empty;</button>
      <button class="re-fd-btn" onclick="re_fdSelect(1)">&epsilon;</button>
      <button class="re-fd-btn" onclick="re_fdSelect(2)">a</button>
      <button class="re-fd-btn" onclick="re_fdSelect(3)">0|1</button>
      <button class="re-fd-btn" onclick="re_fdSelect(4)">01</button>
      <button class="re-fd-btn" onclick="re_fdSelect(5)">0*</button>
    </div>
    <div id="re_fdResult" class="re-fd-result" style="text-align:center; color:#64748b;">
      <p>Select a regular expression above to see its formal definition and language.</p>
    </div>
  </div>
  <div class="warning mt">
    <h3>Watch Out: &empty; vs &epsilon;</h3>
    <p><strong>&empty;</strong> matches <em>nothing at all</em> (the empty language -- no strings). <strong>&epsilon;</strong> matches <em>one thing</em>: the empty string "". They are NOT the same!</p>
    <p>&bull; L(&empty;) = { } &nbsp;&nbsp;(0 elements) &nbsp;&nbsp;&nbsp; &bull; L(&epsilon;) = { "" } &nbsp;&nbsp;(1 element)</p>
  </div>
  <div class="slide-number">5 / 21</div>
</div>

<!-- ===================== SLIDE 6: OPERATOR PRECEDENCE ===================== -->
<div class="slide" id="s6">
  <h2>Operator Precedence</h2>
  <p>Just like arithmetic has PEMDAS, regular expressions have a precedence order:</p>
  <div class="diagram" style="font-size: 1.1em;">
   Highest   +-----------+
   priority  |  * Star   |   Bind tightest (like exponents)
             +-----------+
             |  . Concat |   Middle        (like multiplication)
             +-----------+
   Lowest    |  | Union  |   Bind loosest  (like addition)
   priority  +-----------+
  </div>
  <div class="re-prec-container">
    <div class="re-prec-btns">
      <button class="re-prec-btn" onclick="re_precSelect(0)">ab|c</button>
      <button class="re-prec-btn" onclick="re_precSelect(1)">ab*</button>
      <button class="re-prec-btn" onclick="re_precSelect(2)">a|bc*</button>
    </div>
    <div id="re_precResult" class="re-prec-comparison" style="display:none;"></div>
    <p id="re_precHint" style="text-align:center; color:#64748b; margin-top:8px;">Click a regex above to compare correct vs incorrect parsing.</p>
  </div>
  <div class="analogy mt">
    <h3>Analogy: Arithmetic Parallel</h3>
    <table>
      <tr><th>Arithmetic</th><th>Regex</th></tr>
      <tr><td>Exponent (^)</td><td>Star (*)</td></tr>
      <tr><td>Multiply (x)</td><td>Concat (.)</td></tr>
      <tr><td>Add (+)</td><td>Union (|)</td></tr>
    </table>
    <p class="mt" style="font-size:0.95em;">Just as <code>2+3x4 = 14</code> (not 20),<br><code>a|bc = {a, bc}</code> (not {ac, bc}).</p>
  </div>
  <div class="slide-number">6 / 21</div>
</div>

<!-- ===================== SLIDE 7: INTERACTIVE PARSE TREE EXPLORER ===================== -->
<div class="slide" id="s7">
  <h2>Interactive RE Parse Tree Explorer</h2>
  <p>Select a regular expression to see its parse tree build step by step:</p>
  <div class="re-tree-container">
    <div class="re-tree-btns">
      <button class="re-tree-btn" onclick="re_ptSelect(0)">a(a|b)*</button>
      <button class="re-tree-btn" onclick="re_ptSelect(1)">(aa|bb)(a|b)*</button>
      <button class="re-tree-btn" onclick="re_ptSelect(2)">(0|1)*0</button>
      <button class="re-tree-btn" onclick="re_ptSelect(3)">a*b*c*</button>
    </div>
    <div id="re_ptTreeArea" class="re-tree-area"></div>
    <div id="re_ptLang" class="re-tree-lang"></div>
  </div>
  <div class="key-idea">
    <h3>Reading Strategy</h3>
    <p>1. Identify the <strong>outermost operation</strong> (lowest precedence). 2. Break into sub-expressions. 3. Describe each part in English. 4. Combine the descriptions.</p>
  </div>
  <div class="slide-number">7 / 21</div>
</div>

<!-- ===================== SLIDE 8: WRITING REs ===================== -->
<div class="slide" id="s8">
  <h2>Examples: Writing Regular Expressions</h2>
  <p>Given a language description, write the RE:</p>
  <div class="step">
    <div class="two-col">
      <div>
        <h3>Language 1</h3>
        <p>"All binary strings of length exactly 3"</p>
        <div class="diagram small">
Think: 3 symbols, each is 0 or 1

Answer: (0|1)(0|1)(0|1)

Check: 000 ✓  010 ✓  111 ✓
       0 ✗    0011 ✗  ✓!
        </div>
      </div>
      <div>
        <h3>Language 2</h3>
        <p>"All binary strings containing 010"</p>
        <div class="diagram small">
Think: something, then 010, then something

Answer: (0|1)*010(0|1)*

Check: 010 ✓  10101 ✓  111 ✗  ✓!
        </div>
      </div>
    </div>
  </div>
  <div class="step">
    <div class="two-col">
      <div>
        <h3>Language 3</h3>
        <p>"Strings over {a,b} with even length"</p>
        <div class="diagram small">
Think: pairs of symbols, repeated

Answer: ((a|b)(a|b))*

Check: "" ✓  "ab" ✓  "a" ✗
       "abba" ✓  ✓!
        </div>
      </div>
      <div>
        <h3>Language 4</h3>
        <p>"Strings over {0,1} with no consecutive 1s"</p>
        <div class="diagram small">
Think: after each 1, must see 0 or end

Answer: (0|10)*(1|&epsilon;)

Check: "" ✓  "0" ✓  "101" ✓
       "11" ✗  "010" ✓  ✓!
        </div>
      </div>
    </div>
  </div>
  <div class="analogy mt">
    <h3>Writing Strategy</h3>
    <p><strong>Think in building blocks:</strong> (1) What must appear? (2) What can repeat? (3) What are the choices? Combine using concat for "then," union for "or," and star for "repeat."</p>
  </div>
  <div class="slide-number">8 / 21</div>
</div>

<!-- ===================== SLIDE 9: THOMPSON OVERVIEW ===================== -->
<div class="slide" id="s9">
  <h2>RE to &epsilon;-NFA: Thompson's Construction</h2>
  <p>We can systematically convert <strong>any RE into an equivalent NFA</strong> using Thompson's Construction (1968).</p>
  <div class="diagram">
   The Idea: Build the NFA like LEGO
   ====================================

   1. Each sub-expression gets its own small NFA "fragment"

         +-------------------+
    ---->| start       accept|---->
         +-------------------+
              "fragment"

   2. Fragments have EXACTLY:
      - One start state  (no incoming edges from outside)
      - One accept state (no outgoing edges from outside)

   3. Combine fragments using rules for |, ., and *

   4. The structure mirrors the parse tree of the RE!
  </div>
  <div class="analogy">
    <h3>Analogy: LEGO Bricks</h3>
    <p>Think of each base case (symbol, &epsilon;) as a basic LEGO brick. Union, concatenation, and star are <strong>ways to snap bricks together</strong>. You build bottom-up, combining small NFAs into bigger ones, until you have one NFA for the whole RE.</p>
  </div>
  <div class="slide-number">9 / 21</div>
</div>

<!-- ===================== SLIDE 10: THOMPSON BASE CASES ===================== -->
<div class="slide" id="s10">
  <h2>Thompson's Construction: Base Cases</h2>
  <div class="two-col">
    <div>
      <h3>Empty String &epsilon;</h3>
      <svg class="re-viz-svg" viewBox="0 0 240 80" style="max-width:240px; height:80px;">
        <defs>
          <marker id="re-arrow10" viewBox="0 0 10 7" refX="10" refY="3.5" markerWidth="8" markerHeight="6" orient="auto"><polygon points="0 0, 10 3.5, 0 7" fill="#8b5cf6"/></marker>
        </defs>
        <circle cx="50" cy="40" r="20" fill="#1e293b" stroke="#93c5fd" stroke-width="2"/>
        <text x="50" y="45" fill="#93c5fd" text-anchor="middle" font-size="13" font-family="system-ui">q0</text>
        <circle cx="190" cy="40" r="20" fill="#1e293b" stroke="#93c5fd" stroke-width="2"/>
        <circle cx="190" cy="40" r="16" fill="none" stroke="#93c5fd" stroke-width="1.5"/>
        <text x="190" y="45" fill="#93c5fd" text-anchor="middle" font-size="13" font-family="system-ui">q1</text>
        <line x1="70" y1="40" x2="168" y2="40" stroke="#8b5cf6" stroke-width="2" stroke-dasharray="6 4" marker-end="url(#re-arrow10)"/>
        <text x="120" y="32" fill="#f59e0b" text-anchor="middle" font-size="14" font-family="system-ui">&epsilon;</text>
        <text x="50" y="72" fill="#64748b" text-anchor="middle" font-size="11">start</text>
        <text x="190" y="72" fill="#64748b" text-anchor="middle" font-size="11">accept</text>
      </svg>
      <p style="font-size:0.95em; color:#94a3b8;">L = { "" } -- Accepts only the empty string.</p>

      <h3 class="mt">Empty Set &empty;</h3>
      <svg class="re-viz-svg" viewBox="0 0 240 80" style="max-width:240px; height:80px;">
        <circle cx="50" cy="40" r="20" fill="#1e293b" stroke="#93c5fd" stroke-width="2"/>
        <text x="50" y="45" fill="#93c5fd" text-anchor="middle" font-size="13" font-family="system-ui">q0</text>
        <circle cx="190" cy="40" r="20" fill="#1e293b" stroke="#93c5fd" stroke-width="2"/>
        <circle cx="190" cy="40" r="16" fill="none" stroke="#93c5fd" stroke-width="1.5"/>
        <text x="190" y="45" fill="#93c5fd" text-anchor="middle" font-size="13" font-family="system-ui">q1</text>
        <text x="50" y="72" fill="#64748b" text-anchor="middle" font-size="11">start</text>
        <text x="190" y="72" fill="#64748b" text-anchor="middle" font-size="11">accept</text>
      </svg>
      <p style="font-size:0.95em; color:#94a3b8;">No transition! L = { } -- Accepts nothing.</p>
    </div>
    <div>
      <h3>Single Symbol a</h3>
      <svg class="re-viz-svg" viewBox="0 0 240 80" style="max-width:240px; height:80px;">
        <defs>
          <marker id="re-arrow10b" viewBox="0 0 10 7" refX="10" refY="3.5" markerWidth="8" markerHeight="6" orient="auto"><polygon points="0 0, 10 3.5, 0 7" fill="#475569"/></marker>
        </defs>
        <circle cx="50" cy="40" r="20" fill="#1e293b" stroke="#93c5fd" stroke-width="2"/>
        <text x="50" y="45" fill="#93c5fd" text-anchor="middle" font-size="13" font-family="system-ui">q0</text>
        <circle cx="190" cy="40" r="20" fill="#1e293b" stroke="#93c5fd" stroke-width="2"/>
        <circle cx="190" cy="40" r="16" fill="none" stroke="#93c5fd" stroke-width="1.5"/>
        <text x="190" y="45" fill="#93c5fd" text-anchor="middle" font-size="13" font-family="system-ui">q1</text>
        <line x1="70" y1="40" x2="168" y2="40" stroke="#475569" stroke-width="2" marker-end="url(#re-arrow10b)"/>
        <text x="120" y="32" fill="#f59e0b" text-anchor="middle" font-size="14" font-family="system-ui">a</text>
        <text x="50" y="72" fill="#64748b" text-anchor="middle" font-size="11">start</text>
        <text x="190" y="72" fill="#64748b" text-anchor="middle" font-size="11">accept</text>
      </svg>
      <p style="font-size:0.95em; color:#94a3b8;">L = { "a" } -- Accepts only the string "a".</p>

      <div class="key-idea mt">
        <h3>Properties of Every Fragment</h3>
        <ul>
          <li>Exactly <strong>one</strong> start state</li>
          <li>Exactly <strong>one</strong> accept state</li>
          <li>Start state has no incoming edges</li>
          <li>Accept state has no outgoing edges</li>
        </ul>
        <p class="mt">These invariants let us compose fragments cleanly!</p>
      </div>
    </div>
  </div>
  <div class="slide-number">10 / 21</div>
</div>

<!-- ===================== SLIDE 11: THOMPSON UNION ===================== -->
<div class="slide" id="s11">
  <h2>Thompson's Construction: Union (R1 | R2)</h2>
  <p>"Accept if <strong>either</strong> R1 or R2 matches."</p>
  <svg class="re-viz-svg" viewBox="0 0 500 280" style="max-width:600px; margin: 12px auto; display:block;">
    <defs>
      <marker id="re-arrow11" viewBox="0 0 10 7" refX="10" refY="3.5" markerWidth="8" markerHeight="6" orient="auto"><polygon points="0 0, 10 3.5, 0 7" fill="#475569"/></marker>
      <marker id="re-arrow11e" viewBox="0 0 10 7" refX="10" refY="3.5" markerWidth="8" markerHeight="6" orient="auto"><polygon points="0 0, 10 3.5, 0 7" fill="#8b5cf6"/></marker>
    </defs>
    <!-- start state -->
    <circle cx="60" cy="140" r="20" fill="#1e293b" stroke="#93c5fd" stroke-width="2"/>
    <text x="60" y="145" fill="#93c5fd" text-anchor="middle" font-size="12" font-family="system-ui">start</text>
    <!-- NFA(R1) box -->
    <rect x="140" y="40" width="200" height="60" rx="12" fill="rgba(59,130,246,0.1)" stroke="#3b82f6" stroke-width="2" stroke-dasharray="6 4"/>
    <text x="240" y="75" fill="#93c5fd" text-anchor="middle" font-size="14" font-family="system-ui">NFA(R1)</text>
    <circle cx="155" cy="70" r="10" fill="#1e293b" stroke="#93c5fd" stroke-width="1.5"/>
    <text x="155" y="74" fill="#93c5fd" text-anchor="middle" font-size="9">s1</text>
    <circle cx="325" cy="70" r="10" fill="#1e293b" stroke="#93c5fd" stroke-width="1.5"/>
    <text x="325" y="74" fill="#93c5fd" text-anchor="middle" font-size="9">f1</text>
    <!-- NFA(R2) box -->
    <rect x="140" y="180" width="200" height="60" rx="12" fill="rgba(59,130,246,0.1)" stroke="#3b82f6" stroke-width="2" stroke-dasharray="6 4"/>
    <text x="240" y="215" fill="#93c5fd" text-anchor="middle" font-size="14" font-family="system-ui">NFA(R2)</text>
    <circle cx="155" cy="210" r="10" fill="#1e293b" stroke="#93c5fd" stroke-width="1.5"/>
    <text x="155" y="214" fill="#93c5fd" text-anchor="middle" font-size="9">s2</text>
    <circle cx="325" cy="210" r="10" fill="#1e293b" stroke="#93c5fd" stroke-width="1.5"/>
    <text x="325" y="214" fill="#93c5fd" text-anchor="middle" font-size="9">f2</text>
    <!-- accept state -->
    <circle cx="440" cy="140" r="20" fill="#1e293b" stroke="#93c5fd" stroke-width="2"/>
    <circle cx="440" cy="140" r="16" fill="none" stroke="#93c5fd" stroke-width="1.5"/>
    <text x="440" y="145" fill="#93c5fd" text-anchor="middle" font-size="11" font-family="system-ui">accept</text>
    <!-- epsilon arrows: start -> s1, start -> s2 -->
    <path d="M 78,130 Q 110,70 145,70" fill="none" stroke="#8b5cf6" stroke-width="2" stroke-dasharray="6 4" marker-end="url(#re-arrow11e)"/>
    <text x="100" y="88" fill="#f59e0b" font-size="12">&epsilon;</text>
    <path d="M 78,150 Q 110,210 145,210" fill="none" stroke="#8b5cf6" stroke-width="2" stroke-dasharray="6 4" marker-end="url(#re-arrow11e)"/>
    <text x="100" y="200" fill="#f59e0b" font-size="12">&epsilon;</text>
    <!-- epsilon arrows: f1 -> accept, f2 -> accept -->
    <path d="M 335,70 Q 380,70 422,130" fill="none" stroke="#8b5cf6" stroke-width="2" stroke-dasharray="6 4" marker-end="url(#re-arrow11e)"/>
    <text x="385" y="88" fill="#f59e0b" font-size="12">&epsilon;</text>
    <path d="M 335,210 Q 380,210 422,150" fill="none" stroke="#8b5cf6" stroke-width="2" stroke-dasharray="6 4" marker-end="url(#re-arrow11e)"/>
    <text x="385" y="200" fill="#f59e0b" font-size="12">&epsilon;</text>
  </svg>
  <div class="key-idea">
    <h3>Why This Works</h3>
    <p>From the new start, the NFA <strong>nondeterministically guesses</strong> which branch (R1 or R2) will match. If <em>either</em> branch reaches its old accept state, the &epsilon;-transition carries us to the new accept state.</p>
  </div>
  <div class="slide-number">11 / 21</div>
</div>

<!-- ===================== SLIDE 12: THOMPSON CONCAT ===================== -->
<div class="slide" id="s12">
  <h2>Thompson's Construction: Concatenation (R1 R2)</h2>
  <p>"Accept if R1 matches a prefix and R2 matches the rest."</p>
  <svg class="re-viz-svg" viewBox="0 0 500 140" style="max-width:600px; margin: 12px auto; display:block;">
    <defs>
      <marker id="re-arrow12e" viewBox="0 0 10 7" refX="10" refY="3.5" markerWidth="8" markerHeight="6" orient="auto"><polygon points="0 0, 10 3.5, 0 7" fill="#8b5cf6"/></marker>
    </defs>
    <!-- NFA(R1) box -->
    <rect x="20" y="30" width="180" height="70" rx="12" fill="rgba(59,130,246,0.1)" stroke="#3b82f6" stroke-width="2" stroke-dasharray="6 4"/>
    <text x="110" y="70" fill="#93c5fd" text-anchor="middle" font-size="14" font-family="system-ui">NFA(R1)</text>
    <circle cx="40" cy="65" r="10" fill="#1e293b" stroke="#93c5fd" stroke-width="1.5"/>
    <text x="40" y="69" fill="#93c5fd" text-anchor="middle" font-size="9">s1</text>
    <circle cx="185" cy="65" r="10" fill="#1e293b" stroke="#93c5fd" stroke-width="1.5"/>
    <text x="185" y="69" fill="#93c5fd" text-anchor="middle" font-size="9">f1</text>
    <!-- epsilon arrow f1 -> s2 -->
    <line x1="195" y1="65" x2="285" y2="65" stroke="#8b5cf6" stroke-width="2" stroke-dasharray="6 4" marker-end="url(#re-arrow12e)"/>
    <text x="240" y="57" fill="#f59e0b" text-anchor="middle" font-size="13">&epsilon;</text>
    <!-- NFA(R2) box -->
    <rect x="295" y="30" width="180" height="70" rx="12" fill="rgba(59,130,246,0.1)" stroke="#3b82f6" stroke-width="2" stroke-dasharray="6 4"/>
    <text x="385" y="70" fill="#93c5fd" text-anchor="middle" font-size="14" font-family="system-ui">NFA(R2)</text>
    <circle cx="310" cy="65" r="10" fill="#1e293b" stroke="#93c5fd" stroke-width="1.5"/>
    <text x="310" y="69" fill="#93c5fd" text-anchor="middle" font-size="9">s2</text>
    <circle cx="460" cy="65" r="10" fill="#1e293b" stroke="#93c5fd" stroke-width="1.5"/>
    <text x="460" y="69" fill="#93c5fd" text-anchor="middle" font-size="9">f2</text>
    <!-- labels -->
    <text x="40" y="120" fill="#64748b" text-anchor="middle" font-size="11">start = s1</text>
    <text x="460" y="120" fill="#64748b" text-anchor="middle" font-size="11">accept = f2</text>
  </svg>
  <div class="analogy">
    <h3>Analogy: Train Cars</h3>
    <p>Concatenation is like <strong>coupling train cars</strong>. The output of the first car (R1) connects directly to the input of the second car (R2). A string must ride through both to be accepted.</p>
  </div>
  <div class="slide-number">12 / 21</div>
</div>

<!-- ===================== SLIDE 13: THOMPSON STAR ===================== -->
<div class="slide" id="s13">
  <h2>Thompson's Construction: Kleene Star (R*)</h2>
  <p>"Accept zero or more repetitions of R."</p>
  <svg class="re-viz-svg" viewBox="0 0 500 200" style="max-width:600px; margin: 12px auto; display:block;">
    <defs>
      <marker id="re-arrow13" viewBox="0 0 10 7" refX="10" refY="3.5" markerWidth="8" markerHeight="6" orient="auto"><polygon points="0 0, 10 3.5, 0 7" fill="#475569"/></marker>
      <marker id="re-arrow13e" viewBox="0 0 10 7" refX="10" refY="3.5" markerWidth="8" markerHeight="6" orient="auto"><polygon points="0 0, 10 3.5, 0 7" fill="#8b5cf6"/></marker>
    </defs>
    <!-- start state -->
    <circle cx="50" cy="100" r="20" fill="#1e293b" stroke="#93c5fd" stroke-width="2"/>
    <text x="50" y="105" fill="#93c5fd" text-anchor="middle" font-size="12" font-family="system-ui">start</text>
    <!-- NFA(R) box -->
    <rect x="140" y="60" width="200" height="80" rx="12" fill="rgba(59,130,246,0.1)" stroke="#3b82f6" stroke-width="2" stroke-dasharray="6 4"/>
    <text x="240" y="105" fill="#93c5fd" text-anchor="middle" font-size="14" font-family="system-ui">NFA(R)</text>
    <circle cx="160" cy="100" r="10" fill="#1e293b" stroke="#93c5fd" stroke-width="1.5"/>
    <text x="160" y="104" fill="#93c5fd" text-anchor="middle" font-size="9">s1</text>
    <circle cx="320" cy="100" r="10" fill="#1e293b" stroke="#93c5fd" stroke-width="1.5"/>
    <text x="320" y="104" fill="#93c5fd" text-anchor="middle" font-size="9">f1</text>
    <!-- accept state -->
    <circle cx="440" cy="100" r="20" fill="#1e293b" stroke="#93c5fd" stroke-width="2"/>
    <circle cx="440" cy="100" r="16" fill="none" stroke="#93c5fd" stroke-width="1.5"/>
    <text x="440" y="105" fill="#93c5fd" text-anchor="middle" font-size="11" font-family="system-ui">accept</text>
    <!-- start -> s1 epsilon -->
    <line x1="70" y1="100" x2="148" y2="100" stroke="#8b5cf6" stroke-width="2" stroke-dasharray="6 4" marker-end="url(#re-arrow13e)"/>
    <text x="108" y="93" fill="#f59e0b" text-anchor="middle" font-size="12">&epsilon;</text>
    <!-- f1 -> accept epsilon -->
    <line x1="330" y1="100" x2="418" y2="100" stroke="#8b5cf6" stroke-width="2" stroke-dasharray="6 4" marker-end="url(#re-arrow13e)"/>
    <text x="375" y="93" fill="#f59e0b" text-anchor="middle" font-size="12">&epsilon;</text>
    <!-- f1 -> s1 loop back (curved on top) -->
    <path d="M 320,88 C 320,30 160,30 160,88" fill="none" stroke="#8b5cf6" stroke-width="2" stroke-dasharray="6 4" marker-end="url(#re-arrow13e)"/>
    <text x="240" y="35" fill="#f59e0b" text-anchor="middle" font-size="12">&epsilon; (loop)</text>
    <!-- start -> accept bypass (curved on bottom) -->
    <path d="M 60,118 C 80,185 420,185 430,118" fill="none" stroke="#8b5cf6" stroke-width="2" stroke-dasharray="6 4" marker-end="url(#re-arrow13e)"/>
    <text x="245" y="185" fill="#f59e0b" text-anchor="middle" font-size="12">&epsilon; (bypass: zero copies)</text>
  </svg>
  <div class="warning">
    <h3>Critical: The &epsilon;-bypass</h3>
    <p>The bottom &epsilon;-transition from start directly to accept is what makes R* accept the <strong>empty string</strong>. Without it, we would need at least one copy of R (that would be R<sup>+</sup>, not R*).</p>
  </div>
  <div class="slide-number">13 / 21</div>
</div>

<!-- ===================== SLIDE 14: THOMPSON STEP-THROUGH VISUALIZER ===================== -->
<div class="slide" id="s14">
  <h2>Thompson's Construction: Step-Through for (0|1)*01</h2>
  <p>Watch the NFA build step by step using Thompson's rules:</p>
  <div class="re-thompson-container">
    <div class="re-viz-controls">
      <button class="re-viz-btn" id="re_tNextBtn" onclick="re_tNext()">Next Step</button>
      <button class="re-viz-btn" id="re_tAutoBtn" onclick="re_tAuto()">Auto Play</button>
      <button class="re-viz-btn" onclick="re_tReset()">Reset</button>
      <span class="re-viz-step-label" id="re_tStepLabel">Step 0 / 9</span>
    </div>
    <svg class="re-viz-svg" viewBox="0 0 800 300" id="re_tSvg" style="height:260px;">
      <defs>
        <marker id="re-ta" viewBox="0 0 10 7" refX="10" refY="3.5" markerWidth="8" markerHeight="6" orient="auto"><polygon points="0 0, 10 3.5, 0 7" fill="#475569"/></marker>
        <marker id="re-tae" viewBox="0 0 10 7" refX="10" refY="3.5" markerWidth="8" markerHeight="6" orient="auto"><polygon points="0 0, 10 3.5, 0 7" fill="#8b5cf6"/></marker>
        <filter id="re-glow"><feGaussianBlur stdDeviation="3" result="blur"/><feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
      </defs>
      <!-- All states and edges defined here, initially hidden -->
      <!-- Step 1: A(150,80) --0--> B(250,80) -->
      <g id="re_t_s1" style="opacity:0;transition:opacity 0.5s">
        <circle cx="150" cy="80" r="18" fill="#1e293b" stroke="#93c5fd" stroke-width="2"/>
        <text x="150" y="85" fill="#93c5fd" text-anchor="middle" font-size="12">A</text>
        <circle cx="250" cy="80" r="18" fill="#1e293b" stroke="#93c5fd" stroke-width="2"/>
        <text x="250" y="85" fill="#93c5fd" text-anchor="middle" font-size="12">B</text>
        <line x1="168" y1="80" x2="230" y2="80" stroke="#475569" stroke-width="2" marker-end="url(#re-ta)"/>
        <text x="200" y="73" fill="#f59e0b" text-anchor="middle" font-size="13">0</text>
      </g>
      <!-- Step 2: C(150,200) --1--> D(250,200) -->
      <g id="re_t_s2" style="opacity:0;transition:opacity 0.5s">
        <circle cx="150" cy="200" r="18" fill="#1e293b" stroke="#93c5fd" stroke-width="2"/>
        <text x="150" y="205" fill="#93c5fd" text-anchor="middle" font-size="12">C</text>
        <circle cx="250" cy="200" r="18" fill="#1e293b" stroke="#93c5fd" stroke-width="2"/>
        <text x="250" y="205" fill="#93c5fd" text-anchor="middle" font-size="12">D</text>
        <line x1="168" y1="200" x2="230" y2="200" stroke="#475569" stroke-width="2" marker-end="url(#re-ta)"/>
        <text x="200" y="193" fill="#f59e0b" text-anchor="middle" font-size="13">1</text>
      </g>
      <!-- Step 3: Union - q_u(60,140) -> A,C eps; B,D -> q_ua(340,140) eps -->
      <g id="re_t_s3" style="opacity:0;transition:opacity 0.5s">
        <circle cx="60" cy="140" r="18" fill="#1e293b" stroke="#93c5fd" stroke-width="2"/>
        <text x="60" y="145" fill="#93c5fd" text-anchor="middle" font-size="11">q_u</text>
        <circle cx="340" cy="140" r="18" fill="#1e293b" stroke="#93c5fd" stroke-width="2"/>
        <text x="340" y="145" fill="#93c5fd" text-anchor="middle" font-size="10">q_ua</text>
        <!-- q_u -> A -->
        <line x1="74" y1="128" x2="136" y2="88" stroke="#8b5cf6" stroke-width="1.5" stroke-dasharray="5 3" marker-end="url(#re-tae)"/>
        <text x="96" y="100" fill="#f59e0b" font-size="10">&epsilon;</text>
        <!-- q_u -> C -->
        <line x1="74" y1="152" x2="136" y2="192" stroke="#8b5cf6" stroke-width="1.5" stroke-dasharray="5 3" marker-end="url(#re-tae)"/>
        <text x="96" y="182" fill="#f59e0b" font-size="10">&epsilon;</text>
        <!-- B -> q_ua -->
        <line x1="268" y1="80" x2="322" y2="128" stroke="#8b5cf6" stroke-width="1.5" stroke-dasharray="5 3" marker-end="url(#re-tae)"/>
        <text x="302" y="96" fill="#f59e0b" font-size="10">&epsilon;</text>
        <!-- D -> q_ua -->
        <line x1="268" y1="200" x2="322" y2="152" stroke="#8b5cf6" stroke-width="1.5" stroke-dasharray="5 3" marker-end="url(#re-tae)"/>
        <text x="302" y="188" fill="#f59e0b" font-size="10">&epsilon;</text>
      </g>
      <!-- Step 4: Star - q_s(20,140) -> q_u eps; q_ua -> q_sa(400,140) eps; q_ua->q_u loop; q_s->q_sa bypass -->
      <g id="re_t_s4" style="opacity:0;transition:opacity 0.5s">
        <circle cx="20" cy="140" r="18" fill="#1e293b" stroke="#93c5fd" stroke-width="2"/>
        <text x="20" y="145" fill="#93c5fd" text-anchor="middle" font-size="10">q_s</text>
        <circle cx="400" cy="140" r="18" fill="#1e293b" stroke="#93c5fd" stroke-width="2"/>
        <text x="400" y="145" fill="#93c5fd" text-anchor="middle" font-size="10">q_sa</text>
        <!-- q_s -> q_u -->
        <line x1="38" y1="140" x2="40" y2="140" stroke="#8b5cf6" stroke-width="1.5" stroke-dasharray="5 3" marker-end="url(#re-tae)"/>
        <text x="39" y="132" fill="#f59e0b" font-size="9">&epsilon;</text>
        <!-- q_ua -> q_sa -->
        <line x1="358" y1="140" x2="380" y2="140" stroke="#8b5cf6" stroke-width="1.5" stroke-dasharray="5 3" marker-end="url(#re-tae)"/>
        <text x="370" y="133" fill="#f59e0b" font-size="9">&epsilon;</text>
        <!-- q_ua -> q_u loop back top -->
        <path d="M 340,122 C 340,40 60,40 60,122" fill="none" stroke="#8b5cf6" stroke-width="1.5" stroke-dasharray="5 3" marker-end="url(#re-tae)"/>
        <text x="200" y="35" fill="#f59e0b" text-anchor="middle" font-size="10">&epsilon; (loop)</text>
        <!-- q_s -> q_sa bypass bottom -->
        <path d="M 25,158 C 40,270 380,270 395,158" fill="none" stroke="#8b5cf6" stroke-width="1.5" stroke-dasharray="5 3" marker-end="url(#re-tae)"/>
        <text x="210" y="268" fill="#f59e0b" text-anchor="middle" font-size="10">&epsilon; (bypass)</text>
      </g>
      <!-- Step 5: E(480,140) --0--> F(560,140) -->
      <g id="re_t_s5" style="opacity:0;transition:opacity 0.5s">
        <circle cx="480" cy="140" r="18" fill="#1e293b" stroke="#93c5fd" stroke-width="2"/>
        <text x="480" y="145" fill="#93c5fd" text-anchor="middle" font-size="12">E</text>
        <circle cx="560" cy="140" r="18" fill="#1e293b" stroke="#93c5fd" stroke-width="2"/>
        <text x="560" y="145" fill="#93c5fd" text-anchor="middle" font-size="12">F</text>
        <line x1="498" y1="140" x2="540" y2="140" stroke="#475569" stroke-width="2" marker-end="url(#re-ta)"/>
        <text x="520" y="133" fill="#f59e0b" text-anchor="middle" font-size="13">0</text>
      </g>
      <!-- Step 6: G(640,140) --1--> H(720,140) -->
      <g id="re_t_s6" style="opacity:0;transition:opacity 0.5s">
        <circle cx="640" cy="140" r="18" fill="#1e293b" stroke="#93c5fd" stroke-width="2"/>
        <text x="640" y="145" fill="#93c5fd" text-anchor="middle" font-size="12">G</text>
        <circle cx="720" cy="140" r="18" fill="#1e293b" stroke="#93c5fd" stroke-width="2"/>
        <text x="720" y="145" fill="#93c5fd" text-anchor="middle" font-size="12">H</text>
        <line x1="658" y1="140" x2="700" y2="140" stroke="#475569" stroke-width="2" marker-end="url(#re-ta)"/>
        <text x="680" y="133" fill="#f59e0b" text-anchor="middle" font-size="13">1</text>
      </g>
      <!-- Step 7: concat 01: F --eps--> G -->
      <g id="re_t_s7" style="opacity:0;transition:opacity 0.5s">
        <line x1="578" y1="140" x2="620" y2="140" stroke="#8b5cf6" stroke-width="1.5" stroke-dasharray="5 3" marker-end="url(#re-tae)"/>
        <text x="600" y="133" fill="#f59e0b" text-anchor="middle" font-size="11">&epsilon;</text>
      </g>
      <!-- Step 8: concat all: q_sa --eps--> E -->
      <g id="re_t_s8" style="opacity:0;transition:opacity 0.5s">
        <line x1="418" y1="140" x2="460" y2="140" stroke="#8b5cf6" stroke-width="1.5" stroke-dasharray="5 3" marker-end="url(#re-tae)"/>
        <text x="440" y="133" fill="#f59e0b" text-anchor="middle" font-size="11">&epsilon;</text>
      </g>
      <!-- Step 9: Mark H as final accept (double circle) -->
      <g id="re_t_s9" style="opacity:0;transition:opacity 0.5s">
        <circle cx="720" cy="140" r="14" fill="none" stroke="#34d399" stroke-width="2"/>
        <text x="720" y="170" fill="#34d399" text-anchor="middle" font-size="10">ACCEPT</text>
        <text x="20" y="170" fill="#34d399" text-anchor="middle" font-size="10">START</text>
      </g>
    </svg>
    <div class="re-viz-log" id="re_tLog"></div>
  </div>
  <div class="slide-number">14 / 21</div>
</div>

<!-- ===================== SLIDE 15: STATE ELIMINATION OVERVIEW ===================== -->
<div class="slide" id="s15">
  <h2>DFA to RE: State Elimination Method</h2>
  <p>To convert a DFA (or NFA) back to a regular expression, we use <strong>state elimination</strong>.</p>
  <div class="diagram">
  The Idea:
  =========
  1. Start with the DFA

  2. Add a NEW unique start state  (s) --&epsilon;--> old start
     Add a NEW unique accept state: old accepts --&epsilon;--> (f)

  3. Remove states ONE BY ONE (not s or f)
     - When removing state q, replace transitions
       through q with RE-labeled transitions

  4. When only s and f remain, the label on
     the single edge s --> f is the answer RE!

  Before:                     After removing q_rip:
  +----+  R1   +------+  R3   +----+
  | qi |------>| q_rip|------>| qj |
  +----+       +------+       +----+
                  ^ |
               R2 | | R2
                  +-+

  +----+     R1 R2* R3      +----+
  | qi |------------------->| qj |     (plus any direct qi-->qj edge)
  +----+                    +----+
  </div>
  <div class="key-idea">
    <h3>Core Rule for Removing State q</h3>
    <p>For every pair (qi, qj) that both connect through q: the new label on qi-->qj becomes: <code>(old label qi-->qj) | (label qi-->q)(label q-->q)*(label q-->qj)</code></p>
  </div>
  <div class="slide-number">15 / 21</div>
</div>

<!-- ===================== SLIDE 16: STATE ELIMINATION STEP-THROUGH ===================== -->
<div class="slide" id="s16">
  <h2>State Elimination: Interactive Step-Through</h2>
  <p>Convert a DFA (binary strings ending in 1) to a regular expression:</p>
  <div class="re-se-container">
    <div class="re-viz-controls">
      <button class="re-viz-btn" id="re_seNextBtn" onclick="re_seNext()">Next Step</button>
      <button class="re-viz-btn" id="re_seAutoBtn" onclick="re_seAuto()">Auto Play</button>
      <button class="re-viz-btn" onclick="re_seReset()">Reset</button>
      <span class="re-viz-step-label" id="re_seStepLabel">Step 0 / 7</span>
    </div>
    <svg class="re-viz-svg" viewBox="0 0 500 200" id="re_seSvg" style="height:200px;">
      <defs>
        <marker id="re-sea" viewBox="0 0 10 7" refX="10" refY="3.5" markerWidth="8" markerHeight="6" orient="auto"><polygon points="0 0, 10 3.5, 0 7" fill="#475569"/></marker>
        <marker id="re-seae" viewBox="0 0 10 7" refX="10" refY="3.5" markerWidth="8" markerHeight="6" orient="auto"><polygon points="0 0, 10 3.5, 0 7" fill="#8b5cf6"/></marker>
        <marker id="re-seag" viewBox="0 0 10 7" refX="10" refY="3.5" markerWidth="8" markerHeight="6" orient="auto"><polygon points="0 0, 10 3.5, 0 7" fill="#34d399"/></marker>
      </defs>
      <!-- Step 1: Original DFA: q0(200,100) and q1(340,100) -->
      <g id="re_se_orig">
        <!-- q0 -->
        <g id="re_se_q0">
          <circle cx="200" cy="100" r="20" fill="#1e293b" stroke="#93c5fd" stroke-width="2"/>
          <text x="200" y="105" fill="#93c5fd" text-anchor="middle" font-size="13">q0</text>
        </g>
        <!-- q1 -->
        <g id="re_se_q1">
          <circle cx="340" cy="100" r="20" fill="#1e293b" stroke="#93c5fd" stroke-width="2"/>
          <circle cx="340" cy="100" r="16" fill="none" stroke="#93c5fd" stroke-width="1.5"/>
          <text x="340" y="105" fill="#93c5fd" text-anchor="middle" font-size="13">q1</text>
        </g>
        <!-- q0 self-loop 0 -->
        <g id="re_se_q0loop">
          <path d="M 188,82 C 175,40 225,40 212,82" fill="none" stroke="#475569" stroke-width="2" marker-end="url(#re-sea)"/>
          <text x="200" y="42" fill="#f59e0b" text-anchor="middle" font-size="13">0</text>
        </g>
        <!-- q0 -> q1: 1 -->
        <g id="re_se_q0q1">
          <line x1="220" y1="92" x2="318" y2="92" stroke="#475569" stroke-width="2" marker-end="url(#re-sea)"/>
          <text x="270" y="85" fill="#f59e0b" text-anchor="middle" font-size="13">1</text>
        </g>
        <!-- q1 -> q0: 0 -->
        <g id="re_se_q1q0">
          <line x1="320" y1="110" x2="222" y2="110" stroke="#475569" stroke-width="2" marker-end="url(#re-sea)"/>
          <text x="270" y="127" fill="#f59e0b" text-anchor="middle" font-size="13">0</text>
        </g>
        <!-- q1 self-loop 1 -->
        <g id="re_se_q1loop">
          <path d="M 328,82 C 315,40 365,40 352,82" fill="none" stroke="#475569" stroke-width="2" marker-end="url(#re-sea)"/>
          <text x="340" y="42" fill="#f59e0b" text-anchor="middle" font-size="13">1</text>
        </g>
      </g>
      <!-- Step 2: s and f states -->
      <g id="re_se_sf" style="opacity:0;transition:opacity 0.5s">
        <!-- s -->
        <circle cx="60" cy="100" r="20" fill="#1e293b" stroke="#93c5fd" stroke-width="2"/>
        <text x="60" y="105" fill="#93c5fd" text-anchor="middle" font-size="13">s</text>
        <!-- s -> q0 epsilon -->
        <line x1="80" y1="100" x2="178" y2="100" stroke="#8b5cf6" stroke-width="2" stroke-dasharray="5 3" marker-end="url(#re-seae)"/>
        <text x="130" y="93" fill="#f59e0b" text-anchor="middle" font-size="12">&epsilon;</text>
        <!-- f -->
        <circle cx="480" cy="100" r="20" fill="#1e293b" stroke="#93c5fd" stroke-width="2"/>
        <circle cx="480" cy="100" r="16" fill="none" stroke="#93c5fd" stroke-width="1.5"/>
        <text x="480" y="105" fill="#93c5fd" text-anchor="middle" font-size="13">f</text>
        <!-- q1 -> f epsilon -->
        <line x1="360" y1="100" x2="458" y2="100" stroke="#8b5cf6" stroke-width="2" stroke-dasharray="5 3" marker-end="url(#re-seae)"/>
        <text x="410" y="93" fill="#f59e0b" text-anchor="middle" font-size="12">&epsilon;</text>
      </g>
      <!-- Step 3: highlight q0 for elimination -->
      <g id="re_se_hl_q0" style="opacity:0;transition:opacity 0.5s">
        <circle cx="200" cy="100" r="24" fill="none" stroke="#f59e0b" stroke-width="2" stroke-dasharray="4 3"/>
        <text x="200" y="145" fill="#f59e0b" text-anchor="middle" font-size="11">eliminating...</text>
      </g>
      <!-- Step 4: after eliminating q0 - new edges -->
      <g id="re_se_after_q0" style="opacity:0;transition:opacity 0.5s">
        <!-- s --0*1--> q1 -->
        <path d="M 78,90 Q 200,40 322,90" fill="none" stroke="#34d399" stroke-width="2" marker-end="url(#re-seag)"/>
        <text x="200" y="55" fill="#34d399" text-anchor="middle" font-size="12" font-weight="bold">0*1</text>
        <!-- q1 self-loop (1|00*1) -->
        <path d="M 328,82 C 310,20 370,20 352,82" fill="none" stroke="#34d399" stroke-width="2" marker-end="url(#re-seag)"/>
        <text x="340" y="15" fill="#34d399" text-anchor="middle" font-size="11" font-weight="bold">(1|00*1)</text>
      </g>
      <!-- Step 4 X on q0 -->
      <g id="re_se_x_q0" style="opacity:0;transition:opacity 0.5s">
        <line x1="182" y1="82" x2="218" y2="118" stroke="#ef4444" stroke-width="3"/>
        <line x1="218" y1="82" x2="182" y2="118" stroke="#ef4444" stroke-width="3"/>
      </g>
      <!-- Step 5: highlight q1 -->
      <g id="re_se_hl_q1" style="opacity:0;transition:opacity 0.5s">
        <circle cx="340" cy="100" r="24" fill="none" stroke="#f59e0b" stroke-width="2" stroke-dasharray="4 3"/>
        <text x="340" y="145" fill="#f59e0b" text-anchor="middle" font-size="11">eliminating...</text>
      </g>
      <!-- Step 6: final edge s->f -->
      <g id="re_se_final" style="opacity:0;transition:opacity 0.5s">
        <path d="M 78,85 Q 270,20 462,85" fill="none" stroke="#34d399" stroke-width="2.5" marker-end="url(#re-seag)"/>
        <text x="270" y="30" fill="#34d399" text-anchor="middle" font-size="13" font-weight="bold">0*1(1|00*1)*</text>
      </g>
      <!-- Step 6 X on q1 -->
      <g id="re_se_x_q1" style="opacity:0;transition:opacity 0.5s">
        <line x1="322" y1="82" x2="358" y2="118" stroke="#ef4444" stroke-width="3"/>
        <line x1="358" y1="82" x2="322" y2="118" stroke="#ef4444" stroke-width="3"/>
      </g>
      <!-- Step 7: result text -->
      <g id="re_se_result" style="opacity:0;transition:opacity 0.5s">
        <rect x="100" y="155" width="340" height="35" rx="8" fill="rgba(16,185,129,0.15)" stroke="#10b981" stroke-width="1"/>
        <text x="270" y="178" fill="#34d399" text-anchor="middle" font-size="14" font-weight="bold">Final RE: 0*1(1|00*1)* = (0|1)*1</text>
      </g>
    </svg>
    <div class="re-viz-log" id="re_seLog"></div>
  </div>
  <div class="slide-number">16 / 21</div>
</div>

<!-- ===================== SLIDE 17: CHALLENGE QUIZ (NEW) ===================== -->
<div class="slide" id="s17">
  <h2>Challenge Quiz: Regular Expressions</h2>
  <p>Test your understanding with these questions:</p>
  <div class="re-quiz-container" id="re_quizArea">
    <div id="re_quizContent">
      <p style="color:#94a3b8; font-size:1.2em;">Click "Start Quiz" to begin!</p>
      <button class="re-viz-btn" onclick="re_q1Init()" style="margin-top:16px; font-size:1.1em; padding:10px 30px;">Start Quiz</button>
    </div>
  </div>
  <div class="slide-number">17 / 21</div>
</div>

<!-- ===================== SLIDE 18: ALGEBRAIC LAWS ===================== -->
<div class="slide" id="s18">
  <h2>Algebraic Laws of Regular Expressions</h2>
  <p>REs obey many useful identities. These help simplify expressions.</p>
  <div class="two-col">
    <div>
      <h3>Union Laws</h3>
      <table>
        <tr><th>Law</th><th>Rule</th></tr>
        <tr><td>Commutative</td><td>R | S = S | R</td></tr>
        <tr><td>Associative</td><td>(R|S)|T = R|(S|T)</td></tr>
        <tr><td>Idempotent</td><td>R | R = R</td></tr>
        <tr><td>Identity</td><td>R | &empty; = R</td></tr>
      </table>
      <h3 class="mt">Concatenation Laws</h3>
      <table>
        <tr><th>Law</th><th>Rule</th></tr>
        <tr><td>Associative</td><td>(RS)T = R(ST)</td></tr>
        <tr><td>Identity</td><td>R&epsilon; = &epsilon;R = R</td></tr>
        <tr><td>Annihilator</td><td>R&empty; = &empty;R = &empty;</td></tr>
      </table>
    </div>
    <div>
      <h3>Distributivity</h3>
      <table>
        <tr><th>Law</th><th>Rule</th></tr>
        <tr><td>Left dist.</td><td>R(S|T) = RS | RT</td></tr>
        <tr><td>Right dist.</td><td>(S|T)R = SR | TR</td></tr>
      </table>
      <h3 class="mt">Star Laws</h3>
      <table>
        <tr><th>Law</th><th>Rule</th></tr>
        <tr><td>Star idem.</td><td>(R*)* = R*</td></tr>
        <tr><td>Star of &epsilon;</td><td>&epsilon;* = &epsilon;</td></tr>
        <tr><td>Star of &empty;</td><td>&empty;* = &epsilon;</td></tr>
      </table>
      <div class="warning mt">
        <h3>Not Commutative!</h3>
        <p>Concatenation is <strong>NOT</strong> commutative. <code>ab ≠ ba</code>. Order matters!</p>
      </div>
    </div>
  </div>
  <div class="slide-number">18 / 21</div>
</div>

<!-- ===================== SLIDE 19: THEORY vs PRACTICE ===================== -->
<div class="slide" id="s19">
  <h2>Theory vs Practice: Regex in Programming</h2>
  <p>The "regex" in Python/Java/etc. is <strong>more powerful</strong> than theoretical REs!</p>
  <div class="two-col">
    <div>
      <h3>Theoretical RE (CS305)</h3>
      <ul>
        <li>Only: union, concat, star</li>
        <li>Describes exactly the regular languages</li>
        <li>Equivalent to DFA/NFA</li>
        <li>Always runs in O(n) time</li>
        <li>Cannot count or match patterns like a<sup>n</sup>b<sup>n</sup></li>
      </ul>
    </div>
    <div>
      <h3>Practical Regex (Programming)</h3>
      <ul>
        <li>Adds: <code>+, ?, {n,m}, [a-z], \d, \w</code></li>
        <li><code>.</code> for any character</li>
        <li><strong>Backreferences</strong>: <code>\1, \2</code> (NOT regular!)</li>
        <li><strong>Lookahead/lookbehind</strong></li>
        <li>Can cause exponential blowup!</li>
      </ul>
    </div>
  </div>
  <div class="mt">
    <table style="width:100%;">
      <tr><th>Feature</th><th>Theoretical</th><th>Practical</th><th>Still Regular?</th></tr>
      <tr><td><code>R+</code> (one or more)</td><td>Write as RR*</td><td>Built-in</td><td style="color:#34d399;">Yes</td></tr>
      <tr><td><code>R?</code> (optional)</td><td>Write as R|&epsilon;</td><td>Built-in</td><td style="color:#34d399;">Yes</td></tr>
      <tr><td><code>[a-z]</code></td><td>Write as a|b|...|z</td><td>Built-in</td><td style="color:#34d399;">Yes</td></tr>
      <tr><td><code>R{3,5}</code></td><td>Write as RRR|RRRR|RRRRR</td><td>Built-in</td><td style="color:#34d399;">Yes</td></tr>
      <tr class="highlight"><td><code>\1</code> backreference</td><td>Cannot express</td><td>Built-in</td><td style="color:#f87171;">NO!</td></tr>
      <tr class="highlight"><td>Lookahead <code>(?=...)</code></td><td>Cannot express</td><td>Built-in</td><td style="color:#f87171;">NO!</td></tr>
    </table>
  </div>
  <div class="warning mt">
    <h3>ReDoS: When Regex Goes Wrong</h3>
    <p>Backreferences can make regex matching <strong>NP-hard</strong>. Poorly written patterns like <code>(a+)+</code> can cause catastrophic backtracking -- a real security vulnerability called <strong>ReDoS</strong>.</p>
  </div>
  <div class="slide-number">19 / 21</div>
</div>

<!-- ===================== SLIDE 20: COMMON PATTERNS ===================== -->
<div class="slide" id="s20">
  <h2>Common RE Patterns</h2>
  <p>Useful regular expression patterns for common language descriptions.</p>
  <div class="two-col">
    <div>
      <h3>Over &Sigma; = {0, 1}</h3>
      <table style="font-size:0.95em;">
        <tr><th>Language</th><th>RE</th></tr>
        <tr><td>All strings</td><td><code>(0|1)*</code></td></tr>
        <tr><td>Strings starting with 1</td><td><code>1(0|1)*</code></td></tr>
        <tr><td>Strings ending in 00</td><td><code>(0|1)*00</code></td></tr>
        <tr><td>Strings containing 101</td><td><code>(0|1)*101(0|1)*</code></td></tr>
        <tr><td>Even-length strings</td><td><code>((0|1)(0|1))*</code></td></tr>
        <tr><td>Strings of only 0s</td><td><code>0*</code></td></tr>
        <tr><td>Non-empty strings</td><td><code>(0|1)(0|1)*</code></td></tr>
        <tr><td>Exactly three characters</td><td><code>(0|1)(0|1)(0|1)</code></td></tr>
      </table>
    </div>
    <div>
      <h3>Over &Sigma; = {a, b}</h3>
      <table style="font-size:0.95em;">
        <tr><th>Language</th><th>RE</th></tr>
        <tr><td>Starts and ends with a</td><td><code>a(a|b)*a | a</code></td></tr>
        <tr><td>Contains at least two b's</td><td><code>(a|b)*b(a|b)*b(a|b)*</code></td></tr>
        <tr><td>No two consecutive a's</td><td><code>(b|ab)*(a|&epsilon;)</code></td></tr>
        <tr><td>Every a followed by b</td><td><code>(b|ab)*</code></td></tr>
        <tr><td>Alternating a's and b's</td><td><code>(ab)*(a|&epsilon;) | (ba)*(b|&epsilon;)</code></td></tr>
      </table>
      <div class="key-idea mt">
        <h3>Building Block Patterns</h3>
        <p><code>&Sigma;*</code> = anything,<br>
          <code>&Sigma;* w &Sigma;*</code> = contains w,<br>
          <code>w &Sigma;*</code> = starts with w,<br>
          <code>&Sigma;* w</code> = ends with w</p>
      </div>
    </div>
  </div>
  <div class="slide-number">20 / 21</div>
</div>

<!-- ===================== SLIDE 21: SUMMARY ===================== -->
<div class="slide" id="s21">
  <h2>Summary &amp; Cheat Sheet</h2>
  <div class="two-col">
    <div>
      <h3>Core Concepts</h3>
      <div class="diagram small">
  RE = DFA = NFA (same power!)

  Three operations:
  +--------+---------------------------+
  |  R|S   | Union: R or S             |
  |  RS    | Concat: R then S          |
  |  R*    | Star: 0 or more R         |
  +--------+---------------------------+

  Precedence:  * > concat > |

  Base cases:
    &empty; --> empty language { }
    &epsilon; --> empty string  { "" }
    a --> single symbol  { "a" }
      </div>
      <h3 class="mt">Conversions</h3>
      <div class="diagram small">
  RE --Thompson's--> &epsilon;-NFA
      Construction

  DFA --State-------> RE
      Elimination
      </div>
    </div>
    <div>
      <h3>Key Identities</h3>
      <div class="diagram small">
  R | S  =  S | R        (union commutes)
  R | R  =  R            (idempotent)
  R&epsilon;   =  R            (concat identity)
  R&empty;   =  &empty;            (annihilator)
  (R*)*  =  R*           (star is idempotent)
  &empty;*    =  &epsilon;            (star of empty)
  R | &empty;  =  R            (union identity)
  R(S|T) =  RS | RT      (distribute)
      </div>
      <h3 class="mt">Common Mistakes</h3>
      <div class="warning" style="margin:8px 0;">
        <ul style="font-size:0.95em;">
          <li>&empty; ≠ &epsilon; &nbsp;(empty lang vs empty string)</li>
          <li><code>ab*</code> ≠ <code>(ab)*</code> &nbsp;(star binds tightest)</li>
          <li><code>R*</code> always includes &epsilon;</li>
          <li>Concat does NOT commute</li>
          <li>Practical regex ≠ theoretical RE</li>
        </ul>
      </div>
      <div class="analogy mt">
        <h3>Remember</h3>
        <p>Regular expressions are the <strong>algebra of regular languages</strong>. Master the three operations, know the precedence, and you can describe any regular language concisely.</p>
      </div>
    </div>
  </div>
  <div class="slide-number">21 / 21</div>
</div>

<!-- Navigation -->
<div class="nav">
  <button id="prevBtn" onclick="changeSlide(-1)">Previous</button>
  <button id="nextBtn" onclick="changeSlide(1)">Next</button>
</div>

<script>
const totalSlides = 21;
let current = 1;
function showSlide(n) {
  document.querySelectorAll('.slide').forEach(s => s.classList.remove('active'));
  const slide = document.getElementById('s' + n);
  if (slide) { slide.classList.add('active'); slide.classList.add('fade-in'); }
  document.getElementById('prevBtn').disabled = (n === 1);
  document.getElementById('nextBtn').disabled = (n === totalSlides);
  document.getElementById('progress').style.width = ((n / totalSlides) * 100) + '%';
}
function changeSlide(delta) {
  const next = current + delta;
  if (next >= 1 && next <= totalSlides) { current = next; showSlide(current); }
}
document.addEventListener('keydown', (e) => {
  if (e.key === 'ArrowRight' || e.key === 'ArrowDown' || e.key === ' ') { e.preventDefault(); changeSlide(1); }
  else if (e.key === 'ArrowLeft' || e.key === 'ArrowUp') { e.preventDefault(); changeSlide(-1); }
  else if (e.key === 's' || e.key === 'S') {
    const slide = document.getElementById('s' + current);
    const steps = slide.querySelectorAll('.step:not(.revealed)');
    if (steps.length > 0) steps[0].classList.add('revealed');
  }
});

// ============================================================
// ENHANCEMENT 1: Interactive RE Parse Tree Explorer (Slide 7)
// ============================================================
const re_ptTrees = [
  {
    regex: 'a(a|b)*',
    lang: 'Language: Strings over {a,b} that START with "a" -- {"a", "aa", "ab", "aab", "aba", ...}',
    // Tree structure: each level is an array of nodes. We animate level by level.
    levels: [
      [{text:'concat', cls:'op'}],
      [{text:'a', cls:'leaf'}, {text:'star *', cls:'op'}],
      [null, {text:'union |', cls:'op'}],
      [null, {text:'a', cls:'leaf'}, {text:'b', cls:'leaf'}]
    ],
    // Connectors describe lines between levels
    connectors: [
      [{from:0, to:[0,1]}],         // concat -> a, star
      [{from:1, to:[1]}],           // star -> union (index 1 in level 1 -> index 1 in level 2)
      [{from:1, to:[1,2]}]          // union -> a, b
    ]
  },
  {
    regex: '(aa|bb)(a|b)*',
    lang: 'Language: Strings that start with "aa" or "bb" -- {"aa", "bb", "aaa", "bba", ...}',
    levels: [
      [{text:'concat', cls:'op'}],
      [{text:'union |', cls:'op'}, {text:'star *', cls:'op'}],
      [{text:'aa', cls:'leaf'}, {text:'bb', cls:'leaf'}, {text:'union |', cls:'op'}],
      [null, null, {text:'a', cls:'leaf'}, {text:'b', cls:'leaf'}]
    ],
    connectors: [
      [{from:0, to:[0,1]}],
      [{from:0, to:[0,1]}, {from:1, to:[2]}],
      [{from:2, to:[2,3]}]
    ]
  },
  {
    regex: '(0|1)*0',
    lang: 'Language: Binary strings ending in 0 -- {"0", "00", "10", "010", "110", ...}',
    levels: [
      [{text:'concat', cls:'op'}],
      [{text:'star *', cls:'op'}, {text:'0', cls:'leaf'}],
      [{text:'union |', cls:'op'}],
      [{text:'0', cls:'leaf'}, {text:'1', cls:'leaf'}]
    ],
    connectors: [
      [{from:0, to:[0,1]}],
      [{from:0, to:[0]}],
      [{from:0, to:[0,1]}]
    ]
  },
  {
    regex: 'a*b*c*',
    lang: 'Language: Zero or more a\'s, then b\'s, then c\'s -- {"", "a", "b", "c", "ab", "abc", "aabbc", ...}',
    levels: [
      [{text:'concat', cls:'op'}],
      [{text:'concat', cls:'op'}, {text:'star *', cls:'op'}],
      [{text:'star *', cls:'op'}, {text:'star *', cls:'op'}, {text:'c', cls:'leaf'}],
      [{text:'a', cls:'leaf'}, {text:'b', cls:'leaf'}]
    ],
    connectors: [
      [{from:0, to:[0,1]}],
      [{from:0, to:[0,1]}, {from:1, to:[2]}],
      [{from:0, to:[0]}, {from:1, to:[1]}]
    ]
  }
];

let re_ptCurrent = -1;
let re_ptTimers = [];

function re_ptClearTimers() {
  re_ptTimers.forEach(t => clearTimeout(t));
  re_ptTimers = [];
}

function re_ptSelect(idx) {
  re_ptClearTimers();
  re_ptCurrent = idx;
  // Update button states
  document.querySelectorAll('.re-tree-btn').forEach((b, i) => {
    b.classList.toggle('active', i === idx);
  });
  const tree = re_ptTrees[idx];
  const area = document.getElementById('re_ptTreeArea');
  const langEl = document.getElementById('re_ptLang');
  area.innerHTML = '';
  langEl.textContent = '';
  langEl.classList.remove('visible');

  // Build the tree HTML - all nodes hidden initially
  let allNodes = [];
  let allConnectors = [];
  tree.levels.forEach((level, li) => {
    // Connector line row (before each level except first)
    if (li > 0) {
      const connRow = document.createElement('div');
      connRow.style.cssText = 'display:flex;justify-content:center;gap:20px;height:20px;';
      // Simple vertical lines for each non-null node in this level
      level.forEach((node, ni) => {
        const line = document.createElement('div');
        line.className = 're-tree-line';
        line.style.cssText = node ? 'width:2px;height:20px;background:#475569;' : 'width:2px;height:20px;background:transparent;';
        connRow.appendChild(line);
        if (node) allConnectors.push(line);
      });
      area.appendChild(connRow);
    }
    // Node row
    const row = document.createElement('div');
    row.className = 're-tree-level';
    level.forEach((node, ni) => {
      if (node) {
        const el = document.createElement('div');
        el.className = 're-tree-node ' + node.cls;
        el.textContent = node.text;
        row.appendChild(el);
        allNodes.push(el);
      } else {
        const spacer = document.createElement('div');
        spacer.style.cssText = 'display:inline-block;padding:6px 14px;opacity:0;';
        spacer.textContent = '\u00A0\u00A0';
        row.appendChild(spacer);
      }
    });
    area.appendChild(row);
  });

  // Animate nodes appearing with delays
  let delay = 200;
  allNodes.forEach((node, i) => {
    const t = setTimeout(() => {
      node.classList.add('visible');
    }, delay);
    re_ptTimers.push(t);
    delay += 250;
  });
  // Show connector lines
  let connDelay = 350;
  allConnectors.forEach((line) => {
    const t = setTimeout(() => {
      line.classList.add('visible');
    }, connDelay);
    re_ptTimers.push(t);
    connDelay += 200;
  });
  // Show language description at end
  const t = setTimeout(() => {
    langEl.textContent = tree.lang;
    langEl.classList.add('visible');
  }, delay + 300);
  re_ptTimers.push(t);
}

// ============================================================
// ENHANCEMENT 3: Thompson's Construction Step-Through (Slide 14)
// ============================================================
const re_thompsonSteps = [
  { ids: ['re_t_s1'], msg: "Base: NFA for '0' -- states A --0--> B" },
  { ids: ['re_t_s2'], msg: "Base: NFA for '1' -- states C --1--> D" },
  { ids: ['re_t_s3'], msg: "Union: 0|1 -- new start q_u, new accept q_ua, epsilon branches" },
  { ids: ['re_t_s4'], msg: "Star: (0|1)* -- wrap union in star with loop-back and bypass" },
  { ids: ['re_t_s5'], msg: "Base: NFA for '0' (for final '01') -- states E --0--> F" },
  { ids: ['re_t_s6'], msg: "Base: NFA for '1' (for final '01') -- states G --1--> H" },
  { ids: ['re_t_s7'], msg: "Concat: 01 -- connect F --epsilon--> G" },
  { ids: ['re_t_s8'], msg: "Concat: (0|1)*01 -- connect q_sa --epsilon--> E" },
  { ids: ['re_t_s9'], msg: "Done! NFA for (0|1)*01 complete. Start=q_s, Accept=H" }
];

let re_tCurrentStep = 0;
let re_tAutoTimer = null;

function re_tUpdateLog() {
  const log = document.getElementById('re_tLog');
  log.innerHTML = '';
  for (let i = 0; i < re_thompsonSteps.length; i++) {
    const item = document.createElement('div');
    item.className = 're-viz-log-item';
    if (i < re_tCurrentStep) {
      item.classList.add('done');
      item.textContent = '\u2713 Step ' + (i+1) + ': ' + re_thompsonSteps[i].msg;
    } else if (i === re_tCurrentStep) {
      item.classList.add('current');
      item.textContent = '\u2192 Step ' + (i+1) + ': ' + re_thompsonSteps[i].msg;
    } else {
      item.textContent = '  Step ' + (i+1) + ': ' + re_thompsonSteps[i].msg;
    }
    log.appendChild(item);
  }
  log.scrollTop = log.scrollHeight;
  document.getElementById('re_tStepLabel').textContent = 'Step ' + re_tCurrentStep + ' / ' + re_thompsonSteps.length;
}

function re_tNext() {
  if (re_tCurrentStep >= re_thompsonSteps.length) return;
  const step = re_thompsonSteps[re_tCurrentStep];
  step.ids.forEach(id => {
    const el = document.getElementById(id);
    if (el) el.style.opacity = '1';
  });
  re_tCurrentStep++;
  re_tUpdateLog();
  if (re_tCurrentStep >= re_thompsonSteps.length) {
    document.getElementById('re_tNextBtn').disabled = true;
    if (re_tAutoTimer) { clearInterval(re_tAutoTimer); re_tAutoTimer = null; document.getElementById('re_tAutoBtn').classList.remove('active'); }
  }
}

function re_tAuto() {
  if (re_tAutoTimer) {
    clearInterval(re_tAutoTimer);
    re_tAutoTimer = null;
    document.getElementById('re_tAutoBtn').classList.remove('active');
    return;
  }
  document.getElementById('re_tAutoBtn').classList.add('active');
  re_tAutoTimer = setInterval(() => {
    if (re_tCurrentStep >= re_thompsonSteps.length) {
      clearInterval(re_tAutoTimer);
      re_tAutoTimer = null;
      document.getElementById('re_tAutoBtn').classList.remove('active');
      return;
    }
    re_tNext();
  }, 800);
}

function re_tReset() {
  if (re_tAutoTimer) { clearInterval(re_tAutoTimer); re_tAutoTimer = null; document.getElementById('re_tAutoBtn').classList.remove('active'); }
  re_tCurrentStep = 0;
  re_thompsonSteps.forEach(step => {
    step.ids.forEach(id => {
      const el = document.getElementById(id);
      if (el) el.style.opacity = '0';
    });
  });
  document.getElementById('re_tNextBtn').disabled = false;
  re_tUpdateLog();
}

// ============================================================
// ENHANCEMENT 4: State Elimination Step-Through (Slide 16)
// ============================================================
const re_seSteps = [
  { show: [], hide: [], msg: "Original DFA: q0 --0--> q0, q0 --1--> q1, q1 --0--> q0, q1 --1--> q1. Accept: q1" },
  { show: ['re_se_sf'], hide: [], msg: "Add new start s --epsilon--> q0, and q1 --epsilon--> new accept f" },
  { show: ['re_se_hl_q0'], hide: [], msg: "Eliminate q0: analyze paths through q0 (self-loop 0, incoming epsilon from s, incoming 0 from q1, outgoing 1 to q1)" },
  { show: ['re_se_after_q0','re_se_x_q0'], hide: ['re_se_hl_q0','re_se_q0loop','re_se_q0q1','re_se_q1q0'], msg: "After eliminating q0: s --0*1--> q1, q1 self-loop becomes (1|00*1)" },
  { show: ['re_se_hl_q1'], hide: [], msg: "Eliminate q1: analyze paths through q1 (self-loop (1|00*1), incoming 0*1 from s, outgoing epsilon to f)" },
  { show: ['re_se_final','re_se_x_q1'], hide: ['re_se_hl_q1','re_se_q1loop','re_se_after_q0'], msg: "After eliminating q1: s --0*1(1|00*1)*--> f" },
  { show: ['re_se_result'], hide: [], msg: "Final RE: 0*1(1|00*1)* which simplifies to (0|1)*1 -- all binary strings ending in 1" }
];

let re_seCurrentStep = 0;
let re_seAutoTimer = null;

function re_seUpdateLog() {
  const log = document.getElementById('re_seLog');
  log.innerHTML = '';
  for (let i = 0; i < re_seSteps.length; i++) {
    const item = document.createElement('div');
    item.className = 're-viz-log-item';
    if (i < re_seCurrentStep) {
      item.classList.add('done');
      item.textContent = '\u2713 Step ' + (i+1) + ': ' + re_seSteps[i].msg;
    } else if (i === re_seCurrentStep) {
      item.classList.add('current');
      item.textContent = '\u2192 Step ' + (i+1) + ': ' + re_seSteps[i].msg;
    } else {
      item.textContent = '  Step ' + (i+1) + ': ' + re_seSteps[i].msg;
    }
    log.appendChild(item);
  }
  log.scrollTop = log.scrollHeight;
  document.getElementById('re_seStepLabel').textContent = 'Step ' + re_seCurrentStep + ' / ' + re_seSteps.length;
}

function re_seNext() {
  if (re_seCurrentStep >= re_seSteps.length) return;
  const step = re_seSteps[re_seCurrentStep];
  step.show.forEach(id => {
    const el = document.getElementById(id);
    if (el) el.style.opacity = '1';
  });
  step.hide.forEach(id => {
    const el = document.getElementById(id);
    if (el) el.style.opacity = '0.15';
  });
  re_seCurrentStep++;
  re_seUpdateLog();
  if (re_seCurrentStep >= re_seSteps.length) {
    document.getElementById('re_seNextBtn').disabled = true;
    if (re_seAutoTimer) { clearInterval(re_seAutoTimer); re_seAutoTimer = null; document.getElementById('re_seAutoBtn').classList.remove('active'); }
  }
}

function re_seAuto() {
  if (re_seAutoTimer) {
    clearInterval(re_seAutoTimer);
    re_seAutoTimer = null;
    document.getElementById('re_seAutoBtn').classList.remove('active');
    return;
  }
  document.getElementById('re_seAutoBtn').classList.add('active');
  re_seAutoTimer = setInterval(() => {
    if (re_seCurrentStep >= re_seSteps.length) {
      clearInterval(re_seAutoTimer);
      re_seAutoTimer = null;
      document.getElementById('re_seAutoBtn').classList.remove('active');
      return;
    }
    re_seNext();
  }, 1200);
}

function re_seReset() {
  if (re_seAutoTimer) { clearInterval(re_seAutoTimer); re_seAutoTimer = null; document.getElementById('re_seAutoBtn').classList.remove('active'); }
  re_seCurrentStep = 0;
  // Show all original elements, hide added ones
  ['re_se_sf','re_se_hl_q0','re_se_after_q0','re_se_x_q0','re_se_hl_q1','re_se_final','re_se_x_q1','re_se_result'].forEach(id => {
    const el = document.getElementById(id);
    if (el) el.style.opacity = '0';
  });
  ['re_se_q0loop','re_se_q0q1','re_se_q1q0','re_se_q1loop'].forEach(id => {
    const el = document.getElementById(id);
    if (el) el.style.opacity = '1';
  });
  document.getElementById('re_seNextBtn').disabled = false;
  re_seUpdateLog();
}

// ============================================================
// ENHANCEMENT 5: Challenge Quiz (Slide 17)
// ============================================================
const re_q1Pool = [
  {
    q: 'What language does (ab)* describe?',
    a: 'Repetitions of "ab" (including \u03b5)',
    b: 'All strings of a\'s and b\'s',
    correct: 'a',
    explain: '(ab)* generates {"", "ab", "abab", "ababab", ...} -- only the substring "ab" repeated, not arbitrary mixes.'
  },
  {
    q: 'Does a*b* include the string "aba"?',
    a: 'No (a\'s must come before b\'s)',
    b: 'Yes',
    correct: 'a',
    explain: 'a*b* means zero or more a\'s followed by zero or more b\'s. Once you start b\'s, you cannot go back to a. "aba" violates this.'
  },
  {
    q: 'Are ab|c and a(b|c) equivalent?',
    a: 'No (first = {ab,c}, second = {ab,ac})',
    b: 'Yes',
    correct: 'a',
    explain: 'ab|c = {ab, c} by precedence (concat before union). a(b|c) = {ab, ac}. Different languages!'
  },
  {
    q: 'What is \u2205* (star of the empty set)?',
    a: '\u03b5 (the empty string)',
    b: '\u2205 (still empty)',
    correct: 'a',
    explain: '\u2205* = {\u03b5} because the star always includes zero copies, which is the empty string. This is a classic identity.'
  },
  {
    q: 'Does (0|1)*01 accept the string "01"?',
    a: 'Yes',
    b: 'No',
    correct: 'a',
    explain: '(0|1)* can match zero characters (\u03b5), then "01" matches the literal 01. So "01" is accepted.'
  },
  {
    q: 'Is a(b*) the same as (ab)*?',
    a: 'No (first = a then b\'s, second = repeating ab)',
    b: 'Yes',
    correct: 'a',
    explain: 'a(b*) = {a, ab, abb, abbb, ...} -- one a then any b\'s. (ab)* = {\u03b5, ab, abab, ...} -- the pair "ab" repeated. Very different!'
  }
];

let re_q1Questions = [];
let re_q1Current = 0;
let re_q1Score = 0;
let re_q1Timer = null;

function re_q1Shuffle(arr) {
  const a = arr.slice();
  for (let i = a.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [a[i], a[j]] = [a[j], a[i]];
  }
  return a;
}

function re_q1Init() {
  if (re_q1Timer) { clearTimeout(re_q1Timer); re_q1Timer = null; }
  re_q1Questions = re_q1Shuffle(re_q1Pool).slice(0, 3);
  re_q1Current = 0;
  re_q1Score = 0;
  re_q1Render();
}

function re_q1Render() {
  const area = document.getElementById('re_quizContent');
  if (re_q1Current >= re_q1Questions.length) {
    // Show final score
    let msg = '';
    if (re_q1Score === 3) msg = 'Perfect score! You really know your regex.';
    else if (re_q1Score === 2) msg = 'Great job! Almost perfect.';
    else if (re_q1Score === 1) msg = 'Not bad, but review the concepts above.';
    else msg = 'Time to revisit the slides! Keep practicing.';
    area.innerHTML = '<div class="re-quiz-score">' + re_q1Score + ' / 3</div>' +
      '<p style="color:#94a3b8;margin-top:12px;">' + msg + '</p>' +
      '<button class="re-viz-btn" onclick="re_q1Init()" style="margin-top:20px;">Try Again</button>';
    return;
  }
  const q = re_q1Questions[re_q1Current];
  area.innerHTML = '<div class="re-quiz-progress">Question ' + (re_q1Current+1) + ' of 3</div>' +
    '<div class="re-quiz-question">' + q.q + '</div>' +
    '<div class="re-quiz-options">' +
    '<button class="re-quiz-btn" id="re_q1BtnA" onclick="re_q1Check(\'a\')">' + q.a + '</button>' +
    '<button class="re-quiz-btn" id="re_q1BtnB" onclick="re_q1Check(\'b\')">' + q.b + '</button>' +
    '</div>' +
    '<div class="re-quiz-explanation" id="re_q1Explain">' + q.explain + '</div>';
}

function re_q1Check(choice) {
  const q = re_q1Questions[re_q1Current];
  const btnA = document.getElementById('re_q1BtnA');
  const btnB = document.getElementById('re_q1BtnB');
  const explain = document.getElementById('re_q1Explain');
  btnA.disabled = true;
  btnB.disabled = true;
  if (q.correct === 'a') {
    btnA.classList.add('correct');
    btnB.classList.add('wrong');
  } else {
    btnB.classList.add('correct');
    btnA.classList.add('wrong');
  }
  if (choice === q.correct) re_q1Score++;
  explain.classList.add('visible');
  re_q1Timer = setTimeout(() => {
    re_q1Current++;
    re_q1Render();
  }, 2500);
}

// ============================================================
// ENHANCEMENT: Slide 5 Formal Definition Explorer
// ============================================================
const re_fdData = [
  { label: '\u2205', re: '\u2205', def: 'L(\u2205) = {}', type: 'Base case #1: Empty set', strings: [], infinite: false,
    test: function(s) { return false; } },
  { label: '\u03b5', re: '\u03b5', def: 'L(\u03b5) = {""}', type: 'Base case #2: Empty string', strings: ['""'], infinite: false,
    test: function(s) { return s === ''; } },
  { label: 'a', re: 'a', def: 'L(a) = {"a"}', type: 'Base case #3: Single symbol', strings: ['"a"'], infinite: false,
    test: function(s) { return s === 'a'; } },
  { label: '0|1', re: '0|1', def: 'L(0|1) = {"0", "1"}', type: 'Inductive: Union (R1|R2)', strings: ['"0"', '"1"'], infinite: false,
    test: function(s) { return s === '0' || s === '1'; } },
  { label: '01', re: '01', def: 'L(01) = {"01"}', type: 'Inductive: Concatenation (R1 R2)', strings: ['"01"'], infinite: false,
    test: function(s) { return s === '01'; } },
  { label: '0*', re: '0*', def: 'L(0*) = {"", "0", "00", "000", ...}', type: 'Inductive: Kleene Star (R*)', strings: ['""', '"0"', '"00"', '"000"', '...'], infinite: true,
    test: function(s) { return /^0*$/.test(s); } }
];
let re_fdCurrent = -1;

function re_fdSelect(idx) {
  re_fdCurrent = idx;
  const d = re_fdData[idx];
  // Update button states
  document.querySelectorAll('.re-fd-btn').forEach(function(b, i) {
    b.classList.toggle('active', i === idx);
  });
  var html = '<div class="re-fd-result">';
  html += '<h4 style="color:#93c5fd; font-size:1.2em;">RE: <span style="color:#f59e0b; font-family:monospace;">' + d.re + '</span></h4>';
  html += '<p style="color:#94a3b8;">Definition: <code style="color:#e2e8f0;">' + d.def + '</code></p>';
  html += '<p style="color:#94a3b8;">Type: <span style="color:#a5b4fc;">' + d.type + '</span></p>';
  html += '<p style="color:#94a3b8; margin-top:12px;">Strings in language:</p>';
  html += '<div class="re-fd-strings">';
  if (d.strings.length === 0) {
    html += '<span style="color:#f87171; font-style:italic;">No strings -- empty language</span>';
  } else {
    d.strings.forEach(function(s) {
      if (s === '...') {
        html += '<span style="color:#94a3b8; padding:4px 8px;">...</span>';
      } else {
        html += '<span class="re-fd-chip">' + s + '</span>';
      }
    });
  }
  html += '</div>';
  html += '<div class="re-fd-test">';
  html += '<label style="color:#94a3b8;">Test:</label>';
  html += '<input class="re-fd-input" id="re_fdInput" type="text" placeholder="type a string" onkeydown="if(event.key===\'Enter\')re_fdCheck()">';
  html += '<button class="re-fd-check-btn" onclick="re_fdCheck()">Check</button>';
  html += '<span id="re_fdVerdict" class="re-fd-verdict"></span>';
  html += '</div>';
  html += '</div>';
  document.getElementById('re_fdResult').innerHTML = html;
}

function re_fdCheck() {
  if (re_fdCurrent < 0) return;
  var input = document.getElementById('re_fdInput');
  var verdict = document.getElementById('re_fdVerdict');
  if (!input || !verdict) return;
  var s = input.value;
  var accepted = re_fdData[re_fdCurrent].test(s);
  if (accepted) {
    verdict.textContent = '\u2713 accepted!';
    verdict.className = 're-fd-verdict accept';
  } else {
    verdict.textContent = '\u2717 rejected';
    verdict.className = 're-fd-verdict reject';
  }
}

// ============================================================
// ENHANCEMENT: Slide 6 Precedence Playground
// ============================================================
const re_precData = [
  {
    re: 'ab|c',
    correct: { parsed: '(ab)|c', parse_desc: 'union( concat(a, b), c )', strings: ['"ab"', '"c"'] },
    wrong:   { parsed: 'a(b|c)', parse_desc: 'concat( a, union(b, c) )', strings: ['"ab"', '"ac"'] }
  },
  {
    re: 'ab*',
    correct: { parsed: 'a(b*)', parse_desc: 'concat( a, star(b) )', strings: ['"a"', '"ab"', '"abb"', '"abbb"', '...'] },
    wrong:   { parsed: '(ab)*', parse_desc: 'star( concat(a, b) )', strings: ['""', '"ab"', '"abab"', '...'] }
  },
  {
    re: 'a|bc*',
    correct: { parsed: 'a|(b(c*))', parse_desc: 'union( a, concat(b, star(c)) )', strings: ['"a"', '"b"', '"bc"', '"bcc"', '...'] },
    wrong:   { parsed: '(a|b)(c*)', parse_desc: 'concat( union(a,b), star(c) )', strings: ['"a"', '"ac"', '"b"', '"bc"', '...'] }
  }
];

function re_precSelect(idx) {
  var d = re_precData[idx];
  // Update button states
  document.querySelectorAll('.re-prec-btn').forEach(function(b, i) {
    b.classList.toggle('active', i === idx);
  });
  document.getElementById('re_precHint').style.display = 'none';
  var area = document.getElementById('re_precResult');
  area.style.display = 'grid';
  var html = '';
  // Correct panel
  html += '<div class="re-prec-panel correct">';
  html += '<h4>\u2713 CORRECT (with precedence)</h4>';
  html += '<p style="color:#e2e8f0; font-size:1.05em;"><code>' + d.re + '</code> = <code>' + d.correct.parsed + '</code></p>';
  html += '<p class="re-prec-parse">Parse: ' + d.correct.parse_desc + '</p>';
  html += '<p style="color:#94a3b8; font-size:0.9em;">Language:</p>';
  html += '<div class="re-prec-lang">';
  d.correct.strings.forEach(function(s) {
    if (s === '...') {
      html += '<span style="color:#94a3b8; padding:4px 8px;">...</span>';
    } else {
      html += '<span class="re-fd-chip">' + s + '</span>';
    }
  });
  html += '</div></div>';
  // Wrong panel
  html += '<div class="re-prec-panel wrong">';
  html += '<h4>\u2717 COMMON MISTAKE</h4>';
  html += '<p style="color:#e2e8f0; font-size:1.05em;"><code>' + d.re + '</code> \u2260 <code>' + d.wrong.parsed + '</code></p>';
  html += '<p class="re-prec-parse">Parse: ' + d.wrong.parse_desc + '</p>';
  html += '<p style="color:#94a3b8; font-size:0.9em;">Would produce:</p>';
  html += '<div class="re-prec-lang">';
  d.wrong.strings.forEach(function(s) {
    if (s === '...') {
      html += '<span style="color:#94a3b8; padding:4px 8px;">...</span>';
    } else {
      html += '<span class="re-fd-chip">' + s + '</span>';
    }
  });
  html += '</div></div>';
  area.innerHTML = html;
}

// ============================================================
// INITIALIZATION
// ============================================================
re_tUpdateLog();
re_seUpdateLog();
showSlide(1);
</script>

</body>
</html>
