<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Universal Turing Machines &amp; Undecidability — CS305</title>
<style>
* { box-sizing: border-box; margin: 0; padding: 0; }
body { font-family: 'Segoe UI', system-ui, -apple-system, sans-serif; background: #0f172a; color: #e2e8f0; }
.slide { display: none; min-height: 100vh; padding: 40px 60px; position: relative; }
.slide.active { display: flex; flex-direction: column; justify-content: center; }
.slide-number { position: absolute; bottom: 20px; right: 40px; color: #64748b; font-size: 14px; }
.nav { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); display: flex; gap: 12px; z-index: 100; }
.nav button { background: #334155; border: 1px solid #475569; color: #e2e8f0; padding: 8px 20px; border-radius: 8px; cursor: pointer; font-size: 14px; transition: all 0.2s; }
.nav button:hover { background: #475569; }
.nav button:disabled { opacity: 0.3; cursor: not-allowed; }
.progress { position: fixed; top: 0; left: 0; height: 3px; background: linear-gradient(90deg, #3b82f6, #8b5cf6); transition: width 0.3s; z-index: 100; }
h1 { font-size: 2.8em; margin-bottom: 20px; background: linear-gradient(135deg, #3b82f6, #8b5cf6); -webkit-background-clip: text; -webkit-text-fill-color: transparent; line-height: 1.2; }
h2 { font-size: 2em; margin-bottom: 16px; color: #93c5fd; }
h3 { font-size: 1.4em; margin-bottom: 12px; color: #a5b4fc; }
p, li { font-size: 1.15em; line-height: 1.7; color: #cbd5e1; margin-bottom: 10px; }
.subtitle { font-size: 1.3em; color: #94a3b8; margin-bottom: 30px; }
.two-col { display: grid; grid-template-columns: 1fr 1fr; gap: 40px; align-items: start; }
.center { text-align: center; }
.mt { margin-top: 20px; }
.diagram { background: #1e293b; border: 1px solid #334155; border-radius: 12px; padding: 24px; font-family: 'SF Mono', 'Fira Code', 'Consolas', monospace; font-size: 1em; line-height: 1.6; white-space: pre; overflow-x: auto; margin: 16px 0; color: #a5f3fc; }
.diagram.small { font-size: 0.85em; }
.key-idea { background: linear-gradient(135deg, rgba(59,130,246,0.15), rgba(139,92,246,0.15)); border-left: 4px solid #3b82f6; border-radius: 0 12px 12px 0; padding: 20px 24px; margin: 16px 0; }
.key-idea h3 { margin-bottom: 8px; }
.warning { background: rgba(245,158,11,0.12); border-left: 4px solid #f59e0b; border-radius: 0 12px 12px 0; padding: 20px 24px; margin: 16px 0; }
.warning h3 { color: #fbbf24; }
.analogy { background: rgba(16,185,129,0.12); border-left: 4px solid #10b981; border-radius: 0 12px 12px 0; padding: 20px 24px; margin: 16px 0; }
.analogy h3 { color: #34d399; }
table { border-collapse: collapse; margin: 16px 0; width: auto; }
th, td { border: 1px solid #475569; padding: 10px 16px; text-align: center; }
th { background: #334155; color: #93c5fd; font-weight: 600; }
td { background: #1e293b; color: #e2e8f0; }
tr.highlight td { background: rgba(59,130,246,0.2); }
.fade-in { animation: fadeIn 0.5s ease-in; }
@keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
ul { padding-left: 24px; }
ul li { margin-bottom: 8px; }

/* Interactive component shared styles */
.utm-controls { display: flex; gap: 8px; margin: 10px 0; flex-wrap: wrap; }
.utm-controls button, .utm-btn { background: #334155; border: 1px solid #475569; color: #e2e8f0; padding: 6px 16px; border-radius: 6px; cursor: pointer; font-size: 13px; transition: all 0.2s; }
.utm-controls button:hover, .utm-btn:hover { background: #475569; }
.utm-controls button.active, .utm-btn.active { background: #3b82f6; border-color: #60a5fa; }
.utm-controls button:disabled { opacity: 0.3; cursor: not-allowed; }
.utm-panel { background: #1e293b; border: 1px solid #334155; border-radius: 12px; padding: 16px; margin: 12px 0; }
.utm-status { font-size: 0.95em; color: #94a3b8; margin: 8px 0; min-height: 24px; }
.utm-badge { display: inline-block; padding: 4px 12px; border-radius: 6px; font-size: 0.85em; font-weight: 600; }
.utm-badge.red { background: rgba(239,68,68,0.2); color: #ef4444; border: 1px solid #ef4444; }
.utm-badge.green { background: rgba(16,185,129,0.2); color: #10b981; border: 1px solid #10b981; }
.utm-badge.amber { background: rgba(245,158,11,0.2); color: #f59e0b; border: 1px solid #f59e0b; }
@keyframes utm_pulse { 0%,100%{opacity:1;} 50%{opacity:0.5;} }
@keyframes utm_flash { 0%{background:rgba(239,68,68,0.5);} 100%{background:transparent;} }
@keyframes utm_spin { 0%{transform:rotate(0deg);} 100%{transform:rotate(360deg);} }

/* Enhancement 3: Diag table */
.utm_diag_cell { width: 44px; height: 44px; display: inline-flex; align-items: center; justify-content: center; border: 1px solid #475569; background: #1e293b; color: #e2e8f0; cursor: pointer; font-size: 1.1em; font-weight: 600; transition: all 0.3s; border-radius: 4px; }
.utm_diag_cell.diagonal { border-color: #f59e0b; }
.utm_diag_cell.diagonal-pulse { animation: utm_pulse 0.8s ease-in-out 3; border-color: #f59e0b; background: rgba(245,158,11,0.2); }
.utm_diag_cell.flipped { background: rgba(16,185,129,0.2); border-color: #10b981; color: #10b981; }
.utm_diag_cell.differ-flash { animation: utm_flash 0.6s ease-out; }
.utm_diag_header { width: 44px; height: 36px; display: inline-flex; align-items: center; justify-content: center; color: #93c5fd; font-weight: 600; font-size: 0.9em; }

/* Enhancement 7: Rice checker */
.utm_rice_prop { background: #1e293b; border: 1px solid #475569; border-radius: 8px; padding: 10px 14px; cursor: pointer; transition: all 0.2s; margin: 4px 0; font-size: 0.95em; color: #cbd5e1; }
.utm_rice_prop:hover { border-color: #93c5fd; background: #243047; }
.utm_rice_check { margin: 4px 0; font-size: 0.95em; color: #94a3b8; }
.utm_rice_check .done { color: #10b981; }
.utm_rice_check .fail { color: #ef4444; }

/* Enhancement 8: Hierarchy */
.utm_hier_btn { display: inline-block; background: #1e293b; border: 1px solid #475569; border-radius: 6px; padding: 5px 10px; cursor: pointer; font-size: 0.85em; color: #cbd5e1; margin: 3px; transition: all 0.2s; }
.utm_hier_btn:hover { border-color: #93c5fd; }
.utm_hier_btn.selected { border-color: #3b82f6; background: rgba(59,130,246,0.15); }

/* Enhancement 9: PCP */
.utm_pcp_domino { display: inline-flex; flex-direction: column; border: 2px solid #475569; border-radius: 8px; margin: 4px; cursor: pointer; transition: all 0.2s; min-width: 56px; }
.utm_pcp_domino:hover { border-color: #93c5fd; transform: scale(1.05); }
.utm_pcp_domino .top { background: #334155; padding: 6px 10px; border-radius: 6px 6px 0 0; text-align: center; color: #93c5fd; font-family: monospace; font-weight: 600; }
.utm_pcp_domino .bot { background: #1e293b; padding: 6px 10px; border-radius: 0 0 6px 6px; text-align: center; color: #f59e0b; font-family: monospace; font-weight: 600; }
.utm_pcp_seq { display: flex; flex-wrap: wrap; gap: 4px; margin: 8px 0; min-height: 60px; padding: 8px; background: #0f172a; border-radius: 8px; border: 1px dashed #334155; }

/* Enhancement 10: Quiz */
.utm_q1_opt { background: #1e293b; border: 1px solid #475569; border-radius: 8px; padding: 10px 14px; cursor: pointer; transition: all 0.2s; margin: 5px 0; font-size: 0.95em; color: #cbd5e1; }
.utm_q1_opt:hover { border-color: #93c5fd; background: #243047; }
.utm_q1_opt.correct { border-color: #10b981; background: rgba(16,185,129,0.15); color: #10b981; }
.utm_q1_opt.wrong { border-color: #ef4444; background: rgba(239,68,68,0.15); color: #ef4444; }
</style>
</head>
<body>

<div class="progress" id="progress"></div>

<!-- ============================================================ -->
<!-- SLIDE 1: Title -->
<!-- ============================================================ -->
<div class="slide active" id="s1">
  <div class="center">
    <h1>Universal Turing Machines<br>&amp; Undecidability</h1>
    <p class="subtitle">CS305 &mdash; Formal Language Theory</p>
    <div class="utm-panel" style="display:inline-block; max-width:750px; width:100%; padding:20px 12px;">
      <svg id="utm_hero_svg" viewBox="0 0 740 180" style="width:100%;display:block;">
        <!-- Tape cells -->
        <g id="utm_hero_cells"></g>
        <!-- Labels -->
        <g id="utm_hero_labels"></g>
        <!-- Head pointer -->
        <polygon id="utm_hero_head" points="0,-7 8,7 -8,7" fill="#3b82f6"/>
        <!-- Finite control box -->
        <rect id="utm_hero_ctrl_bg" x="0" y="0" width="90" height="32" rx="6" fill="#1e293b" stroke="#3b82f6" stroke-width="1.5"/>
        <text id="utm_hero_ctrl_txt" x="0" y="0" text-anchor="middle" fill="#93c5fd" font-size="12" font-weight="600">q0</text>
        <!-- Result badge -->
        <g id="utm_hero_result" opacity="0">
          <rect id="utm_hero_res_bg" x="0" y="0" width="130" height="36" rx="8"/>
          <text id="utm_hero_res_txt" x="0" y="0" text-anchor="middle" font-size="15" font-weight="700"></text>
        </g>
      </svg>
    </div>
    <p style="color:#64748b; margin-top:30px;">Use arrow keys or buttons to navigate</p>
  </div>
  <div class="slide-number">1 / 21</div>
</div>
<script>
(function() {
  var utm_hero_tape = ['B','1','1','0','1','0','0','1','#','0','1','1','B','B'];
  var utm_hero_cellW = 46, utm_hero_cellH = 36, utm_hero_startX = 30, utm_hero_tapeY = 70;
  var utm_hero_headPos = 0, utm_hero_phase = 0; // 0=scan, 1=pause, 2=result, 3=reset-wait
  var utm_hero_timer = null;
  var utm_hero_resultIdx = 0;
  var utm_hero_results = [
    { text: 'ACCEPT \u2713', color: '#10b981', bg: 'rgba(16,185,129,0.2)' },
    { text: 'REJECT \u2717', color: '#ef4444', bg: 'rgba(239,68,68,0.2)' }
  ];

  function utm_hero_render() {
    var svg = document.getElementById('utm_hero_svg');
    if (!svg) return;
    var cells = document.getElementById('utm_hero_cells');
    var labels = document.getElementById('utm_hero_labels');
    var h = '';
    for (var i = 0; i < utm_hero_tape.length; i++) {
      var x = utm_hero_startX + i * utm_hero_cellW;
      var isHead = (i === utm_hero_headPos);
      var fill = isHead ? 'rgba(59,130,246,0.25)' : '#1e293b';
      var stroke = isHead ? '#3b82f6' : '#334155';
      var sw = isHead ? 2 : 1;
      h += '<rect x="'+x+'" y="'+utm_hero_tapeY+'" width="'+(utm_hero_cellW-2)+'" height="'+utm_hero_cellH+'" rx="4" fill="'+fill+'" stroke="'+stroke+'" stroke-width="'+sw+'"/>';
      var sym = utm_hero_tape[i];
      var tc = sym === '#' ? '#f59e0b' : (sym === 'B' ? '#64748b' : '#e2e8f0');
      h += '<text x="'+(x + utm_hero_cellW/2 - 1)+'" y="'+(utm_hero_tapeY + utm_hero_cellH/2 + 5)+'" text-anchor="middle" fill="'+tc+'" font-size="15" font-family="monospace" font-weight="600">'+sym+'</text>';
    }
    cells.innerHTML = h;

    // Labels: ⟨M⟩ bracket over cells 0-7, w over cells 9-11
    var mStart = utm_hero_startX + utm_hero_cellW/2 - 1;
    var mEnd = utm_hero_startX + 7 * utm_hero_cellW + utm_hero_cellW/2 - 1;
    var mMid = (mStart + mEnd) / 2;
    var wStart = utm_hero_startX + 9 * utm_hero_cellW + utm_hero_cellW/2 - 1;
    var wEnd = utm_hero_startX + 11 * utm_hero_cellW + utm_hero_cellW/2 - 1;
    var wMid = (wStart + wEnd) / 2;
    var lY = utm_hero_tapeY + utm_hero_cellH + 18;
    labels.innerHTML = '<line x1="'+mStart+'" y1="'+(lY-4)+'" x2="'+mEnd+'" y2="'+(lY-4)+'" stroke="#93c5fd" stroke-width="1.5"/>' +
      '<text x="'+mMid+'" y="'+(lY+12)+'" text-anchor="middle" fill="#93c5fd" font-size="13" font-weight="600">\u27E8M\u27E9</text>' +
      '<line x1="'+wStart+'" y1="'+(lY-4)+'" x2="'+wEnd+'" y2="'+(lY-4)+'" stroke="#f59e0b" stroke-width="1.5"/>' +
      '<text x="'+wMid+'" y="'+(lY+12)+'" text-anchor="middle" fill="#f59e0b" font-size="13" font-weight="600">w</text>';

    // Head pointer
    var headX = utm_hero_startX + utm_hero_headPos * utm_hero_cellW + utm_hero_cellW/2 - 1;
    document.getElementById('utm_hero_head').setAttribute('transform', 'translate('+headX+','+(utm_hero_tapeY - 4)+')');

    // Finite control box
    var ctrlX = headX;
    var ctrlY = utm_hero_tapeY - 48;
    document.getElementById('utm_hero_ctrl_bg').setAttribute('x', ctrlX - 45);
    document.getElementById('utm_hero_ctrl_bg').setAttribute('y', ctrlY);
    var states = ['q0','q0','q1','q1','q2','q2','q3','q3','q3','q4','q4','q4','q5','q5'];
    var st = states[Math.min(utm_hero_headPos, states.length - 1)];
    var ctrlTxt = document.getElementById('utm_hero_ctrl_txt');
    ctrlTxt.setAttribute('x', ctrlX);
    ctrlTxt.setAttribute('y', ctrlY + 20);
    ctrlTxt.textContent = 'State: ' + st;
  }

  function utm_hero_tick() {
    if (utm_hero_phase === 0) {
      // Scanning right
      if (utm_hero_headPos < utm_hero_tape.length - 2) {
        utm_hero_headPos++;
        utm_hero_render();
      } else {
        utm_hero_phase = 1;
        setTimeout(function() { utm_hero_phase = 2; utm_hero_showResult(); }, 600);
      }
    }
  }

  function utm_hero_showResult() {
    var r = utm_hero_results[utm_hero_resultIdx];
    var resG = document.getElementById('utm_hero_result');
    var resBg = document.getElementById('utm_hero_res_bg');
    var resTxt = document.getElementById('utm_hero_res_txt');
    var cx = 370, cy = 20;
    resBg.setAttribute('x', cx - 65);
    resBg.setAttribute('y', cy - 18);
    resBg.setAttribute('fill', r.bg);
    resBg.setAttribute('stroke', r.color);
    resBg.setAttribute('stroke-width', '2');
    resTxt.setAttribute('x', cx);
    resTxt.setAttribute('y', cy + 5);
    resTxt.setAttribute('fill', r.color);
    resTxt.textContent = r.text;
    resG.setAttribute('opacity', '1');
    utm_hero_resultIdx = (utm_hero_resultIdx + 1) % utm_hero_results.length;
    setTimeout(function() {
      resG.setAttribute('opacity', '0');
      utm_hero_headPos = 0;
      utm_hero_phase = 0;
      utm_hero_render();
    }, 2000);
  }

  function utm_hero_start() {
    utm_hero_stop();
    utm_hero_headPos = 0;
    utm_hero_phase = 0;
    document.getElementById('utm_hero_result').setAttribute('opacity', '0');
    utm_hero_render();
    utm_hero_timer = setInterval(function() { utm_hero_tick(); }, 350);
  }

  function utm_hero_stop() {
    if (utm_hero_timer) { clearInterval(utm_hero_timer); utm_hero_timer = null; }
  }

  // MutationObserver to auto-start/stop
  var utm_hero_slide = document.getElementById('s1');
  utm_hero_render();
  var utm_hero_obs = new MutationObserver(function(muts) {
    muts.forEach(function(m) {
      if (m.attributeName === 'class') {
        if (utm_hero_slide.classList.contains('active')) {
          utm_hero_start();
        } else {
          utm_hero_stop();
        }
      }
    });
  });
  utm_hero_obs.observe(utm_hero_slide, { attributes: true });
  // Auto-start since s1 starts active
  if (utm_hero_slide.classList.contains('active')) utm_hero_start();
})();
</script>

<!-- ============================================================ -->
<!-- SLIDE 2: Big Picture -->
<!-- ============================================================ -->
<div class="slide" id="s2">
  <h1>The Big Picture</h1>
  <p class="subtitle">We've climbed the Chomsky hierarchy. Now we hit the ceiling.</p>

  <div class="diagram">
  The Chomsky Hierarchy of Power:

  Regular  -->  Context-Free  -->  Context-Sensitive  -->  Recursively Enumerable
   (DFA)          (PDA)              (LBA)                     (TM)
    |               |                  |                         |
    v               v                  v                         v
  Least          More               Even more              MOST POWERFUL
  powerful       powerful           powerful               machine possible
                                                                 |
                                                                 v
                                                       But is it ALL-powerful?
                                                       Can it solve EVERYTHING?
  </div>

  <div class="key-idea">
    <h3>Key Question</h3>
    <p>Turing machines are the most powerful computational model we know. But are there problems that even TMs <strong>cannot</strong> solve? The shocking answer is <strong>yes</strong> &mdash; and in fact, <em>most</em> problems are unsolvable.</p>
  </div>

  <div class="slide-number">2 / 21</div>
</div>

<!-- ============================================================ -->
<!-- SLIDE 3: Encoding Turing Machines -->
<!-- ============================================================ -->
<div class="slide" id="s3">
  <h1>Encoding Turing Machines</h1>
  <p class="subtitle">Any TM can be written down as a finite binary string.</p>

  <div class="two-col">
    <div>
      <h3>The Idea</h3>
      <p>A Turing machine M is defined by a finite set of components:</p>
      <ul>
        <li>States: q0, q1, ..., qn</li>
        <li>Tape alphabet: 0, 1, B</li>
        <li>Transitions: (state, symbol) -> (state, symbol, direction)</li>
        <li>Start, accept, reject states</li>
      </ul>
      <p class="mt">All of this is <strong>finite</strong>, so we can encode it as a binary string &lt;M&gt;.</p>
    </div>
    <div>
      <div class="utm-panel" style="padding:14px;">
        <svg id="utm_enc_svg" viewBox="0 0 380 310" style="width:100%;display:block;">
          <!-- TM definition box -->
          <rect x="10" y="5" width="360" height="105" rx="8" fill="#1e293b" stroke="#334155" stroke-width="1.5"/>
          <text x="190" y="24" text-anchor="middle" fill="#93c5fd" font-size="12" font-weight="700">Turing Machine M</text>
          <text id="utm_enc_states" x="20" y="44" fill="#e2e8f0" font-size="11" font-family="monospace">States: {q0, q1, q2}  Start: q0  Accept: q2</text>
          <text id="utm_enc_t1" x="20" y="64" fill="#e2e8f0" font-size="11" font-family="monospace">&delta;(q0,0) = (q1, 1, R)</text>
          <text id="utm_enc_t2" x="20" y="84" fill="#e2e8f0" font-size="11" font-family="monospace">&delta;(q1,1) = (q2, 0, L)</text>
          <text id="utm_enc_alpha" x="20" y="102" fill="#94a3b8" font-size="10" font-family="monospace">Alphabet: {0, 1, B}</text>
          <!-- Highlight overlays -->
          <rect id="utm_enc_hl" x="0" y="0" width="0" height="0" rx="4" fill="rgba(59,130,246,0.15)" stroke="#3b82f6" stroke-width="1" opacity="0"/>
          <!-- Arrow -->
          <line x1="190" y1="112" x2="190" y2="132" stroke="#64748b" stroke-width="1.5" stroke-dasharray="4"/>
          <polygon points="190,136 186,128 194,128" fill="#64748b"/>
          <!-- Encoding area -->
          <rect x="10" y="140" width="360" height="160" rx="8" fill="#0f172a" stroke="#334155" stroke-width="1"/>
          <text x="190" y="158" text-anchor="middle" fill="#f59e0b" font-size="12" font-weight="700">Encoding Steps</text>
          <text id="utm_enc_line1" x="20" y="180" fill="#94a3b8" font-size="11" font-family="monospace"></text>
          <text id="utm_enc_line2" x="20" y="200" fill="#94a3b8" font-size="11" font-family="monospace"></text>
          <text id="utm_enc_line3" x="20" y="220" fill="#94a3b8" font-size="11" font-family="monospace"></text>
          <text id="utm_enc_line4" x="20" y="244" fill="#94a3b8" font-size="11" font-family="monospace"></text>
          <text id="utm_enc_line5" x="20" y="268" fill="#10b981" font-size="12" font-family="monospace" font-weight="700"></text>
          <text id="utm_enc_line5b" x="20" y="286" fill="#10b981" font-size="11" font-family="monospace"></text>
        </svg>
        <div class="utm-controls" style="justify-content:center;">
          <button onclick="window.utm_enc_step()">Step</button>
          <button onclick="window.utm_enc_auto()">Auto</button>
          <button onclick="window.utm_enc_reset()">Reset</button>
        </div>
        <div class="utm-status" id="utm_enc_status" style="text-align:center;">Click Step to walk through encoding</div>
      </div>
    </div>
  </div>

  <div class="analogy">
    <h3>Analogy</h3>
    <p>Think of source code. A Python program is just a text file &mdash; a string of characters. Similarly, a Turing machine is just a string of bits. <strong>Programs are data.</strong> This is the insight that changes everything.</p>
  </div>

  <div class="slide-number">3 / 21</div>
</div>
<script>
(function() {
  var utm_enc_cur = 0;
  var utm_enc_timer = null;
  var utm_enc_maxSteps = 5;

  var utm_enc_data = [
    { status: 'Step 1: Encode states as binary codes',
      hl: { x:14, y:30, w:352, h:18 },
      lines: ['q0 = 00,  q1 = 01,  q2 = 10', 'Start = 00,  Accept = 10', '', '', '', ''] },
    { status: 'Step 2: Encode tape symbols',
      hl: { x:14, y:90, w:200, h:16 },
      lines: ['q0 = 00,  q1 = 01,  q2 = 10', 'Start = 00,  Accept = 10', '0 = 0,  1 = 1,  B = 11,  R = 0,  L = 1', '', '', ''] },
    { status: 'Step 3: Encode first transition \u03B4(q0,0)=(q1,1,R)',
      hl: { x:14, y:50, w:220, h:18 },
      lines: ['q0 = 00,  q1 = 01,  q2 = 10', '0 = 0,  1 = 1,  B = 11,  R = 0,  L = 1', '\u03B4(q0,0)=(q1,1,R) \u2192 00#0#01#1#0', '', '', ''] },
    { status: 'Step 4: Encode second transition \u03B4(q1,1)=(q2,0,L)',
      hl: { x:14, y:70, w:220, h:18 },
      lines: ['q0 = 00,  q1 = 01,  q2 = 10', '0 = 0,  1 = 1,  B = 11,  R = 0,  L = 1', '\u03B4(q0,0)=(q1,1,R) \u2192 00#0#01#1#0', '\u03B4(q1,1)=(q2,0,L) \u2192 01#1#10#0#1', '', ''] },
    { status: 'Step 5: Concatenate into final encoding \u27E8M\u27E9',
      hl: { x:0, y:0, w:0, h:0 },
      lines: ['q0 = 00,  q1 = 01,  q2 = 10', '0 = 0,  1 = 1,  B = 11', '00#0#01#1#0 ## 01#1#10#0#1', '', '\u27E8M\u27E9 = 00#10#00#0#01#1#0##01#1#10#0#1', 'It\'s just a string!'] }
  ];

  function utm_enc_render() {
    var d = (utm_enc_cur > 0) ? utm_enc_data[utm_enc_cur - 1] : null;
    var hl = document.getElementById('utm_enc_hl');
    if (d && d.hl.w > 0) {
      hl.setAttribute('x', d.hl.x); hl.setAttribute('y', d.hl.y);
      hl.setAttribute('width', d.hl.w); hl.setAttribute('height', d.hl.h);
      hl.setAttribute('opacity', '1');
    } else {
      hl.setAttribute('opacity', '0');
    }
    for (var i = 1; i <= 4; i++) {
      var el = document.getElementById('utm_enc_line' + i);
      el.textContent = d ? d.lines[i - 1] : '';
      el.setAttribute('fill', '#94a3b8');
    }
    var el5 = document.getElementById('utm_enc_line5');
    var el5b = document.getElementById('utm_enc_line5b');
    el5.textContent = d ? d.lines[4] : '';
    el5b.textContent = d ? d.lines[5] : '';
    document.getElementById('utm_enc_status').textContent = d ? d.status : 'Click Step to walk through encoding';
  }

  function utm_enc_step_fn() {
    if (utm_enc_cur < utm_enc_maxSteps) {
      utm_enc_cur++;
      utm_enc_render();
    }
  }

  function utm_enc_auto_fn() {
    utm_enc_reset_fn();
    var i = 0;
    utm_enc_timer = setInterval(function() {
      i++;
      if (i <= utm_enc_maxSteps) {
        utm_enc_cur = i;
        utm_enc_render();
      } else {
        clearInterval(utm_enc_timer); utm_enc_timer = null;
      }
    }, 1200);
  }

  function utm_enc_reset_fn() {
    if (utm_enc_timer) { clearInterval(utm_enc_timer); utm_enc_timer = null; }
    utm_enc_cur = 0;
    utm_enc_render();
  }

  window.utm_enc_step = utm_enc_step_fn;
  window.utm_enc_auto = utm_enc_auto_fn;
  window.utm_enc_reset = utm_enc_reset_fn;

  // MutationObserver
  var utm_enc_slide = document.getElementById('s3');
  var utm_enc_obs = new MutationObserver(function(muts) {
    muts.forEach(function(m) {
      if (m.attributeName === 'class') {
        if (!utm_enc_slide.classList.contains('active')) {
          utm_enc_reset_fn();
        }
      }
    });
  });
  utm_enc_obs.observe(utm_enc_slide, { attributes: true });
  utm_enc_render();
})();
</script>

<!-- ============================================================ -->
<!-- SLIDE 4: The Universal Turing Machine -->
<!-- ============================================================ -->
<div class="slide" id="s4">
  <h1>The Universal Turing Machine</h1>
  <p class="subtitle">One machine to simulate them all.</p>

  <div class="utm-panel" style="padding:16px;">
    <svg id="utm_flow_svg" viewBox="0 0 720 200" style="width:100%;max-width:720px;display:block;margin:0 auto;">
      <!-- Input box -->
      <rect x="10" y="60" width="120" height="80" rx="8" fill="#1e293b" stroke="#334155" stroke-width="1.5"/>
      <rect x="12" y="62" width="56" height="76" rx="6" fill="rgba(59,130,246,0.1)" stroke="#3b82f6" stroke-width="1"/>
      <text x="40" y="105" text-anchor="middle" fill="#93c5fd" font-size="13" font-weight="600">&lt;M&gt;</text>
      <rect x="72" y="62" width="56" height="76" rx="6" fill="rgba(245,158,11,0.1)" stroke="#f59e0b" stroke-width="1"/>
      <text x="100" y="105" text-anchor="middle" fill="#f59e0b" font-size="13" font-weight="600">w</text>
      <text x="70" y="52" text-anchor="middle" fill="#94a3b8" font-size="11">Input</text>

      <!-- Arrow input -> UTM -->
      <g id="utm_flow_arrow1">
        <line x1="132" y1="100" x2="195" y2="100" stroke="#475569" stroke-width="2" stroke-dasharray="6"/>
        <polygon points="200,100 192,95 192,105" fill="#475569"/>
        <!-- Animated data packet -->
        <circle id="utm_flow_packet1" cx="132" cy="100" r="5" fill="#3b82f6" opacity="0"/>
      </g>

      <!-- UTM box -->
      <rect id="utm_flow_box" x="200" y="30" width="280" height="140" rx="12" fill="#1e293b" stroke="#334155" stroke-width="2"/>
      <text x="340" y="56" text-anchor="middle" fill="#e2e8f0" font-size="14" font-weight="700">UNIVERSAL TURING MACHINE (U)</text>
      <text id="utm_flow_stage" x="340" y="100" text-anchor="middle" fill="#94a3b8" font-size="13" font-family="monospace"></text>
      <!-- Gear icon -->
      <g id="utm_flow_gear" transform="translate(340,130)" opacity="0">
        <circle cx="0" cy="0" r="10" fill="none" stroke="#f59e0b" stroke-width="2"/>
        <circle cx="0" cy="0" r="3" fill="#f59e0b"/>
        <line x1="0" y1="-12" x2="0" y2="-7" stroke="#f59e0b" stroke-width="2"/>
        <line x1="0" y1="7" x2="0" y2="12" stroke="#f59e0b" stroke-width="2"/>
        <line x1="-12" y1="0" x2="-7" y2="0" stroke="#f59e0b" stroke-width="2"/>
        <line x1="7" y1="0" x2="12" y2="0" stroke="#f59e0b" stroke-width="2"/>
      </g>

      <!-- Arrow UTM -> Output -->
      <g id="utm_flow_arrow2">
        <line x1="482" y1="100" x2="545" y2="100" stroke="#475569" stroke-width="2" stroke-dasharray="6"/>
        <polygon points="550,100 542,95 542,105" fill="#475569"/>
        <circle id="utm_flow_packet2" cx="482" cy="100" r="5" fill="#10b981" opacity="0"/>
      </g>

      <!-- Output box -->
      <rect x="550" y="55" width="160" height="90" rx="8" fill="#1e293b" stroke="#334155" stroke-width="1.5"/>
      <text x="630" y="77" text-anchor="middle" fill="#94a3b8" font-size="11">Output</text>
      <text id="utm_flow_out1" x="630" y="100" text-anchor="middle" fill="#94a3b8" font-size="12"></text>
      <text id="utm_flow_out2" x="630" y="120" text-anchor="middle" fill="#94a3b8" font-size="12"></text>
      <text id="utm_flow_out3" x="630" y="138" text-anchor="middle" fill="#94a3b8" font-size="11"></text>
    </svg>
    <div class="utm-controls" style="justify-content:center;">
      <button onclick="window.utm_flow_step()">Step</button>
      <button onclick="window.utm_flow_auto()">Auto</button>
      <button onclick="window.utm_flow_reset()">Reset</button>
    </div>
    <div class="utm-status" id="utm_flow_status" style="text-align:center;">Watch the UTM process an input</div>
  </div>

  <div class="key-idea" style="margin-top:12px;">
    <h3>Key Idea</h3>
    <p>The UTM U takes two inputs: the <strong>code of a TM</strong> &lt;M&gt; and an <strong>input string</strong> w. It then simulates M running on w. Whatever M would do, U does the same thing. It is a <strong>universal simulator</strong>.</p>
  </div>

  <div class="analogy">
    <h3>Analogy</h3>
    <p>The UTM is an <strong>interpreter</strong>. Just like the Python interpreter reads a .py file and executes it, the UTM reads the encoding of a TM and executes it. Or think of it as an <strong>emulator</strong> &mdash; like running a Game Boy game on your PC.</p>
  </div>

  <div class="slide-number">4 / 21</div>
</div>
<script>
(function() {
  var utm_flow_cur = 0;
  var utm_flow_timer = null;
  var utm_flow_autoTimer = null;
  var utm_flow_maxSteps = 4;
  var utm_flow_outcomeIdx = 0;
  var utm_flow_outcomes = [
    { t1: 'M accepts w', t2: '\u2192 U accepts', t3: '', c: '#10b981' },
    { t1: 'M rejects w', t2: '\u2192 U rejects', t3: '', c: '#ef4444' },
    { t1: 'M loops on w', t2: '\u2192 U loops too', t3: '', c: '#f59e0b' }
  ];

  function utm_flow_render() {
    var box = document.getElementById('utm_flow_box');
    var stage = document.getElementById('utm_flow_stage');
    var gear = document.getElementById('utm_flow_gear');
    var p1 = document.getElementById('utm_flow_packet1');
    var p2 = document.getElementById('utm_flow_packet2');
    var o1 = document.getElementById('utm_flow_out1');
    var o2 = document.getElementById('utm_flow_out2');
    var o3 = document.getElementById('utm_flow_out3');
    var status = document.getElementById('utm_flow_status');
    if (!box) return;

    // Reset everything
    box.setAttribute('stroke', '#334155');
    stage.textContent = '';
    stage.setAttribute('fill', '#94a3b8');
    gear.setAttribute('opacity', '0');
    gear.style.animation = '';
    p1.setAttribute('opacity', '0');
    p2.setAttribute('opacity', '0');
    o1.textContent = ''; o2.textContent = ''; o3.textContent = '';
    o1.setAttribute('fill', '#94a3b8');
    o2.setAttribute('fill', '#94a3b8');

    if (utm_flow_cur === 0) {
      status.textContent = 'Watch the UTM process an input';
      return;
    }
    if (utm_flow_cur >= 1) {
      // Stage 1: Reading <M>
      box.setAttribute('stroke', '#3b82f6');
      stage.textContent = '1. Reading \u27E8M\u27E9...';
      stage.setAttribute('fill', '#93c5fd');
      p1.setAttribute('opacity', '1');
      p1.setAttribute('cx', '170');
      p1.setAttribute('fill', '#3b82f6');
      status.textContent = 'UTM reads the encoding of M to learn its transition function';
    }
    if (utm_flow_cur >= 2) {
      // Stage 2: Simulating
      box.setAttribute('stroke', '#f59e0b');
      stage.textContent = '2. Simulating M on w...';
      stage.setAttribute('fill', '#f59e0b');
      p1.setAttribute('opacity', '0');
      gear.setAttribute('opacity', '1');
      gear.style.animation = 'utm_spin 2s linear infinite';
      status.textContent = 'UTM executes M step-by-step on input w';
    }
    if (utm_flow_cur >= 3) {
      // Stage 3: Result
      var oc = utm_flow_outcomes[utm_flow_outcomeIdx];
      box.setAttribute('stroke', oc.c);
      stage.textContent = '3. Result!';
      stage.setAttribute('fill', oc.c);
      gear.setAttribute('opacity', '0');
      gear.style.animation = '';
      p2.setAttribute('opacity', '1');
      p2.setAttribute('cx', '520');
      p2.setAttribute('fill', oc.c);
      o1.textContent = oc.t1;
      o1.setAttribute('fill', oc.c);
      o2.textContent = oc.t2;
      o2.setAttribute('fill', oc.c);
      status.textContent = 'UTM produces the same result as M would on w';
    }
    if (utm_flow_cur >= 4) {
      // Cycle outcome for next run
      utm_flow_outcomeIdx = (utm_flow_outcomeIdx + 1) % utm_flow_outcomes.length;
    }
  }

  function utm_flow_step_fn() {
    if (utm_flow_cur < utm_flow_maxSteps) {
      utm_flow_cur++;
      utm_flow_render();
    }
  }

  function utm_flow_auto_fn() {
    utm_flow_reset_fn();
    var step = 0;
    utm_flow_autoTimer = setInterval(function() {
      step++;
      if (step <= 3) {
        utm_flow_cur = step;
        utm_flow_render();
      } else if (step === 5) {
        utm_flow_outcomeIdx = (utm_flow_outcomeIdx + 1) % utm_flow_outcomes.length;
        utm_flow_cur = 0;
        utm_flow_render();
        step = 0;
      }
    }, 1200);
  }

  function utm_flow_reset_fn() {
    if (utm_flow_timer) { clearInterval(utm_flow_timer); utm_flow_timer = null; }
    if (utm_flow_autoTimer) { clearInterval(utm_flow_autoTimer); utm_flow_autoTimer = null; }
    utm_flow_cur = 0;
    utm_flow_render();
  }

  window.utm_flow_step = utm_flow_step_fn;
  window.utm_flow_auto = utm_flow_auto_fn;
  window.utm_flow_reset = utm_flow_reset_fn;

  // MutationObserver
  var utm_flow_slide = document.getElementById('s4');
  var utm_flow_obs = new MutationObserver(function(muts) {
    muts.forEach(function(m) {
      if (m.attributeName === 'class') {
        if (!utm_flow_slide.classList.contains('active')) {
          utm_flow_reset_fn();
        }
      }
    });
  });
  utm_flow_obs.observe(utm_flow_slide, { attributes: true });
  utm_flow_render();
})();
</script>

<!-- ============================================================ -->
<!-- SLIDE 5: How the UTM Works -->
<!-- ============================================================ -->
<div class="slide" id="s5">
  <h1>How the UTM Works</h1>
  <p class="subtitle">Three-tape simulation, step by step.</p>

  <div class="utm-panel" id="utm_3t_panel">
    <svg id="utm_3t_svg" viewBox="0 0 650 210" style="width:100%;max-width:650px;display:block;margin:0 auto;">
      <!-- Tape 1: Work tape -->
      <text x="10" y="22" fill="#93c5fd" font-size="11" font-weight="600">TAPE 1: M's work tape</text>
      <g id="utm_3t_tape1"></g>
      <polygon id="utm_3t_head1" points="0,-6 6,6 -6,6" fill="#3b82f6" transform="translate(80,58)"/>
      <!-- Tape 2: Transitions -->
      <text x="10" y="87" fill="#f59e0b" font-size="11" font-weight="600">TAPE 2: M's transitions (read-only)</text>
      <g id="utm_3t_tape2"></g>
      <!-- Tape 3: State -->
      <text x="10" y="155" fill="#10b981" font-size="11" font-weight="600">TAPE 3: M's current state</text>
      <g id="utm_3t_tape3"></g>
    </svg>
    <div class="utm-controls" style="justify-content:center;">
      <button onclick="utm_3t_step()">Step</button>
      <button onclick="utm_3t_auto()">Auto</button>
      <button onclick="utm_3t_reset()">Reset</button>
      <span id="utm_3t_counter" style="color:#64748b;font-size:13px;padding:6px 8px;">Step 0 / 4</span>
    </div>
    <div class="utm-status" id="utm_3t_status" style="text-align:center;">Ready to simulate M on "011"</div>
  </div>

  <div class="two-col">
    <div>
      <h3>Simulation Loop</h3>
      <ol style="padding-left:24px;">
        <li>Read current state from Tape 3</li>
        <li>Read current symbol from Tape 1 (at head position)</li>
        <li>Look up (state, symbol) in Tape 2 to find the transition</li>
        <li>Write new symbol on Tape 1</li>
        <li>Move head on Tape 1 (L or R)</li>
        <li>Update state on Tape 3</li>
        <li>If new state is accept/reject, halt accordingly. Otherwise, repeat.</li>
      </ol>
    </div>
    <div>
      <div class="warning">
        <h3>Important Detail</h3>
        <p>The UTM uses 3 tapes for clarity, but we know any multi-tape TM can be converted to a single-tape TM. So a UTM can be a <strong>single-tape</strong> machine. It's just slower.</p>
      </div>
      <div class="key-idea">
        <h3>Key Idea</h3>
        <p>The UTM is itself a Turing machine &mdash; it has a finite number of states and a finite transition function. The "program" it runs is on its <em>tape</em>, not in its states.</p>
      </div>
    </div>
  </div>

  <div class="slide-number">5 / 21</div>
</div>

<!-- ============================================================ -->
<!-- SLIDE 6: UTM = Programmable Computer -->
<!-- ============================================================ -->
<div class="slide" id="s6">
  <h1>UTM = Programmable Computer</h1>
  <p class="subtitle">The birth of the stored-program concept.</p>

  <div class="two-col">
    <div>
      <div class="utm-controls" style="justify-content:center; margin-bottom:8px;">
        <button id="utm_prog_beforeBtn" class="active" onclick="window.utm_prog_mode('before')">Before UTM</button>
        <button id="utm_prog_afterBtn" onclick="window.utm_prog_mode('after')">After UTM</button>
        <button id="utm_prog_demoBtn" onclick="window.utm_prog_demo()">Auto Demo</button>
      </div>
      <div class="utm-panel" style="padding:12px; min-height:310px;">
        <svg id="utm_prog_svg" viewBox="0 0 380 290" style="width:100%;display:block;">
          <!-- Before mode: 3 separate machines -->
          <g id="utm_prog_before">
            <text x="190" y="20" text-anchor="middle" fill="#94a3b8" font-size="12" font-weight="600">One machine per task = new hardware each time</text>
            <!-- Machine A -->
            <rect x="10" y="35" width="108" height="100" rx="8" fill="#1e293b" stroke="#3b82f6" stroke-width="2"/>
            <text x="64" y="58" text-anchor="middle" fill="#93c5fd" font-size="11" font-weight="600">Machine A</text>
            <rect x="24" y="66" width="80" height="24" rx="4" fill="rgba(59,130,246,0.1)" stroke="#3b82f6" stroke-width="1"/>
            <text x="64" y="83" text-anchor="middle" fill="#93c5fd" font-size="10" font-family="monospace">Task A</text>
            <text x="64" y="105" text-anchor="middle" fill="#64748b" font-size="9">hardwired</text>
            <text x="64" y="125" text-anchor="middle" fill="#3b82f6" font-size="10">\u2192 Does task A</text>
            <!-- Machine B -->
            <rect x="136" y="35" width="108" height="100" rx="8" fill="#1e293b" stroke="#f59e0b" stroke-width="2"/>
            <text x="190" y="58" text-anchor="middle" fill="#f59e0b" font-size="11" font-weight="600">Machine B</text>
            <rect x="150" y="66" width="80" height="24" rx="4" fill="rgba(245,158,11,0.1)" stroke="#f59e0b" stroke-width="1"/>
            <text x="190" y="83" text-anchor="middle" fill="#f59e0b" font-size="10" font-family="monospace">Task B</text>
            <text x="190" y="105" text-anchor="middle" fill="#64748b" font-size="9">hardwired</text>
            <text x="190" y="125" text-anchor="middle" fill="#f59e0b" font-size="10">\u2192 Does task B</text>
            <!-- Machine C -->
            <rect x="262" y="35" width="108" height="100" rx="8" fill="#1e293b" stroke="#10b981" stroke-width="2"/>
            <text x="316" y="58" text-anchor="middle" fill="#10b981" font-size="11" font-weight="600">Machine C</text>
            <rect x="276" y="66" width="80" height="24" rx="4" fill="rgba(16,185,129,0.1)" stroke="#10b981" stroke-width="1"/>
            <text x="316" y="83" text-anchor="middle" fill="#10b981" font-size="10" font-family="monospace">Task C</text>
            <text x="316" y="105" text-anchor="middle" fill="#64748b" font-size="9">hardwired</text>
            <text x="316" y="125" text-anchor="middle" fill="#10b981" font-size="10">\u2192 Does task C</text>
            <!-- Label -->
            <text x="190" y="160" text-anchor="middle" fill="#ef4444" font-size="12" font-weight="600">Need new hardware for each task!</text>
            <!-- Cost illustration -->
            <text x="190" y="182" text-anchor="middle" fill="#94a3b8" font-size="11">3 tasks = 3 machines = 3x the cost</text>
          </g>
          <!-- After mode: 1 universal machine -->
          <g id="utm_prog_after" opacity="0">
            <text x="190" y="20" text-anchor="middle" fill="#94a3b8" font-size="12" font-weight="600">One machine + different programs = universal</text>
            <!-- Universal machine box -->
            <rect x="100" y="80" width="180" height="110" rx="10" fill="#1e293b" stroke="#8b5cf6" stroke-width="2.5"/>
            <text x="190" y="105" text-anchor="middle" fill="#e2e8f0" font-size="13" font-weight="700">UNIVERSAL</text>
            <text x="190" y="122" text-anchor="middle" fill="#e2e8f0" font-size="13" font-weight="700">MACHINE</text>
            <!-- Program slot -->
            <rect id="utm_prog_slot" x="130" y="135" width="120" height="28" rx="5" fill="#0f172a" stroke="#475569" stroke-width="1" stroke-dasharray="4"/>
            <text id="utm_prog_slotTxt" x="190" y="154" text-anchor="middle" fill="#64748b" font-size="10" font-family="monospace">[ program slot ]</text>
            <!-- Program cards (start off-screen left) -->
            <g id="utm_prog_cardA" opacity="0">
              <rect x="10" y="40" width="70" height="30" rx="5" fill="rgba(59,130,246,0.2)" stroke="#3b82f6" stroke-width="1.5"/>
              <text x="45" y="60" text-anchor="middle" fill="#93c5fd" font-size="11" font-weight="600">Prog A</text>
            </g>
            <g id="utm_prog_cardB" opacity="0">
              <rect x="10" y="40" width="70" height="30" rx="5" fill="rgba(245,158,11,0.2)" stroke="#f59e0b" stroke-width="1.5"/>
              <text x="45" y="60" text-anchor="middle" fill="#f59e0b" font-size="11" font-weight="600">Prog B</text>
            </g>
            <g id="utm_prog_cardC" opacity="0">
              <rect x="10" y="40" width="70" height="30" rx="5" fill="rgba(16,185,129,0.2)" stroke="#10b981" stroke-width="1.5"/>
              <text x="45" y="60" text-anchor="middle" fill="#10b981" font-size="11" font-weight="600">Prog C</text>
            </g>
            <!-- Output label -->
            <text id="utm_prog_output" x="190" y="215" text-anchor="middle" fill="#94a3b8" font-size="12" font-weight="600"></text>
            <!-- Bottom label -->
            <text x="190" y="245" text-anchor="middle" fill="#10b981" font-size="12" font-weight="600">Same hardware, different software!</text>
            <text x="190" y="265" text-anchor="middle" fill="#94a3b8" font-size="11">1 machine = infinite tasks</text>
          </g>
        </svg>
      </div>
    </div>
    <div>
      <h3>Historical Significance</h3>
      <p>Alan Turing described the UTM in <strong>1936</strong>, over a decade before real computers existed.</p>
      <p>The UTM is the theoretical foundation of:</p>
      <ul>
        <li><strong>Stored-program computers</strong> (von Neumann architecture)</li>
        <li>The <strong>software/hardware distinction</strong></li>
        <li><strong>Interpreters and compilers</strong></li>
        <li><strong>Operating systems</strong> (they load and run arbitrary programs)</li>
      </ul>

      <div class="key-idea">
        <h3>Key Idea</h3>
        <p>The UTM tells us: <strong>you only need one machine</strong>. You don't need different hardware for every task. One universal machine + different programs = all computable functions.</p>
      </div>
    </div>
  </div>

  <div class="slide-number">6 / 21</div>
</div>
<script>
(function() {
  var utm_prog_currentMode = 'before';
  var utm_prog_demoTimer = null;
  var utm_prog_animTimers = [];
  var utm_prog_programs = [
    { id: 'A', card: 'utm_prog_cardA', color: '#93c5fd', label: '\u2192 Does task A' },
    { id: 'B', card: 'utm_prog_cardB', color: '#f59e0b', label: '\u2192 Does task B' },
    { id: 'C', card: 'utm_prog_cardC', color: '#10b981', label: '\u2192 Does task C' }
  ];

  function utm_prog_setMode(mode) {
    utm_prog_currentMode = mode;
    var before = document.getElementById('utm_prog_before');
    var after = document.getElementById('utm_prog_after');
    var bBtn = document.getElementById('utm_prog_beforeBtn');
    var aBtn = document.getElementById('utm_prog_afterBtn');
    if (!before) return;

    if (mode === 'before') {
      before.setAttribute('opacity', '1');
      after.setAttribute('opacity', '0');
      bBtn.classList.add('active');
      aBtn.classList.remove('active');
    } else {
      before.setAttribute('opacity', '0');
      after.setAttribute('opacity', '1');
      bBtn.classList.remove('active');
      aBtn.classList.add('active');
      // Reset cards
      utm_prog_programs.forEach(function(p) {
        var el = document.getElementById(p.card);
        el.setAttribute('opacity', '0');
        el.setAttribute('transform', '');
      });
      document.getElementById('utm_prog_slotTxt').textContent = '[ program slot ]';
      document.getElementById('utm_prog_slotTxt').setAttribute('fill', '#64748b');
      document.getElementById('utm_prog_slot').setAttribute('stroke', '#475569');
      document.getElementById('utm_prog_output').textContent = '';
    }
  }

  function utm_prog_loadProgram(idx, callback) {
    var p = utm_prog_programs[idx];
    var card = document.getElementById(p.card);
    var slot = document.getElementById('utm_prog_slot');
    var slotTxt = document.getElementById('utm_prog_slotTxt');
    var output = document.getElementById('utm_prog_output');

    // Reset all cards
    utm_prog_programs.forEach(function(pp) {
      document.getElementById(pp.card).setAttribute('opacity', '0');
      document.getElementById(pp.card).setAttribute('transform', '');
    });

    // Show and animate card sliding to slot
    card.setAttribute('opacity', '1');
    var frames = 12;
    var startX = 0, endX = 100;
    var startY = 0, endY = 95;
    var frame = 0;
    function animate() {
      frame++;
      var t = frame / frames;
      t = t * t * (3 - 2 * t); // smoothstep
      var cx = startX + (endX - startX) * t;
      var cy = startY + (endY - startY) * t;
      card.setAttribute('transform', 'translate('+cx+','+cy+')');
      if (frame < frames) {
        var tid = requestAnimationFrame(animate);
        utm_prog_animTimers.push(tid);
      } else {
        // Card arrived at slot
        card.setAttribute('opacity', '0.3');
        slotTxt.textContent = 'Program ' + p.id;
        slotTxt.setAttribute('fill', p.color);
        slot.setAttribute('stroke', p.color);
        slot.setAttribute('stroke-dasharray', '');
        output.textContent = p.label;
        output.setAttribute('fill', p.color);
        if (callback) {
          var tid2 = setTimeout(callback, 1000);
          utm_prog_animTimers.push(tid2);
        }
      }
    }
    animate();
  }

  function utm_prog_demo_fn() {
    utm_prog_clearTimers();
    utm_prog_setMode('after');
    var step = 0;
    function nextStep() {
      if (step < 3) {
        utm_prog_loadProgram(step, function() {
          step++;
          var tid = setTimeout(nextStep, 800);
          utm_prog_animTimers.push(tid);
        });
      }
    }
    var tid = setTimeout(nextStep, 500);
    utm_prog_animTimers.push(tid);
  }

  function utm_prog_clearTimers() {
    if (utm_prog_demoTimer) { clearInterval(utm_prog_demoTimer); utm_prog_demoTimer = null; }
    utm_prog_animTimers.forEach(function(t) {
      clearTimeout(t);
      cancelAnimationFrame(t);
    });
    utm_prog_animTimers = [];
  }

  function utm_prog_mode_fn(mode) {
    utm_prog_clearTimers();
    utm_prog_setMode(mode);
  }

  window.utm_prog_mode = utm_prog_mode_fn;
  window.utm_prog_demo = utm_prog_demo_fn;

  // MutationObserver
  var utm_prog_slide = document.getElementById('s6');
  var utm_prog_obs = new MutationObserver(function(muts) {
    muts.forEach(function(m) {
      if (m.attributeName === 'class') {
        if (!utm_prog_slide.classList.contains('active')) {
          utm_prog_clearTimers();
          utm_prog_setMode('before');
        }
      }
    });
  });
  utm_prog_obs.observe(utm_prog_slide, { attributes: true });
})();
</script>

<!-- ============================================================ -->
<!-- SLIDE 7: Diagonalization Counting Argument -->
<!-- ============================================================ -->
<div class="slide" id="s7">
  <h1>Diagonalization: The Counting Argument</h1>
  <p class="subtitle">There are more problems than programs. Way more.</p>

  <div class="two-col">
    <div>
      <h3>Turing Machines are Countable</h3>
      <p>Every TM is a finite binary string. We can list all binary strings in order:</p>
      <div class="diagram small">
  String #1:  0
  String #2:  1
  String #3:  00
  String #4:  01
  String #5:  10
  String #6:  11
  String #7:  000
  ...

  Some are valid TM encodings,
  some are garbage. Either way:
  COUNTABLY many TMs.

  |TMs| = |N| = aleph-0
      </div>
    </div>
    <div>
      <h3>Languages are Uncountable</h3>
      <p>A language over {0,1} is any subset of {0,1}*. Each language corresponds to a function f: {0,1}* -> {yes, no}.</p>
      <div class="diagram small">
  For each string, independently
  choose IN or OUT:

  String:  0  1  00 01 10 11 ...
  Lang A:  Y  N  Y  N  Y  N  ...
  Lang B:  N  N  N  Y  Y  Y  ...
  Lang C:  Y  Y  Y  Y  N  N  ...
  ...

  Each row is an infinite binary
  sequence. By Cantor's argument:
  UNCOUNTABLY many languages.

  |Languages| = |R| = 2^(aleph-0)
      </div>
    </div>
  </div>

  <div class="utm-panel" id="utm_cnt_panel">
    <h3 style="color:#a5b4fc;margin-bottom:10px;font-size:1.1em;">Explore the Counting Argument</h3>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:20px;">
      <div>
        <h3 style="color:#93c5fd;font-size:1em;">TMs (Countable)</h3>
        <div id="utm_cnt_tms" style="max-height:120px;overflow-y:auto;background:#0f172a;border-radius:6px;padding:8px;font-size:0.85em;font-family:monospace;color:#a5f3fc;"></div>
        <p id="utm_cnt_tm_count" style="font-size:0.85em;color:#64748b;margin:4px 0;">20 TMs listed</p>
        <button class="utm-btn" onclick="utm_cnt_addTMs()" style="font-size:0.8em;">Add More</button>
      </div>
      <div>
        <h3 style="color:#f59e0b;font-size:1em;">Languages (Uncountable)</h3>
        <div id="utm_cnt_langs" style="max-height:120px;overflow-y:auto;background:#0f172a;border-radius:6px;padding:8px;font-size:0.85em;font-family:monospace;"></div>
        <div style="display:flex;gap:6px;margin-top:4px;">
          <button class="utm-btn" onclick="utm_cnt_addLang()" style="font-size:0.8em;">Generate Random Language</button>
          <button class="utm-btn" id="utm_cnt_diagBtn" onclick="utm_cnt_diagonalize()" style="font-size:0.8em;display:none;">Diagonalize!</button>
        </div>
        <div id="utm_cnt_result" class="utm-status" style="font-size:0.85em;"></div>
      </div>
    </div>
  </div>

  <div class="warning">
    <h3>The Devastating Conclusion</h3>
    <p>Countably many TMs, uncountably many languages. So <strong>most languages have no TM that recognizes them</strong>. Almost all problems are unsolvable! The solvable problems are a vanishingly tiny fraction of all problems.</p>
  </div>

  <div class="slide-number">7 / 21</div>
</div>

<!-- ============================================================ -->
<!-- SLIDE 8: The Diagonalization Language L_d -->
<!-- ============================================================ -->
<div class="slide" id="s8">
  <h1>The Diagonalization Language L<sub>d</sub></h1>
  <p class="subtitle">A specific language that NO Turing machine can recognize.</p>

  <p>Enumerate all TMs as M1, M2, M3, ... and all strings as w1, w2, w3, ...</p>
  <p>Build a table: entry (i, j) = 1 if Mi accepts wj, and 0 otherwise.</p>

  <div class="utm-panel" id="utm_diag_panel">
    <div style="display:flex;align-items:start;gap:16px;flex-wrap:wrap;">
      <div>
        <div style="display:inline-block;">
          <div style="display:flex;">
            <div class="utm_diag_header" style="width:44px;"></div>
            <div class="utm_diag_header">w1</div><div class="utm_diag_header">w2</div><div class="utm_diag_header">w3</div><div class="utm_diag_header">w4</div><div class="utm_diag_header">w5</div><div class="utm_diag_header">w6</div>
          </div>
          <div id="utm_diag_grid"></div>
        </div>
        <div class="utm-controls" style="margin-top:8px;">
          <button onclick="utm_diag_randomFill()">Random Fill</button>
          <button id="utm_diag_showBtn" onclick="utm_diag_showDiag()" disabled>Show Diagonal</button>
          <button id="utm_diag_buildBtn" onclick="utm_diag_buildLd()" disabled>Build L<sub>d</sub></button>
          <button id="utm_diag_proveBtn" onclick="utm_diag_prove()" disabled>Prove It's New</button>
        </div>
      </div>
      <div id="utm_diag_output" style="flex:1;min-width:200px;font-size:0.95em;color:#94a3b8;"></div>
    </div>
  </div>

  <div class="key-idea">
    <h3>Key Idea</h3>
    <p>L<sub>d</sub> is defined by looking at the <strong>diagonal</strong> of the table and <strong>flipping</strong> every bit. String w<sub>i</sub> is in L<sub>d</sub> if and only if machine M<sub>i</sub> does <strong>not</strong> accept w<sub>i</sub>. This is the same trick Cantor used to prove the reals are uncountable!</p>
  </div>

  <div class="slide-number">8 / 21</div>
</div>

<!-- ============================================================ -->
<!-- SLIDE 9: L_d is Not RE -->
<!-- ============================================================ -->
<div class="slide" id="s9">
  <h1>L<sub>d</sub> is Not Recursively Enumerable</h1>
  <p class="subtitle">No TM can even recognize L<sub>d</sub> &mdash; not even if we allow it to loop forever on non-members.</p>

  <div class="two-col">
    <div>
      <h3>Proof by Contradiction</h3>
      <ol style="padding-left:24px;">
        <li><strong>Assume</strong> some TM M<sub>j</sub> recognizes L<sub>d</sub>.</li>
        <li>Then M<sub>j</sub> appears somewhere in our enumeration &mdash; it's the j-th machine.</li>
        <li><strong>Ask:</strong> Is w<sub>j</sub> in L<sub>d</sub>?</li>
        <li><strong>Case 1:</strong> w<sub>j</sub> is in L<sub>d</sub>
          <ul><li>By definition of L<sub>d</sub>: M<sub>j</sub> does NOT accept w<sub>j</sub></li>
          <li>But M<sub>j</sub> recognizes L<sub>d</sub>, so it should accept w<sub>j</sub></li>
          <li><strong>Contradiction!</strong></li></ul>
        </li>
        <li><strong>Case 2:</strong> w<sub>j</sub> is NOT in L<sub>d</sub>
          <ul><li>By definition of L<sub>d</sub>: M<sub>j</sub> DOES accept w<sub>j</sub></li>
          <li>But M<sub>j</sub> recognizes L<sub>d</sub>, so it should not accept w<sub>j</sub></li>
          <li><strong>Contradiction!</strong></li></ul>
        </li>
      </ol>
    </div>
    <div>
      <div class="diagram small">
  If Mj recognizes L_d:

  wj in L_d?
      |
      +-- YES --> Mj does NOT accept wj
      |           (by def of L_d)
      |           But Mj recognizes L_d,
      |           so Mj SHOULD accept wj
      |           CONTRADICTION!
      |
      +-- NO  --> Mj DOES accept wj
                  (by def of L_d)
                  But Mj recognizes L_d,
                  so Mj should NOT accept wj
                  CONTRADICTION!

  Both cases lead to contradiction.
  Therefore, no such Mj exists.
      </div>

      <div class="warning">
        <h3>What This Means</h3>
        <p>L<sub>d</sub> is not just undecidable &mdash; it is not even <strong>recognizable</strong>. No TM of any kind can recognize it, even one that is allowed to loop forever on strings not in the language.</p>
      </div>
    </div>
  </div>

  <div class="slide-number">9 / 21</div>
</div>

<!-- ============================================================ -->
<!-- SLIDE 10: The Halting Problem -->
<!-- ============================================================ -->
<div class="slide" id="s10">
  <h1>The Halting Problem</h1>
  <p class="subtitle">The most famous undecidable problem in computer science.</p>

  <div class="key-idea">
    <h3>Definition</h3>
    <p>The <strong>Halting Problem</strong> is the language:<br>
    <strong>HALT = { &lt;M, w&gt; | M is a TM and M halts on input w }</strong><br>
    That is: given a program and an input, does the program eventually stop?</p>
  </div>

  <div class="two-col">
    <div>
      <h3 style="color:#a5b4fc;margin-bottom:8px;">Can YOU Be the Halt Decider?</h3>
      <div class="utm-panel" id="utm_halt_viewer" style="padding:0;overflow:hidden;">
        <svg id="utm_halt_svg" viewBox="0 0 420 200" style="width:100%;display:block;">
          <!-- Program viewer box -->
          <rect x="10" y="10" width="400" height="130" rx="10" fill="#0f172a" stroke="#334155" stroke-width="1.5"/>
          <text x="20" y="32" fill="#64748b" font-size="11" font-family="monospace">// Program <tspan id="utm_halt_prognum" fill="#93c5fd">1</tspan> of 5</text>
          <line x1="10" y1="40" x2="410" y2="40" stroke="#334155" stroke-width="1"/>
          <!-- Code lines rendered here -->
          <text id="utm_halt_code1" x="24" y="64" fill="#a5f3fc" font-size="13" font-family="'SF Mono','Fira Code','Consolas',monospace"></text>
          <text id="utm_halt_code2" x="24" y="84" fill="#a5f3fc" font-size="13" font-family="'SF Mono','Fira Code','Consolas',monospace"></text>
          <text id="utm_halt_code3" x="24" y="104" fill="#a5f3fc" font-size="13" font-family="'SF Mono','Fira Code','Consolas',monospace"></text>
          <text id="utm_halt_code4" x="24" y="124" fill="#a5f3fc" font-size="13" font-family="'SF Mono','Fira Code','Consolas',monospace"></text>
          <!-- Feedback overlay -->
          <g id="utm_halt_feedback" opacity="0">
            <rect id="utm_halt_fb_bg" x="110" y="55" width="200" height="50" rx="10"/>
            <text id="utm_halt_fb_txt" x="210" y="86" text-anchor="middle" font-size="18" font-weight="700"></text>
          </g>
          <!-- Score bar -->
          <rect x="10" y="150" width="400" height="40" rx="8" fill="#1e293b" stroke="#334155" stroke-width="1"/>
          <text id="utm_halt_score" x="20" y="175" fill="#94a3b8" font-size="12">Score: 0 / 0</text>
          <text id="utm_halt_hint" x="400" y="175" text-anchor="end" fill="#64748b" font-size="11"></text>
        </svg>
      </div>
      <div class="utm-controls" id="utm_halt_btns">
        <button id="utm_halt_halts_btn" onclick="window.utm_halt_guess('halts')" style="background:rgba(16,185,129,0.2);border-color:#10b981;color:#10b981;font-weight:600;">HALTS</button>
        <button id="utm_halt_loops_btn" onclick="window.utm_halt_guess('loops')" style="background:rgba(239,68,68,0.2);border-color:#ef4444;color:#ef4444;font-weight:600;">LOOPS</button>
        <button id="utm_halt_next_btn" onclick="window.utm_halt_next()" style="display:none;">Next Program &rarr;</button>
        <button onclick="window.utm_halt_reset()">Reset</button>
      </div>
      <div class="utm-status" id="utm_halt_status">Decide: does this program halt or loop forever?</div>
    </div>
    <div>
      <h3>Why It Matters</h3>
      <p>If we could solve the Halting Problem, we could:</p>
      <ul>
        <li>Build a <strong>perfect debugger</strong> that catches all infinite loops</li>
        <li>Verify that <strong>any program terminates</strong></li>
        <li>Solve <strong>Goldbach's conjecture</strong> and many open math problems</li>
        <li>Build a <strong>perfect virus scanner</strong></li>
      </ul>
      <p class="mt">But we <strong>cannot</strong>. And the proof is elegant.</p>
    </div>
  </div>

  <div class="analogy">
    <h3>Analogy</h3>
    <p>Imagine you're a fortune teller who claims to predict the future of any machine. Someone hands you a description of a machine designed specifically to <strong>do the opposite of whatever you predict</strong>. You're stuck &mdash; you can't be right no matter what you say.</p>
  </div>

  <div class="slide-number">10 / 21</div>
</div>
<script>
(function() {
  /* === Slide 10: Halting Problem Explorer === */
  var utm_halt_programs = [
    { code: ['while (true) {', '  // do nothing', '}'], answer: 'loops', label: 'LOOPS FOREVER', explanation: 'Classic infinite loop — never terminates.' },
    { code: ['x = 5;', 'return x;'], answer: 'halts', label: 'HALTS', explanation: 'Simple assignment and return — always terminates.' },
    { code: ['while (n > 1) {', '  if (n%2 == 0) n = n/2;', '  else n = 3*n + 1;', '}'], answer: 'unknown', label: 'UNKNOWN!', explanation: 'Collatz conjecture — unproven for all n. Nobody knows if this always halts!' },
    { code: ['for (i=2; i<N; i++)', '  if (isPrime(i) &&', '      isPrime(i+2))', '    count++;'], answer: 'halts', label: 'HALTS', explanation: 'Bounded loop up to N — always terminates regardless of how many twin primes exist.' },
    { code: ['// Search for even number', '// > 2 that is NOT the', '// sum of two primes', '// (Goldbach conjecture)'], answer: 'unknown', label: 'UNKNOWN!', explanation: 'Goldbach\'s conjecture is unproven. No algorithm can decide this in general!' }
  ];
  var utm_halt_idx = 0, utm_halt_score = 0, utm_halt_total = 0, utm_halt_done = false;

  function utm_halt_showProgram() {
    var p = utm_halt_programs[utm_halt_idx];
    document.getElementById('utm_halt_prognum').textContent = (utm_halt_idx + 1);
    for (var i = 1; i <= 4; i++) {
      var el = document.getElementById('utm_halt_code' + i);
      el.textContent = (p.code[i-1] || '');
    }
    document.getElementById('utm_halt_feedback').setAttribute('opacity', '0');
    document.getElementById('utm_halt_halts_btn').disabled = false;
    document.getElementById('utm_halt_loops_btn').disabled = false;
    document.getElementById('utm_halt_next_btn').style.display = 'none';
    document.getElementById('utm_halt_score').textContent = 'Score: ' + utm_halt_score + ' / ' + utm_halt_total;
    document.getElementById('utm_halt_hint').textContent = '';
    if (utm_halt_done) {
      document.getElementById('utm_halt_status').textContent = 'Decide: does this program halt or loop forever?';
      utm_halt_done = false;
    }
  }

  function utm_halt_guess(answer) {
    if (utm_halt_done) return;
    var p = utm_halt_programs[utm_halt_idx];
    document.getElementById('utm_halt_halts_btn').disabled = true;
    document.getElementById('utm_halt_loops_btn').disabled = true;

    var correct = false;
    var fbG = document.getElementById('utm_halt_feedback');
    var fbBg = document.getElementById('utm_halt_fb_bg');
    var fbTxt = document.getElementById('utm_halt_fb_txt');

    if (p.answer === 'unknown') {
      // Unknown — special case
      fbBg.setAttribute('fill', 'rgba(245,158,11,0.9)');
      fbBg.setAttribute('stroke', '#f59e0b');
      fbBg.setAttribute('stroke-width', '2');
      fbTxt.setAttribute('fill', '#0f172a');
      fbTxt.textContent = 'UNKNOWN!';
      correct = false; // no points for unknown
      document.getElementById('utm_halt_hint').textContent = 'Nobody knows!';
    } else if (answer === p.answer) {
      correct = true;
      utm_halt_score++;
      fbBg.setAttribute('fill', 'rgba(16,185,129,0.9)');
      fbBg.setAttribute('stroke', '#10b981');
      fbBg.setAttribute('stroke-width', '2');
      fbTxt.setAttribute('fill', '#0f172a');
      fbTxt.textContent = 'CORRECT!';
    } else {
      fbBg.setAttribute('fill', 'rgba(239,68,68,0.9)');
      fbBg.setAttribute('stroke', '#ef4444');
      fbBg.setAttribute('stroke-width', '2');
      fbTxt.setAttribute('fill', '#fff');
      fbTxt.textContent = 'WRONG — ' + p.label;
    }
    utm_halt_total++;
    fbG.setAttribute('opacity', '1');
    document.getElementById('utm_halt_score').textContent = 'Score: ' + utm_halt_score + ' / ' + utm_halt_total;
    document.getElementById('utm_halt_status').textContent = p.explanation;

    if (utm_halt_idx < utm_halt_programs.length - 1) {
      document.getElementById('utm_halt_next_btn').style.display = '';
    } else {
      // All done — show final message
      utm_halt_done = true;
      setTimeout(function() {
        var unknowns = 0;
        utm_halt_programs.forEach(function(pr) { if (pr.answer === 'unknown') unknowns++; });
        document.getElementById('utm_halt_status').innerHTML =
          '<strong>Final score: ' + utm_halt_score + '/' + (utm_halt_total - unknowns) + ' (on decidable programs).</strong> ' +
          'Programs 3 and 5 are problems <span style="color:#f59e0b;font-weight:600;">no algorithm can reliably solve</span> either!';
      }, 1200);
    }
  }

  function utm_halt_next() {
    if (utm_halt_idx < utm_halt_programs.length - 1) {
      utm_halt_idx++;
      utm_halt_showProgram();
      document.getElementById('utm_halt_status').textContent = 'Decide: does this program halt or loop forever?';
    }
  }

  function utm_halt_reset() {
    utm_halt_idx = 0;
    utm_halt_score = 0;
    utm_halt_total = 0;
    utm_halt_done = false;
    utm_halt_showProgram();
    document.getElementById('utm_halt_status').textContent = 'Decide: does this program halt or loop forever?';
  }

  // Expose to window
  window.utm_halt_guess = utm_halt_guess;
  window.utm_halt_next = utm_halt_next;
  window.utm_halt_reset = utm_halt_reset;

  // MutationObserver — reinit when slide becomes active
  var utm_halt_slide = document.getElementById('s10');
  var utm_halt_obs = new MutationObserver(function(muts) {
    muts.forEach(function(m) {
      if (m.attributeName === 'class' && utm_halt_slide.classList.contains('active')) {
        utm_halt_showProgram();
      }
    });
  });
  utm_halt_obs.observe(utm_halt_slide, { attributes: true });
  utm_halt_showProgram();
})();
</script>

<!-- ============================================================ -->
<!-- SLIDE 11: Proving the Halting Problem is Undecidable -->
<!-- ============================================================ -->
<div class="slide" id="s11">
  <h1>Proof: Halting is Undecidable</h1>
  <p class="subtitle">A careful, step-by-step proof by contradiction.</p>

  <h3>Step 1: Assume HALT is decidable</h3>
  <p>Suppose there exists a TM H that decides HALT. That is, H(&lt;M, w&gt;) = accept if M halts on w, and H(&lt;M, w&gt;) = reject if M loops on w. H <strong>always halts</strong> with the correct answer.</p>

  <div class="diagram small">
   &lt;M, w&gt; ----> +-----+
                | H   |----> "accept" (M halts on w)
                |     |----> "reject" (M loops on w)
                +-----+
                H always halts. H is never wrong. (assumption)
  </div>

  <h3>Step 2: Build a new machine D (the "Diagonal" machine)</h3>
  <p>Using H as a subroutine, construct D that takes input &lt;M&gt; (the code of a TM) and does:</p>

  <div class="diagram small">
  D(&lt;M&gt;):
    1. Run H(&lt;M, &lt;M&gt;&gt;)         -- ask "does M halt when given its own code as input?"
    2. If H says "accept":      -- M halts on &lt;M&gt;
         D enters an infinite loop (D does NOT halt)
    3. If H says "reject":      -- M loops on &lt;M&gt;
         D halts and accepts
  </div>

  <div class="key-idea">
    <h3>Key Insight</h3>
    <p>D does the <strong>opposite</strong> of what M does on its own code. If M halts on &lt;M&gt;, then D loops. If M loops on &lt;M&gt;, then D halts. This is the setup for the contradiction on the next slide.</p>
  </div>

  <div class="utm-panel">
    <svg id="utm_hp_svg" viewBox="0 0 600 140" style="width:100%;max-width:600px;display:block;margin:0 auto;">
      <!-- H box -->
      <rect id="utm_hp_hbox" x="40" y="30" width="120" height="70" rx="10" fill="none" stroke="#3b82f6" stroke-width="2" opacity="0.3"/>
      <text id="utm_hp_hlabel" x="100" y="70" text-anchor="middle" fill="#93c5fd" font-size="16" font-weight="600" opacity="0.3">H</text>
      <!-- Arrow into H -->
      <line id="utm_hp_arrin" x1="0" y1="65" x2="38" y2="65" stroke="#475569" stroke-width="1.5" marker-end="url(#utm_hp_arrow)" opacity="0"/>
      <text id="utm_hp_inlabel" x="4" y="56" fill="#94a3b8" font-size="10" opacity="0">&lt;M, w&gt;</text>
      <!-- Arrows out of H -->
      <line id="utm_hp_accout" x1="162" y1="50" x2="220" y2="40" stroke="#475569" stroke-width="1.5" marker-end="url(#utm_hp_arrow)" opacity="0"/>
      <text id="utm_hp_acclabel" x="225" y="43" fill="#10b981" font-size="11" opacity="0">accept</text>
      <line id="utm_hp_rejout" x1="162" y1="80" x2="220" y2="90" stroke="#475569" stroke-width="1.5" marker-end="url(#utm_hp_arrow)" opacity="0"/>
      <text id="utm_hp_rejlabel" x="225" y="93" fill="#ef4444" font-size="11" opacity="0">reject</text>
      <!-- D box -->
      <rect id="utm_hp_dbox" x="300" y="20" width="160" height="90" rx="10" fill="none" stroke="#8b5cf6" stroke-width="2" opacity="0"/>
      <text id="utm_hp_dlabel" x="380" y="48" text-anchor="middle" fill="#a5b4fc" font-size="14" font-weight="600" opacity="0">D</text>
      <!-- Small H inside D -->
      <rect id="utm_hp_hsmall" x="330" y="58" width="50" height="30" rx="5" fill="none" stroke="#3b82f6" stroke-width="1.5" opacity="0"/>
      <text id="utm_hp_hsmlabel" x="355" y="77" text-anchor="middle" fill="#93c5fd" font-size="10" opacity="0">H</text>
      <!-- D outputs -->
      <text id="utm_hp_dout1" x="400" y="72" fill="#ef4444" font-size="9" opacity="0">H→acc: LOOP</text>
      <text id="utm_hp_dout2" x="400" y="84" fill="#10b981" font-size="9" opacity="0">H→rej: ACCEPT</text>
      <!-- Arrow marker -->
      <defs><marker id="utm_hp_arrow" viewBox="0 0 10 10" refX="10" refY="5" markerWidth="6" markerHeight="6" orient="auto-start-reverse"><path d="M 0 0 L 10 5 L 0 10 z" fill="#94a3b8"/></marker></defs>
    </svg>
    <div class="utm-controls" style="justify-content:center;">
      <button onclick="utm_hp_step()">Step</button>
      <button onclick="utm_hp_auto()">Auto</button>
      <button onclick="utm_hp_reset()">Reset</button>
      <span id="utm_hp_counter" style="color:#64748b;font-size:13px;padding:6px;">Step 0 / 3</span>
    </div>
    <div class="utm-status" id="utm_hp_status" style="text-align:center;">Click Step to build the proof</div>
  </div>

  <div class="slide-number">11 / 21</div>
</div>

<!-- ============================================================ -->
<!-- SLIDE 12: The Paradox Machine -->
<!-- ============================================================ -->
<div class="slide" id="s12">
  <h1>The Paradox: D on Its Own Code</h1>
  <p class="subtitle">What happens when we feed D its own encoding?</p>

  <h3>Step 3: Run D(&lt;D&gt;) &mdash; feed D to itself</h3>

  <div class="diagram">
  D(&lt;D&gt;):
    1. Run H(&lt;D, &lt;D&gt;&gt;)         -- "Does D halt on &lt;D&gt;?"
    2. If H says "accept":      -- H claims D halts on &lt;D&gt;
         D loops forever         -- but then D does NOT halt! H was WRONG!
    3. If H says "reject":      -- H claims D loops on &lt;D&gt;
         D halts and accepts     -- but then D DOES halt! H was WRONG!

  +==========================================================+
  |                                                          |
  |   CASE A: D halts on &lt;D&gt;                                |
  |     --> H says "accept"                                  |
  |     --> D enters infinite loop                           |
  |     --> D does NOT halt on &lt;D&gt;    CONTRADICTION!         |
  |                                                          |
  |   CASE B: D does not halt on &lt;D&gt;                        |
  |     --> H says "reject"                                  |
  |     --> D halts and accepts                              |
  |     --> D DOES halt on &lt;D&gt;        CONTRADICTION!         |
  |                                                          |
  |   Both cases are impossible.                             |
  |   Therefore our assumption that H exists must be FALSE.  |
  |                                                          |
  +==========================================================+
  </div>

  <div class="utm-panel" id="utm_par_panel">
    <div class="utm-controls" style="justify-content:center;">
      <button onclick="utm_par_run('A')" id="utm_par_btnA">Case A: D halts on &lt;D&gt;</button>
      <button onclick="utm_par_run('B')" id="utm_par_btnB">Case B: D loops on &lt;D&gt;</button>
      <button onclick="utm_par_reset()" style="margin-left:12px;">Reset</button>
    </div>
    <div id="utm_par_steps" style="min-height:100px;"></div>
    <div id="utm_par_conclusion" class="utm-status" style="text-align:center;font-weight:600;"></div>
  </div>

  <div class="warning">
    <h3>The Conclusion</h3>
    <p>No TM H can decide the Halting Problem. It is <strong>undecidable</strong>. This is not a limitation of our current technology &mdash; it is a fundamental <strong>mathematical impossibility</strong>.</p>
  </div>

  <div class="analogy">
    <h3>Analogy: The Barber Paradox</h3>
    <p>"A barber shaves everyone who doesn't shave themselves." Who shaves the barber? If he does, he doesn't. If he doesn't, he does. Same structure: <strong>self-reference + negation = paradox</strong>.</p>
  </div>

  <div class="slide-number">12 / 21</div>
</div>

<!-- ============================================================ -->
<!-- SLIDE 13: Consequences of Undecidability -->
<!-- ============================================================ -->
<div class="slide" id="s13">
  <h1>Consequences of Undecidability</h1>
  <p class="subtitle">What we can NEVER build, no matter how smart we get.</p>

  <div class="two-col">
    <div>
      <h3>Impossible Programs</h3>
      <ul>
        <li><strong>Perfect Debugger:</strong> No tool can detect all infinite loops in arbitrary programs</li>
        <li><strong>Perfect Virus Scanner:</strong> Cannot determine if arbitrary code is malicious</li>
        <li><strong>Perfect Optimizer:</strong> Cannot determine if two programs compute the same function</li>
        <li><strong>Perfect Verifier:</strong> Cannot determine if a program meets an arbitrary specification</li>
        <li><strong>Perfect Type Checker:</strong> Cannot determine all type errors in a sufficiently expressive language</li>
      </ul>
    </div>
    <div>
      <div class="diagram small">
  Real-world impact:

  Compiler: "Will this loop
             terminate?"
  Answer:   "Undecidable."

  Antivirus: "Is this program
              malicious?"
  Answer:    "Undecidable in
              general."

  Verifier: "Does this code
             match the spec?"
  Answer:   "Undecidable in
             general."
      </div>
      <div class="warning">
        <h3>But We Still Write Debuggers!</h3>
        <p>We can't solve these problems <em>in general</em>, but we CAN solve them for <em>specific cases</em>. Real tools use heuristics, approximations, and restricted inputs. They work <em>most of the time</em> but can never be <em>perfect</em>.</p>
      </div>
    </div>
  </div>

  <div class="slide-number">13 / 21</div>
</div>

<!-- ============================================================ -->
<!-- SLIDE 14: Reductions -->
<!-- ============================================================ -->
<div class="slide" id="s14">
  <h1>Reductions</h1>
  <p class="subtitle">Proving new problems undecidable by "reducing" from known undecidable problems.</p>

  <div class="diagram">
  THE IDEA: "If you could solve Problem B, you could solve Problem A."

  If A is known to be undecidable, then B must be undecidable too!

  +-------------------+          +-------------------+
  | Problem A         |  reduce  | Problem B         |
  | (known            | -------> | (want to prove    |
  |  undecidable)     |          |  undecidable)     |
  +-------------------+          +-------------------+
        HALT                          New Problem

  Reduction = a computable transformation:
  instance of A  ---f--->  instance of B
  such that: A says "yes"  iff  B says "yes"
  </div>

  <div class="two-col">
    <div>
      <div class="key-idea">
        <h3>Proof Pattern</h3>
        <ol style="padding-left:24px;">
          <li>Want to prove problem B is undecidable</li>
          <li>Assume (for contradiction) B is decidable</li>
          <li>Show how to use a decider for B to decide HALT</li>
          <li>But HALT is undecidable &mdash; contradiction!</li>
          <li>Therefore B is undecidable</li>
        </ol>
      </div>
    </div>
    <div>
      <div class="utm-panel">
        <svg id="utm_red_svg" viewBox="0 0 350 200" style="width:100%;max-width:350px;display:block;margin:0 auto;">
          <defs><marker id="utm_red_arrow" viewBox="0 0 10 10" refX="10" refY="5" markerWidth="6" markerHeight="6" orient="auto-start-reverse"><path d="M 0 0 L 10 5 L 0 10 z" fill="#94a3b8"/></marker></defs>
          <!-- Box A: HALT -->
          <rect x="10" y="20" width="90" height="40" rx="6" fill="none" stroke="#ef4444" stroke-width="2"/>
          <text x="55" y="45" text-anchor="middle" fill="#ef4444" font-size="13" font-weight="600">HALT</text>
          <!-- Arrow: reduce -->
          <line x1="102" y1="40" x2="138" y2="40" stroke="#94a3b8" stroke-width="1.5" marker-end="url(#utm_red_arrow)"/>
          <text x="120" y="33" text-anchor="middle" fill="#64748b" font-size="9">reduce</text>
          <!-- Box: Transform f -->
          <rect x="140" y="20" width="80" height="40" rx="6" fill="none" stroke="#f59e0b" stroke-width="2"/>
          <text x="180" y="45" text-anchor="middle" fill="#f59e0b" font-size="11" font-weight="600">Transform f</text>
          <!-- Arrow -->
          <line x1="222" y1="40" x2="248" y2="40" stroke="#94a3b8" stroke-width="1.5" marker-end="url(#utm_red_arrow)"/>
          <!-- Box B: New Problem -->
          <rect id="utm_red_bbox" x="250" y="10" width="90" height="55" rx="6" fill="none" stroke="#3b82f6" stroke-width="2"/>
          <text id="utm_red_blabel" x="295" y="35" text-anchor="middle" fill="#93c5fd" font-size="11" font-weight="600">New</text>
          <text id="utm_red_blabel2" x="295" y="50" text-anchor="middle" fill="#93c5fd" font-size="11" font-weight="600">Problem</text>
          <!-- Arrow down -->
          <line x1="295" y1="67" x2="295" y2="88" stroke="#94a3b8" stroke-width="1.5" marker-end="url(#utm_red_arrow)"/>
          <!-- Decider for B (dashed) -->
          <rect x="250" y="90" width="90" height="40" rx="6" fill="none" stroke="#475569" stroke-width="1.5" stroke-dasharray="5,3"/>
          <text x="295" y="113" text-anchor="middle" fill="#64748b" font-size="10">Decider for B?</text>
          <!-- Arrow down -->
          <line x1="295" y1="132" x2="295" y2="150" stroke="#94a3b8" stroke-width="1.5" marker-end="url(#utm_red_arrow)"/>
          <text x="295" y="165" text-anchor="middle" fill="#94a3b8" font-size="11">yes / no</text>
          <!-- Curved arrow back -->
          <path d="M 295,170 Q 295,195 175,195 Q 55,195 55,62" fill="none" stroke="#ef4444" stroke-width="1.5" stroke-dasharray="4,3" marker-end="url(#utm_red_arrow)"/>
          <text x="175" y="190" text-anchor="middle" fill="#ef4444" font-size="9" font-weight="600">Decides HALT! Contradiction!</text>
        </svg>
        <div class="utm-controls" style="justify-content:center;">
          <button onclick="utm_red_select(0)" class="active" id="utm_red_b0">HALT -> E_TM</button>
          <button onclick="utm_red_select(1)" id="utm_red_b1">HALT -> EQ_TM</button>
          <button onclick="utm_red_select(2)" id="utm_red_b2">HALT -> ALL_TM</button>
        </div>
        <div class="utm-status" id="utm_red_desc" style="text-align:center;">E_TM: "Is L(M) empty?" Build M' that accepts everything iff M halts on w.</div>
      </div>
    </div>
  </div>

  <div class="slide-number">14 / 21</div>
</div>

<!-- ============================================================ -->
<!-- SLIDE 15: Reduction Example: E_TM -->
<!-- ============================================================ -->
<div class="slide" id="s15">
  <h1>Reduction Example: Is L(M) Empty?</h1>
  <p class="subtitle">E<sub>TM</sub> = { &lt;M&gt; | L(M) = empty set }. Is this decidable?</p>

  <div class="two-col">
    <div>
      <h3>Proof: E<sub>TM</sub> is Undecidable</h3>
      <ol style="padding-left:24px;">
        <li><strong>Assume</strong> we have a decider R for E<sub>TM</sub>.</li>
        <li>Given &lt;M, w&gt;, build a <strong>new TM M'</strong>:
          <div class="diagram small" style="margin:10px 0;">
  M'(x):
    1. Ignore x entirely
    2. Run M on w
    3. If M accepts w, accept x
       (otherwise M' loops/rejects)
          </div>
        </li>
        <li><strong>Observe:</strong>
          <ul>
            <li>If M accepts w: M' accepts everything, so L(M') = Sigma* (not empty)</li>
            <li>If M does not accept w: M' accepts nothing, so L(M') = empty</li>
          </ul>
        </li>
        <li>Run R(&lt;M'&gt;):
          <ul>
            <li>R says "L(M') is empty" iff M does not accept w</li>
            <li>R says "L(M') is not empty" iff M accepts w</li>
          </ul>
        </li>
        <li>This decides whether M accepts w &mdash; that's the Halting Problem!</li>
      </ol>
    </div>
    <div>
      <h3 style="color:#a5b4fc;margin-bottom:8px;">Reduction Flow (animated)</h3>
      <div class="utm-panel" style="padding:8px;">
        <svg id="utm_etm_svg" viewBox="0 0 500 400" style="width:100%;display:block;">
          <defs>
            <marker id="utm_etm_arrow" viewBox="0 0 10 10" refX="10" refY="5" markerWidth="7" markerHeight="7" orient="auto-start-reverse">
              <path d="M 0 0 L 10 5 L 0 10 z" fill="#94a3b8"/>
            </marker>
            <marker id="utm_etm_arrow_blue" viewBox="0 0 10 10" refX="10" refY="5" markerWidth="7" markerHeight="7" orient="auto-start-reverse">
              <path d="M 0 0 L 10 5 L 0 10 z" fill="#93c5fd"/>
            </marker>
            <filter id="utm_etm_glow_blue">
              <feGaussianBlur stdDeviation="3" result="blur"/>
              <feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge>
            </filter>
            <filter id="utm_etm_glow_amber">
              <feGaussianBlur stdDeviation="3" result="blur"/>
              <feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge>
            </filter>
            <filter id="utm_etm_glow_red">
              <feGaussianBlur stdDeviation="4" result="blur"/>
              <feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge>
            </filter>
          </defs>

          <!-- Step 1: Input box -->
          <g id="utm_etm_s1" opacity="0">
            <rect x="170" y="10" width="160" height="44" rx="10" fill="#0f172a" stroke="#3b82f6" stroke-width="2" id="utm_etm_inputbox"/>
            <text x="250" y="37" text-anchor="middle" fill="#93c5fd" font-size="16" font-weight="700">&langle;M, w&rangle;</text>
          </g>

          <!-- Step 2: Arrow down + M' box -->
          <g id="utm_etm_s2" opacity="0">
            <line x1="250" y1="56" x2="250" y2="90" stroke="#94a3b8" stroke-width="1.5" marker-end="url(#utm_etm_arrow)"/>
            <text x="278" y="78" fill="#64748b" font-size="10">construct</text>
            <rect x="140" y="92" width="220" height="70" rx="10" fill="#1e293b" stroke="#8b5cf6" stroke-width="2" id="utm_etm_mpbox"/>
            <text x="250" y="113" text-anchor="middle" fill="#a5b4fc" font-size="14" font-weight="700">M'</text>
            <text x="250" y="131" text-anchor="middle" fill="#94a3b8" font-size="10">M'(x): ignore x, run M on w,</text>
            <text x="250" y="145" text-anchor="middle" fill="#94a3b8" font-size="10">accept if M does</text>
          </g>

          <!-- Step 3: Arrow down + R box -->
          <g id="utm_etm_s3" opacity="0">
            <line x1="250" y1="164" x2="250" y2="198" stroke="#94a3b8" stroke-width="1.5" marker-end="url(#utm_etm_arrow)"/>
            <text x="278" y="186" fill="#64748b" font-size="10">feed &langle;M'&rangle; to R</text>
            <rect x="170" y="200" width="160" height="56" rx="10" fill="#1e293b" stroke="#f59e0b" stroke-width="2" id="utm_etm_rbox"/>
            <text x="250" y="224" text-anchor="middle" fill="#f59e0b" font-size="14" font-weight="700">R</text>
            <text x="250" y="242" text-anchor="middle" fill="#94a3b8" font-size="10">(assumed E_TM decider)</text>
          </g>

          <!-- Step 4: Two output arrows -->
          <g id="utm_etm_s4" opacity="0">
            <!-- Left arrow: "empty" -->
            <line x1="195" y1="258" x2="110" y2="300" stroke="#ef4444" stroke-width="1.8" marker-end="url(#utm_etm_arrow)"/>
            <rect x="30" y="302" width="160" height="36" rx="8" fill="rgba(239,68,68,0.1)" stroke="#ef4444" stroke-width="1.5"/>
            <text x="110" y="325" text-anchor="middle" fill="#ef4444" font-size="12" font-weight="600">"L(M') is empty"</text>
            <!-- Right arrow: "not empty" -->
            <line x1="305" y1="258" x2="390" y2="300" stroke="#10b981" stroke-width="1.8" marker-end="url(#utm_etm_arrow)"/>
            <rect x="310" y="302" width="160" height="36" rx="8" fill="rgba(16,185,129,0.1)" stroke="#10b981" stroke-width="1.5"/>
            <text x="390" y="325" text-anchor="middle" fill="#10b981" font-size="12" font-weight="600">"L(M') is NOT empty"</text>
          </g>

          <!-- Step 5: Meaning labels -->
          <g id="utm_etm_s5" opacity="0">
            <text x="110" y="354" text-anchor="middle" fill="#ef4444" font-size="11">&rarr; M does NOT accept w</text>
            <text x="390" y="354" text-anchor="middle" fill="#10b981" font-size="11">&rarr; M DOES accept w</text>
            <text x="250" y="374" text-anchor="middle" fill="#93c5fd" font-size="12" font-weight="600">We just decided A_TM! (acceptance)</text>
          </g>

          <!-- Step 6: Contradiction badge -->
          <g id="utm_etm_s6" opacity="0">
            <rect x="115" y="382" width="270" height="40" rx="12" fill="rgba(239,68,68,0.2)" stroke="#ef4444" stroke-width="2.5" id="utm_etm_contra_bg"/>
            <text x="250" y="407" text-anchor="middle" fill="#ef4444" font-size="16" font-weight="800" id="utm_etm_contra_txt">CONTRADICTION!</text>
          </g>
        </svg>
      </div>
      <div class="utm-controls" style="justify-content:center;">
        <button onclick="window.utm_etm_step()">Step</button>
        <button onclick="window.utm_etm_auto()" id="utm_etm_auto_btn">Auto</button>
        <button onclick="window.utm_etm_reset()">Reset</button>
        <span id="utm_etm_counter" style="color:#64748b;font-size:13px;padding:6px;">Step 0 / 6</span>
      </div>
      <div class="utm-status" id="utm_etm_status" style="text-align:center;">Click Step to walk through the reduction proof.</div>
    </div>
  </div>

  <div class="slide-number">15 / 21</div>
</div>
<script>
(function() {
  /* === Slide 15: E_TM Reduction Step-Through === */
  var utm_etm_cur = 0;
  var utm_etm_max = 6;
  var utm_etm_autoTimer = null;

  var utm_etm_messages = [
    'Click Step to walk through the reduction proof.',
    'Step 1: We have input \u27E8M, w\u27E9 — a TM and a string. We want to know: does M accept w?',
    'Step 2: Construct a new TM M\u2032 that ignores its input, runs M on w, and accepts if M does.',
    'Step 3: Feed \u27E8M\u2032\u27E9 to R, the assumed decider for E_TM. R analyzes whether L(M\u2032) is empty...',
    'Step 4: R outputs its decision — either L(M\u2032) is empty, or it\'s not empty.',
    'Step 5: But this tells us whether M accepts w! If empty \u2192 M doesn\'t accept. If not empty \u2192 M accepts.',
    'Step 6: We just decided A_TM using R — but A_TM is undecidable! R cannot exist. \u2234 E_TM is undecidable.'
  ];

  // Which proof steps (1-indexed li items) to highlight at each animation step
  var utm_etm_proofHighlight = [[], [1], [2], [3], [4], [4,5], [5]];

  function utm_etm_render() {
    for (var i = 1; i <= utm_etm_max; i++) {
      var g = document.getElementById('utm_etm_s' + i);
      if (g) g.setAttribute('opacity', i <= utm_etm_cur ? '1' : '0');
    }

    // Glow effects on current step
    var inputBox = document.getElementById('utm_etm_inputbox');
    var mpBox = document.getElementById('utm_etm_mpbox');
    var rBox = document.getElementById('utm_etm_rbox');
    if (inputBox) inputBox.removeAttribute('filter');
    if (mpBox) mpBox.removeAttribute('filter');
    if (rBox) rBox.removeAttribute('filter');

    if (utm_etm_cur === 1 && inputBox) inputBox.setAttribute('filter', 'url(#utm_etm_glow_blue)');
    if (utm_etm_cur === 2 && mpBox) mpBox.setAttribute('filter', 'url(#utm_etm_glow_blue)');
    if (utm_etm_cur === 3 && rBox) rBox.setAttribute('filter', 'url(#utm_etm_glow_amber)');

    // Contradiction flash
    var contraBg = document.getElementById('utm_etm_contra_bg');
    if (utm_etm_cur === 6 && contraBg) {
      contraBg.style.animation = 'utm_pulse 1s ease-in-out infinite';
    } else if (contraBg) {
      contraBg.style.animation = '';
    }

    // Highlight proof steps on left
    var proofOl = document.querySelector('#s15 .two-col > div:first-child ol');
    if (proofOl) {
      var lis = proofOl.querySelectorAll('li');
      var toHL = utm_etm_proofHighlight[utm_etm_cur] || [];
      for (var j = 0; j < lis.length; j++) {
        if (toHL.indexOf(j + 1) !== -1) {
          lis[j].style.background = 'rgba(59,130,246,0.12)';
          lis[j].style.borderRadius = '6px';
          lis[j].style.padding = '4px 6px';
        } else {
          lis[j].style.background = '';
          lis[j].style.borderRadius = '';
          lis[j].style.padding = '';
        }
      }
    }

    document.getElementById('utm_etm_counter').textContent = 'Step ' + utm_etm_cur + ' / ' + utm_etm_max;
    document.getElementById('utm_etm_status').textContent = utm_etm_messages[utm_etm_cur];
  }

  function utm_etm_step() {
    if (utm_etm_cur < utm_etm_max) {
      utm_etm_cur++;
      utm_etm_render();
    }
  }

  function utm_etm_auto() {
    if (utm_etm_autoTimer) {
      clearInterval(utm_etm_autoTimer);
      utm_etm_autoTimer = null;
      document.getElementById('utm_etm_auto_btn').textContent = 'Auto';
      return;
    }
    document.getElementById('utm_etm_auto_btn').textContent = 'Pause';
    utm_etm_autoTimer = setInterval(function() {
      if (utm_etm_cur < utm_etm_max) {
        utm_etm_cur++;
        utm_etm_render();
      } else {
        clearInterval(utm_etm_autoTimer);
        utm_etm_autoTimer = null;
        document.getElementById('utm_etm_auto_btn').textContent = 'Auto';
      }
    }, 1200);
  }

  function utm_etm_reset() {
    if (utm_etm_autoTimer) { clearInterval(utm_etm_autoTimer); utm_etm_autoTimer = null; }
    document.getElementById('utm_etm_auto_btn').textContent = 'Auto';
    utm_etm_cur = 0;
    utm_etm_render();
  }

  window.utm_etm_step = utm_etm_step;
  window.utm_etm_auto = utm_etm_auto;
  window.utm_etm_reset = utm_etm_reset;

  // MutationObserver
  var utm_etm_slide = document.getElementById('s15');
  var utm_etm_obs = new MutationObserver(function(muts) {
    muts.forEach(function(m) {
      if (m.attributeName === 'class') {
        if (utm_etm_slide.classList.contains('active')) {
          utm_etm_render();
        } else {
          // Cleanup timers when leaving
          if (utm_etm_autoTimer) { clearInterval(utm_etm_autoTimer); utm_etm_autoTimer = null; }
          document.getElementById('utm_etm_auto_btn').textContent = 'Auto';
        }
      }
    });
  });
  utm_etm_obs.observe(utm_etm_slide, { attributes: true });
  utm_etm_render();
})();
</script>

<!-- ============================================================ -->
<!-- SLIDE 16: Rice's Theorem -->
<!-- ============================================================ -->
<div class="slide" id="s16">
  <h1>Rice's Theorem</h1>
  <p class="subtitle">The nuclear weapon of undecidability results.</p>

  <div class="key-idea">
    <h3>Rice's Theorem (1953)</h3>
    <p>Every <strong>non-trivial</strong> property of the <strong>language recognized by a Turing machine</strong> is <strong>undecidable</strong>.</p>
  </div>

  <div class="two-col">
    <div>
      <h3>What does "non-trivial" mean?</h3>
      <p>A property P of languages is <strong>non-trivial</strong> if:</p>
      <ul>
        <li>At least one TM has a language satisfying P</li>
        <li>At least one TM has a language NOT satisfying P</li>
      </ul>
      <p>In other words, the property is not always-true or always-false.</p>

      <h3 class="mt">What does "property of the language" mean?</h3>
      <p>It depends only on <strong>what the TM computes</strong> (its language), not <strong>how</strong> it computes it (its structure).</p>
    </div>
    <div>
      <div class="diagram small">
  "Is L(M) ____?"

  +---------------------------+--------+
  | Property                  | Decide |
  |                           | -able? |
  +---------------------------+--------+
  | L(M) is empty?            |   NO   |
  | L(M) is finite?           |   NO   |
  | L(M) is regular?          |   NO   |
  | L(M) is context-free?     |   NO   |
  | L(M) = Sigma*?            |   NO   |
  | L(M) contains "hello"?    |   NO   |
  | L(M) = some specific L?   |   NO   |
  +---------------------------+--------+
  | L(M) is RE?               |  YES*  |
  |  (*trivial: always true!) |        |
  +---------------------------+--------+

  ANY interesting question about
  what a TM computes is undecidable.
      </div>
    </div>
  </div>

  <div class="utm-panel" id="utm_rice_panel">
    <h3 style="color:#a5b4fc;font-size:1.05em;margin-bottom:8px;">Rice's Theorem Quick Checker</h3>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;" id="utm_rice_props">
      <div class="utm_rice_prop" onclick="utm_rice_check(0)">Is L(M) empty?</div>
      <div class="utm_rice_prop" onclick="utm_rice_check(1)">Is L(M) finite?</div>
      <div class="utm_rice_prop" onclick="utm_rice_check(2)">Does M have exactly 5 states?</div>
      <div class="utm_rice_prop" onclick="utm_rice_check(3)">Is L(M) = {0<sup>n</sup>1<sup>n</sup>}?</div>
      <div class="utm_rice_prop" onclick="utm_rice_check(4)">Does M ever move left?</div>
      <div class="utm_rice_prop" onclick="utm_rice_check(5)">Is L(M) context-free?</div>
    </div>
    <div id="utm_rice_result" style="margin-top:10px;min-height:70px;"></div>
  </div>

  <div class="analogy">
    <h3>Analogy</h3>
    <p>Imagine you're told: "You can never determine ANY interesting fact about what a program outputs, just by looking at the program." That's Rice's Theorem. You can ask about the code's <em>structure</em> (how many lines? what variables?), but you can't determine anything about its <em>behavior</em>.</p>
  </div>

  <div class="slide-number">16 / 21</div>
</div>

<!-- ============================================================ -->
<!-- SLIDE 17: Rice's Theorem Examples -->
<!-- ============================================================ -->
<div class="slide" id="s17">
  <h1>Rice's Theorem: Examples</h1>
  <p class="subtitle">All of these questions are undecidable. All of them.</p>

  <div class="two-col">
    <div>
      <h3>Undecidable (by Rice's)</h3>
      <table>
        <tr><th>Question</th><th>Property of L(M)?</th><th>Non-trivial?</th></tr>
        <tr><td style="text-align:left;">Is L(M) = empty set?</td><td>Yes</td><td>Yes</td></tr>
        <tr><td style="text-align:left;">Is L(M) finite?</td><td>Yes</td><td>Yes</td></tr>
        <tr><td style="text-align:left;">Is L(M) regular?</td><td>Yes</td><td>Yes</td></tr>
        <tr><td style="text-align:left;">Is L(M) context-free?</td><td>Yes</td><td>Yes</td></tr>
        <tr><td style="text-align:left;">Is L(M) = {0^n 1^n}?</td><td>Yes</td><td>Yes</td></tr>
        <tr><td style="text-align:left;">Is L(M) = Sigma*?</td><td>Yes</td><td>Yes</td></tr>
        <tr><td style="text-align:left;">Does L(M) contain ""?</td><td>Yes</td><td>Yes</td></tr>
      </table>
    </div>
    <div>
      <h3>NOT covered by Rice's</h3>
      <p>Rice's does NOT apply to:</p>
      <ul>
        <li>Properties of the <strong>TM itself</strong> (not its language):
          <ul>
            <li>"Does M have exactly 5 states?" (decidable)</li>
            <li>"Does M ever move left?" (decidable)</li>
          </ul>
        </li>
        <li><strong>Trivial</strong> properties:
          <ul>
            <li>"Is L(M) RE?" (trivially true for all TMs)</li>
            <li>"Is L(M) a set of strings?" (trivially true)</li>
          </ul>
        </li>
      </ul>

      <div class="warning">
        <h3>Common Mistake</h3>
        <p>Rice's theorem says nothing about properties of the <em>machine</em>. "Does M have 100 states?" is about the machine's structure, not about L(M). That IS decidable &mdash; just look at the encoding!</p>
      </div>
    </div>
  </div>

  <div class="slide-number">17 / 21</div>
</div>

<!-- ============================================================ -->
<!-- SLIDE 18: The Hierarchy of Problems -->
<!-- ============================================================ -->
<div class="slide" id="s18">
  <h1>The Hierarchy of Problems</h1>
  <p class="subtitle">Not all unsolvable problems are equally unsolvable.</p>

  <div class="utm-panel">
    <svg id="utm_hier_svg" viewBox="0 0 600 280" style="width:100%;max-width:600px;display:block;margin:0 auto;">
      <!-- ALL LANGUAGES -->
      <rect x="10" y="10" width="580" height="260" rx="14" fill="rgba(71,85,105,0.15)" stroke="#475569" stroke-width="2"/>
      <text x="300" y="32" text-anchor="middle" fill="#94a3b8" font-size="12" font-weight="600">ALL LANGUAGES</text>
      <!-- co-RE -->
      <rect x="40" y="42" width="520" height="200" rx="12" fill="rgba(245,158,11,0.05)" stroke="#f59e0b" stroke-width="1.5"/>
      <text x="530" y="58" text-anchor="end" fill="#f59e0b" font-size="11" font-weight="600">co-RE</text>
      <!-- RE -->
      <rect x="70" y="68" width="420" height="150" rx="10" fill="rgba(59,130,246,0.05)" stroke="#3b82f6" stroke-width="1.5"/>
      <text x="460" y="84" text-anchor="end" fill="#3b82f6" font-size="11" font-weight="600">RE</text>
      <!-- Decidable -->
      <rect x="110" y="96" width="300" height="90" rx="8" fill="rgba(16,185,129,0.08)" stroke="#10b981" stroke-width="1.5"/>
      <text x="260" y="116" text-anchor="middle" fill="#10b981" font-size="12" font-weight="600">DECIDABLE</text>
      <!-- Dot placeholder -->
      <circle id="utm_hier_dot" cx="0" cy="0" r="6" fill="#3b82f6" opacity="0"/>
      <text id="utm_hier_dotlabel" x="0" y="0" text-anchor="middle" fill="#e2e8f0" font-size="10" font-weight="600" opacity="0"></text>
    </svg>
    <div style="text-align:center;margin:6px 0;">
      <span class="utm_hier_btn" onclick="utm_hier_place(0)">a<sup>n</sup>b<sup>n</sup></span>
      <span class="utm_hier_btn" onclick="utm_hier_place(1)">All CFLs</span>
      <span class="utm_hier_btn" onclick="utm_hier_place(2)">HALT</span>
      <span class="utm_hier_btn" onclick="utm_hier_place(3)">Compl. of HALT</span>
      <span class="utm_hier_btn" onclick="utm_hier_place(4)">L<sub>d</sub></span>
      <span class="utm_hier_btn" onclick="utm_hier_place(5)">{ww}</span>
      <span class="utm_hier_btn" onclick="utm_hier_place(6)">E<sub>TM</sub></span>
      <span class="utm_hier_btn" onclick="utm_hier_place(7)">EQ<sub>TM</sub></span>
    </div>
    <div class="utm-status" id="utm_hier_status" style="text-align:center;">Click a language to place it in the hierarchy</div>
  </div>

  <div class="key-idea">
    <h3>Key Insight</h3>
    <p>A language is <strong>decidable</strong> iff it is both RE and co-RE. The decidable languages sit at the intersection. HALT is RE (we can simulate and say yes if it halts) but not co-RE (we can't detect non-halting). L<sub>d</sub> is neither RE nor co-RE.</p>
  </div>

  <div class="slide-number">18 / 21</div>
</div>

<!-- ============================================================ -->
<!-- SLIDE 19: Post's Correspondence Problem -->
<!-- ============================================================ -->
<div class="slide" id="s19">
  <h1>Post's Correspondence Problem</h1>
  <p class="subtitle">A surprisingly simple-looking problem that is undecidable.</p>

  <div class="two-col">
    <div>
      <h3>The Problem</h3>
      <p>Click dominoes to build a sequence. Do the top and bottom strings match?</p>
      <div style="display:flex;gap:6px;margin:8px 0;flex-wrap:wrap;">
        <div class="utm_pcp_domino" onclick="utm_pcp_add(0)"><div class="top">b</div><div class="bot">ca</div></div>
        <div class="utm_pcp_domino" onclick="utm_pcp_add(1)"><div class="top">a</div><div class="bot">ab</div></div>
        <div class="utm_pcp_domino" onclick="utm_pcp_add(2)"><div class="top">ca</div><div class="bot">a</div></div>
        <div class="utm_pcp_domino" onclick="utm_pcp_add(3)"><div class="top">abc</div><div class="bot">c</div></div>
      </div>
      <div style="font-size:0.85em;color:#64748b;margin-bottom:4px;">Your sequence:</div>
      <div class="utm_pcp_seq" id="utm_pcp_seq"></div>
      <div id="utm_pcp_top" style="font-family:monospace;font-size:0.95em;color:#93c5fd;margin:2px 0;"></div>
      <div id="utm_pcp_bot" style="font-family:monospace;font-size:0.95em;color:#f59e0b;margin:2px 0;"></div>
      <div id="utm_pcp_result" class="utm-status" style="font-weight:600;"></div>
      <div class="utm-controls">
        <button onclick="utm_pcp_clear()">Clear</button>
        <button onclick="utm_pcp_tryHint()">Try: 2, 3, 2, 4</button>
      </div>
      <div id="utm_pcp_msg" style="font-size:0.85em;color:#64748b;margin-top:4px;"></div>
    </div>
    <div>
      <h3>Why It Matters</h3>
      <ul>
        <li>PCP looks nothing like the Halting Problem</li>
        <li>Yet it is <strong>undecidable</strong> (proven by reduction from HALT)</li>
        <li>It is used as an <strong>intermediate step</strong> to prove many other problems undecidable</li>
        <li>Shows undecidability isn't limited to questions about TMs &mdash; it appears in "ordinary" combinatorial problems too</li>
      </ul>

      <div class="diagram small">
  Reduction chain:

  HALT -----> PCP -----> CFG ambiguity
                  \----> other problems

  PCP is a useful "bridge" between
  TM problems and grammar/language
  problems.
      </div>

      <div class="key-idea">
        <h3>Key Idea</h3>
        <p>Undecidability is <strong>everywhere</strong>. It's not just about Turing machines &mdash; it infects combinatorics, logic, algebra, and even simple-looking puzzle problems.</p>
      </div>
    </div>
  </div>

  <div class="slide-number">19 / 21</div>
</div>

<!-- ============================================================ -->
<!-- SLIDE 20: Summary & Cheat Sheet -->
<!-- ============================================================ -->
<div class="slide" id="s20">
  <h1>Summary &amp; Cheat Sheet</h1>
  <p class="subtitle">Everything you need to know, on one slide.</p>

  <div class="two-col">
    <div>
      <h3>Big Results</h3>
      <table style="font-size:0.95em;">
        <tr><th>Concept</th><th>Key Point</th></tr>
        <tr><td style="text-align:left;">TM Encoding</td><td style="text-align:left;">Every TM is a finite binary string</td></tr>
        <tr><td style="text-align:left;">UTM</td><td style="text-align:left;">One TM simulates all others (= interpreter)</td></tr>
        <tr><td style="text-align:left;">Counting</td><td style="text-align:left;">Countable TMs vs uncountable languages</td></tr>
        <tr><td style="text-align:left;">L<sub>d</sub></td><td style="text-align:left;">Diag. language, not even RE</td></tr>
        <tr><td style="text-align:left;">HALT</td><td style="text-align:left;">RE but not decidable</td></tr>
        <tr><td style="text-align:left;">Reductions</td><td style="text-align:left;">Prove B undecidable via A &le; B</td></tr>
        <tr><td style="text-align:left;">Rice's Thm</td><td style="text-align:left;">All non-trivial properties of L(M) undecidable</td></tr>
        <tr><td style="text-align:left;">PCP</td><td style="text-align:left;">Undecidability beyond TM questions</td></tr>
      </table>

      <div class="key-idea mt">
        <h3>The Halting Proof in 4 Lines</h3>
        <p>1. Assume decider H for HALT exists<br>
           2. Build D: run H(&lt;M,&lt;M&gt;&gt;); do opposite<br>
           3. Run D(&lt;D&gt;): contradiction either way<br>
           4. Therefore H cannot exist</p>
      </div>
    </div>
    <div>
      <div class="diagram small">
  PROOF STRATEGY CHEAT SHEET:

  To prove L is undecidable:
  +---------------------------------+
  | 1. "Assume L is decidable"      |
  | 2. Show how to reduce HALT to L |
  |    (use L's decider to solve    |
  |     HALT)                       |
  | 3. "But HALT is undecidable!"   |
  | 4. "Contradiction. L is         |
  |     undecidable."               |
  +---------------------------------+

  Or just use Rice's Theorem:
  +---------------------------------+
  | 1. Is it a property of L(M)?    |
  |    (not the machine itself?)    |
  | 2. Is it non-trivial?           |
  |    (some TMs yes, some TMs no?) |
  | 3. If both YES: UNDECIDABLE.    |
  |    Done. That's it.             |
  +---------------------------------+
      </div>

      <div class="warning">
        <h3>Exam Tip</h3>
        <p>When asked "is X decidable?", first check: is it a non-trivial property of L(M)? If yes, cite Rice's Theorem and you're done. Only do a full reduction proof if Rice's doesn't apply (e.g., the property involves the machine itself, or you need to show it's not RE).</p>
      </div>
    </div>
  </div>

  <div class="slide-number">20 / 21</div>
</div>

<!-- ============================================================ -->
<!-- SLIDE 21: Challenge Quiz -->
<!-- ============================================================ -->
<div class="slide" id="s21">
  <h1>Challenge Quiz</h1>
  <p class="subtitle">Test your understanding of UTMs and undecidability.</p>

  <div id="utm_q1_area">
    <div id="utm_q1_question" style="font-size:1.15em;color:#e2e8f0;margin-bottom:12px;font-weight:600;"></div>
    <div id="utm_q1_opts"></div>
    <div id="utm_q1_feedback" style="margin-top:10px;min-height:40px;"></div>
    <div class="utm-controls" style="margin-top:16px;">
      <button onclick="utm_q1_next()" id="utm_q1_nextBtn" disabled>Next Question</button>
      <button onclick="utm_q1_init()">New Quiz</button>
      <span id="utm_q1_score" style="color:#64748b;font-size:13px;padding:6px 8px;"></span>
    </div>
  </div>

  <div class="slide-number">21 / 21</div>
</div>

<!-- Navigation -->
<div class="nav">
  <button id="prevBtn" onclick="changeSlide(-1)">&larr; Prev</button>
  <button id="nextBtn" onclick="changeSlide(1)">Next &rarr;</button>
</div>

<script>
const totalSlides = 21;
let current = 1;
function showSlide(n) {
  document.querySelectorAll('.slide').forEach(s => s.classList.remove('active'));
  const slide = document.getElementById('s' + n);
  if (slide) { slide.classList.add('active'); slide.classList.add('fade-in'); }
  document.getElementById('prevBtn').disabled = (n === 1);
  document.getElementById('nextBtn').disabled = (n === totalSlides);
  document.getElementById('progress').style.width = ((n / totalSlides) * 100) + '%';
}
function changeSlide(delta) {
  const next = current + delta;
  if (next >= 1 && next <= totalSlides) { current = next; showSlide(current); }
}
document.addEventListener('keydown', (e) => {
  if (e.key === 'ArrowRight' || e.key === 'ArrowDown' || e.key === ' ') { e.preventDefault(); changeSlide(1); }
  else if (e.key === 'ArrowLeft' || e.key === 'ArrowUp') { e.preventDefault(); changeSlide(-1); }
  else if (e.key === 's' || e.key === 'S') {
    const slide = document.getElementById('s' + current);
    const steps = slide.querySelectorAll('.step:not(.revealed)');
    if (steps.length > 0) steps[0].classList.add('revealed');
  }
});
/* ====== Enhancement 1: UTM 3-Tape Step-Through (utm_3t) ====== */
var utm_3t_cur = 0;
var utm_3t_timers = [];
var utm_3t_steps = [
  { tape1:['0','1','1','B','B','B','B','B','B'], head1:0, state:'q0', highlight:-1, msg:'Ready to simulate M on "011"' },
  { tape1:['X','1','1','B','B','B','B','B','B'], head1:1, state:'q0', highlight:0, msg:'Step 1: Read 0, write X, move R' },
  { tape1:['X','Y','1','B','B','B','B','B','B'], head1:2, state:'q0', highlight:1, msg:'Step 2: Read 1, write Y, move R' },
  { tape1:['X','Y','Y','B','B','B','B','B','B'], head1:3, state:'q0', highlight:1, msg:'Step 3: Read 1, write Y, move R' },
  { tape1:['X','Y','Y','B','B','B','B','B','B'], head1:4, state:'q_acc', highlight:2, msg:'Step 4: Read B, M accepts → U accepts!' }
];
var utm_3t_transitions = ['(q0,0)→(q0,X,R)','(q0,1)→(q0,Y,R)','(q0,B)→(q_acc,B,R)'];

function utm_3t_render() {
  var s = utm_3t_steps[utm_3t_cur];
  var svg = document.getElementById('utm_3t_svg');
  // Tape 1
  var t1 = document.getElementById('utm_3t_tape1');
  var h = ''; for (var i=0;i<9;i++) {
    var fill = (i===s.head1) ? 'rgba(59,130,246,0.2)' : '#1e293b';
    var sc = (i===s.head1) ? '#3b82f6' : '#334155';
    h += '<rect x="'+(45+i*65)+'" y="26" width="58" height="30" rx="4" fill="'+fill+'" stroke="'+sc+'" stroke-width="1.5"/>';
    h += '<text x="'+(74+i*65)+'" y="46" text-anchor="middle" fill="#e2e8f0" font-size="14" font-family="monospace">'+s.tape1[i]+'</text>';
  }
  t1.innerHTML = h;
  document.getElementById('utm_3t_head1').setAttribute('transform','translate('+(74+s.head1*65)+',58)');
  // Tape 2
  var t2 = document.getElementById('utm_3t_tape2');
  h = ''; for (var i=0;i<3;i++) {
    var fill = (i===s.highlight) ? 'rgba(245,158,11,0.25)' : '#1e293b';
    var sc = (i===s.highlight) ? '#f59e0b' : '#334155';
    h += '<rect x="'+(45+i*195)+'" y="92" width="185" height="28" rx="4" fill="'+fill+'" stroke="'+sc+'" stroke-width="1.5"/>';
    h += '<text x="'+(137+i*195)+'" y="111" text-anchor="middle" fill="#f59e0b" font-size="11" font-family="monospace">'+utm_3t_transitions[i]+'</text>';
  }
  t2.innerHTML = h;
  // Tape 3
  var t3 = document.getElementById('utm_3t_tape3');
  var stColor = (s.state==='q_acc') ? '#10b981' : '#e2e8f0';
  t3.innerHTML = '<rect x="45" y="160" width="80" height="28" rx="4" fill="#1e293b" stroke="#334155" stroke-width="1.5"/><text x="85" y="179" text-anchor="middle" fill="'+stColor+'" font-size="14" font-family="monospace" font-weight="600">'+s.state+'</text>';
  document.getElementById('utm_3t_counter').textContent = 'Step '+utm_3t_cur+' / 4';
  document.getElementById('utm_3t_status').textContent = s.msg;
  if (s.state==='q_acc') document.getElementById('utm_3t_status').style.color='#10b981';
  else document.getElementById('utm_3t_status').style.color='#94a3b8';
}
function utm_3t_step() { if (utm_3t_cur < 4) { utm_3t_cur++; utm_3t_render(); } }
function utm_3t_auto() { utm_3t_reset(); var i=1; function go(){ if(i<=4){utm_3t_cur=i;utm_3t_render();i++;utm_3t_timers.push(setTimeout(go,900));} } utm_3t_timers.push(setTimeout(go,500)); }
function utm_3t_reset() { utm_3t_timers.forEach(clearTimeout); utm_3t_timers=[]; utm_3t_cur=0; utm_3t_render(); }
utm_3t_render();

/* ====== Enhancement 2: Diagonal Table Explorer (utm_cnt) ====== */
var utm_cnt_tmCount = 20;
var utm_cnt_langs = [];
var utm_cnt_numStrings = 8;

function utm_cnt_initTMs() {
  var el = document.getElementById('utm_cnt_tms');
  var h = '';
  for (var i=1;i<=utm_cnt_tmCount;i++) h += '<div style="color:#a5f3fc;">TM #'+i+': '+utm_cnt_randBin()+'</div>';
  el.innerHTML = h;
  document.getElementById('utm_cnt_tm_count').textContent = utm_cnt_tmCount+' TMs listed';
}
function utm_cnt_randBin() { var s=''; for(var i=0;i<12;i++) s+=Math.random()<0.5?'0':'1'; return s; }
function utm_cnt_addTMs() { utm_cnt_tmCount += 10; utm_cnt_initTMs(); }
function utm_cnt_addLang() {
  var row = []; for(var i=0;i<utm_cnt_numStrings;i++) row.push(Math.random()<0.5?1:0);
  utm_cnt_langs.push(row);
  utm_cnt_renderLangs();
  if(utm_cnt_langs.length>=5) document.getElementById('utm_cnt_diagBtn').style.display='inline-block';
}
function utm_cnt_renderLangs() {
  var el = document.getElementById('utm_cnt_langs');
  var h = '';
  for(var i=0;i<utm_cnt_langs.length;i++){
    h += '<div style="color:#fbbf24;">L'+(i+1)+': ';
    for(var j=0;j<utm_cnt_numStrings;j++){
      var cl = (utm_cnt_langs[i]._diag && j===i) ? 'color:#f59e0b;font-weight:bold;' : '';
      if(utm_cnt_langs[i]._flip && j===i) cl = 'color:#10b981;font-weight:bold;';
      h += '<span style="'+cl+'">'+(utm_cnt_langs[i][j]?'IN':'OUT')+'</span> ';
    }
    h += '</div>';
  }
  el.innerHTML = h;
}
function utm_cnt_diagonalize() {
  var n = Math.min(utm_cnt_langs.length, utm_cnt_numStrings);
  // Highlight diagonal
  for(var i=0;i<n;i++) utm_cnt_langs[i]._diag = true;
  utm_cnt_renderLangs();
  // Build flipped row
  var newRow = [];
  for(var i=0;i<utm_cnt_numStrings;i++){
    if(i<n) newRow.push(utm_cnt_langs[i][i]?0:1);
    else newRow.push(Math.random()<0.5?1:0);
  }
  newRow._flip = true;
  setTimeout(function(){
    utm_cnt_langs.push(newRow);
    utm_cnt_renderLangs();
    document.getElementById('utm_cnt_result').innerHTML = '<span style="color:#10b981;font-weight:600;">Diagonalized!</span> The new language differs from every existing row at the diagonal position. This language is NOT in the original list — proving the list is incomplete!';
  }, 800);
}
utm_cnt_initTMs();

/* ====== Enhancement 3: Interactive Diagonal Builder for L_d (utm_diag) ====== */
var utm_diag_grid = [];
var utm_diag_filled = false;
var utm_diag_phase = 0; // 0=fill, 1=diagonal shown, 2=Ld built
var utm_diag_timers = [];

function utm_diag_init() {
  utm_diag_grid = [];
  for(var i=0;i<6;i++){var row=[];for(var j=0;j<6;j++) row.push(-1);utm_diag_grid.push(row);}
  utm_diag_phase=0;
  utm_diag_filled=false;
  document.getElementById('utm_diag_showBtn').disabled=true;
  document.getElementById('utm_diag_buildBtn').disabled=true;
  document.getElementById('utm_diag_proveBtn').disabled=true;
  document.getElementById('utm_diag_output').innerHTML='';
  utm_diag_timers.forEach(clearTimeout); utm_diag_timers=[];
  utm_diag_render();
}
function utm_diag_render() {
  var el = document.getElementById('utm_diag_grid');
  var h = '';
  for(var i=0;i<6;i++){
    h += '<div style="display:flex;align-items:center;">';
    h += '<div class="utm_diag_header" style="color:#f59e0b;">M'+(i+1)+'</div>';
    for(var j=0;j<6;j++){
      var v = utm_diag_grid[i][j];
      var txt = v===-1?'?':v.toString();
      var cls = 'utm_diag_cell';
      if(utm_diag_phase>=1 && i===j) cls += ' diagonal';
      if(utm_diag_grid[i][j]!==-1 && utm_diag_grid[i][j]._pulse) cls += ' diagonal-pulse';
      h += '<div class="'+cls+'" data-i="'+i+'" data-j="'+j+'" onclick="utm_diag_toggle('+i+','+j+')" style="'+(v===-1?'color:#475569;':'')+'">';
      h += txt+'</div>';
    }
    h += '</div>';
  }
  el.innerHTML = h;
  // Check if all filled
  var all=true;
  for(var i=0;i<6;i++) for(var j=0;j<6;j++) if(utm_diag_grid[i][j]===-1) all=false;
  if(all && !utm_diag_filled){utm_diag_filled=true; document.getElementById('utm_diag_showBtn').disabled=false;}
}
function utm_diag_toggle(i,j) {
  if(utm_diag_phase>0) return;
  var v = utm_diag_grid[i][j];
  utm_diag_grid[i][j] = v===-1?0:(v===0?1:-1);
  utm_diag_render();
}
function utm_diag_randomFill() {
  if(utm_diag_phase>0) return;
  for(var i=0;i<6;i++) for(var j=0;j<6;j++) utm_diag_grid[i][j]=Math.random()<0.5?0:1;
  utm_diag_filled=true;
  document.getElementById('utm_diag_showBtn').disabled=false;
  utm_diag_render();
}
function utm_diag_showDiag() {
  if(utm_diag_phase!==0) return;
  utm_diag_phase=1;
  document.getElementById('utm_diag_buildBtn').disabled=false;
  // Add pulse class to diagonal cells
  var cells = document.querySelectorAll('#utm_diag_grid .utm_diag_cell');
  cells.forEach(function(c){
    var i=parseInt(c.dataset.i), j=parseInt(c.dataset.j);
    if(i===j) c.classList.add('diagonal-pulse');
  });
  var diag=''; for(var i=0;i<6;i++) diag+=utm_diag_grid[i][i];
  document.getElementById('utm_diag_output').innerHTML='<p style="color:#f59e0b;">Diagonal: <strong>'+diag+'</strong></p>';
}
function utm_diag_buildLd() {
  if(utm_diag_phase!==1) return;
  utm_diag_phase=2;
  document.getElementById('utm_diag_proveBtn').disabled=false;
  var diag='',flip='',members=[];
  for(var i=0;i<6;i++){
    var d=utm_diag_grid[i][i];
    diag+=d;
    var f=d?0:1;
    flip+=f;
    if(f===1) members.push('w'+(i+1));
  }
  var out='<p style="color:#f59e0b;">Diagonal: <strong>'+diag+'</strong></p>';
  out+='<p style="margin:4px 0;color:#94a3b8;">          ↓ flip each bit ↓</p>';
  out+='<p style="color:#10b981;">Flipped:&nbsp; <strong>'+flip+'</strong></p>';
  out+='<p style="margin-top:8px;color:#e2e8f0;">L<sub>d</sub> = { w<sub>i</sub> | M<sub>i</sub> does NOT accept w<sub>i</sub> }</p>';
  if(members.length>0) out+='<p style="color:#10b981;">L<sub>d</sub> contains: {'+members.join(', ')+'}</p>';
  else out+='<p style="color:#10b981;">L<sub>d</sub> = empty set for this table</p>';
  document.getElementById('utm_diag_output').innerHTML=out;
  utm_diag_render();
}
function utm_diag_prove() {
  if(utm_diag_phase!==2) return;
  var flip=[]; for(var i=0;i<6;i++) flip.push(utm_diag_grid[i][i]?0:1);
  var out = document.getElementById('utm_diag_output').innerHTML;
  out += '<div style="margin-top:10px;border-top:1px solid #334155;padding-top:8px;">';
  for(var i=0;i<6;i++){
    var differs = utm_diag_grid[i][i]!==flip[i] ? 'always' : 'never';
    out += '<p style="font-size:0.9em;color:#94a3b8;">Row M'+(i+1)+': diagonal cell=('+utm_diag_grid[i][i]+'), L<sub>d</sub> has ('+flip[i]+') — <span style="color:#f59e0b;font-weight:600;">differs!</span></p>';
  }
  out += '<p style="margin-top:6px;color:#ef4444;font-weight:600;">L<sub>d</sub> differs from EVERY row. No TM recognizes L<sub>d</sub>!</p>';
  out += '</div>';
  document.getElementById('utm_diag_output').innerHTML=out;
  // Flash diagonal cells
  var cells = document.querySelectorAll('#utm_diag_grid .utm_diag_cell');
  var idx=0;
  function flashRow(){
    if(idx>=6) return;
    cells.forEach(function(c){
      var ci=parseInt(c.dataset.i),cj=parseInt(c.dataset.j);
      if(ci===idx && cj===idx) c.classList.add('differ-flash');
    });
    idx++;
    utm_diag_timers.push(setTimeout(flashRow,400));
  }
  flashRow();
}
utm_diag_init();

/* ====== Enhancement 4: Halting Proof Animator (utm_hp) ====== */
var utm_hp_cur = 0;
var utm_hp_timers = [];
var utm_hp_steps = [
  { msg:'Assume H exists: a decider for HALT' },
  { msg:'H takes ⟨M, w⟩ and always outputs accept/reject' },
  { msg:'Build D using H as subroutine' },
  { msg:'D(⟨M⟩): runs H(⟨M, ⟨M⟩⟩), then does the OPPOSITE' }
];

function utm_hp_render() {
  var c = utm_hp_cur;
  var svg = document.getElementById('utm_hp_svg');
  // Step 0+: H box glows
  var hbox = document.getElementById('utm_hp_hbox');
  var hl = document.getElementById('utm_hp_hlabel');
  hbox.setAttribute('opacity', c>=0?'1':'0.3');
  hl.setAttribute('opacity', c>=0?'1':'0.3');
  if(c>=0) hbox.setAttribute('stroke','#3b82f6');
  // Step 1: arrows in/out of H
  var show1 = c>=1?'1':'0';
  document.getElementById('utm_hp_arrin').setAttribute('opacity',show1);
  document.getElementById('utm_hp_inlabel').setAttribute('opacity',show1);
  document.getElementById('utm_hp_accout').setAttribute('opacity',show1);
  document.getElementById('utm_hp_acclabel').setAttribute('opacity',show1);
  document.getElementById('utm_hp_rejout').setAttribute('opacity',show1);
  document.getElementById('utm_hp_rejlabel').setAttribute('opacity',show1);
  // Step 2: D box appears
  var show2 = c>=2?'1':'0';
  document.getElementById('utm_hp_dbox').setAttribute('opacity',show2);
  document.getElementById('utm_hp_dlabel').setAttribute('opacity',show2);
  document.getElementById('utm_hp_hsmall').setAttribute('opacity',show2);
  document.getElementById('utm_hp_hsmlabel').setAttribute('opacity',show2);
  // Step 3: D outputs with flip
  var show3 = c>=3?'1':'0';
  document.getElementById('utm_hp_dout1').setAttribute('opacity',show3);
  document.getElementById('utm_hp_dout2').setAttribute('opacity',show3);

  document.getElementById('utm_hp_counter').textContent = 'Step '+c+' / 3';
  document.getElementById('utm_hp_status').textContent = utm_hp_steps[c].msg;
}
function utm_hp_step() { if(utm_hp_cur<3){utm_hp_cur++;utm_hp_render();} }
function utm_hp_auto() { utm_hp_reset(); var i=1; function go(){if(i<=3){utm_hp_cur=i;utm_hp_render();i++;utm_hp_timers.push(setTimeout(go,1200));}} utm_hp_timers.push(setTimeout(go,600)); }
function utm_hp_reset() { utm_hp_timers.forEach(clearTimeout);utm_hp_timers=[];utm_hp_cur=0;utm_hp_render(); }
utm_hp_render();

/* ====== Enhancement 5: Paradox Flow Animator (utm_par) ====== */
var utm_par_timers = [];
var utm_par_caseA = [
  {html:'<p style="color:#10b981;">1. Suppose D halts on ⟨D⟩</p>', delay:0},
  {html:'<p style="color:#10b981;">2. → H(⟨D, ⟨D⟩⟩) says "accept"</p>', delay:700},
  {html:'<p style="color:#f59e0b;">3. → D enters infinite loop <span style="display:inline-block;animation:utm_spin 1s linear infinite;">↻</span></p>', delay:1400},
  {html:'<p style="color:#ef4444;font-weight:700;font-size:1.1em;">4. → D does NOT halt on ⟨D⟩ — CONTRADICTION!</p>', delay:2100}
];
var utm_par_caseB = [
  {html:'<p style="color:#ef4444;">1. Suppose D does NOT halt on ⟨D⟩</p>', delay:0},
  {html:'<p style="color:#ef4444;">2. → H(⟨D, ⟨D⟩⟩) says "reject"</p>', delay:700},
  {html:'<p style="color:#10b981;">3. → D halts and accepts ✓</p>', delay:1400},
  {html:'<p style="color:#ef4444;font-weight:700;font-size:1.1em;">4. → D DOES halt on ⟨D⟩ — CONTRADICTION!</p>', delay:2100}
];

function utm_par_run(c) {
  utm_par_reset();
  var steps = c==='A' ? utm_par_caseA : utm_par_caseB;
  var el = document.getElementById('utm_par_steps');
  steps.forEach(function(st){
    utm_par_timers.push(setTimeout(function(){ el.innerHTML += st.html; }, st.delay));
  });
  utm_par_timers.push(setTimeout(function(){
    document.getElementById('utm_par_conclusion').innerHTML = '<span style="color:#ef4444;">∴ H cannot exist. HALT is undecidable.</span>';
  }, 2800));
}
function utm_par_reset() {
  utm_par_timers.forEach(clearTimeout); utm_par_timers=[];
  document.getElementById('utm_par_steps').innerHTML='';
  document.getElementById('utm_par_conclusion').innerHTML='';
}

/* ====== Enhancement 6: Reduction Flow Explorer (utm_red) ====== */
var utm_red_examples = [
  {label1:'E_TM', label2:'"Is L(M)', label3:'empty?"', desc:'E_TM: "Is L(M) empty?" Build M\' that accepts everything iff M halts on w.'},
  {label1:'EQ_TM', label2:'"Is L(M₁)', label3:'= L(M₂)?"', desc:'EQ_TM: "Is L(M₁) = L(M₂)?" Compare M with a TM that accepts nothing.'},
  {label1:'ALL_TM', label2:'"Is L(M)', label3:'= Σ*?"', desc:'ALL_TM: "Is L(M) = Σ*?" Build M\' that accepts all strings iff M halts on w.'}
];

function utm_red_select(idx) {
  var e = utm_red_examples[idx];
  document.getElementById('utm_red_blabel').textContent = e.label2;
  document.getElementById('utm_red_blabel2').textContent = e.label3;
  document.getElementById('utm_red_desc').textContent = e.desc;
  for(var i=0;i<3;i++){
    var b = document.getElementById('utm_red_b'+i);
    b.classList.toggle('active', i===idx);
  }
}

/* ====== Enhancement 7: Rice's Theorem Checker (utm_rice) ====== */
var utm_rice_data = [
  { name:'Is L(M) empty?', propLM:true, nontrivial:true },
  { name:'Is L(M) finite?', propLM:true, nontrivial:true },
  { name:'Does M have exactly 5 states?', propLM:false, nontrivial:false },
  { name:'Is L(M) = {0ⁿ1ⁿ}?', propLM:true, nontrivial:true },
  { name:'Does M ever move left?', propLM:false, nontrivial:false },
  { name:'Is L(M) context-free?', propLM:true, nontrivial:true }
];
var utm_rice_timers = [];

function utm_rice_check(idx) {
  utm_rice_timers.forEach(clearTimeout); utm_rice_timers=[];
  var d = utm_rice_data[idx];
  var el = document.getElementById('utm_rice_result');
  el.innerHTML = '';
  var lines = [];
  // Step 1
  if(d.propLM) {
    lines.push('<div class="utm_rice_check"><span class="done">✓</span> Property of L(M)? <strong style="color:#10b981;">Yes</strong></div>');
  } else {
    lines.push('<div class="utm_rice_check"><span class="fail">✗</span> Property of L(M)? <strong style="color:#ef4444;">No — property of M itself</strong></div>');
  }
  // Step 2
  if(d.propLM){
    lines.push('<div class="utm_rice_check"><span class="done">✓</span> Non-trivial? <strong style="color:#10b981;">Yes</strong></div>');
  } else {
    lines.push('<div class="utm_rice_check" style="color:#64748b;">— Non-trivial? N/A (Rice\'s doesn\'t apply)</div>');
  }
  // Step 3
  if(d.propLM && d.nontrivial){
    lines.push('<div style="margin-top:6px;"><span class="utm-badge red">UNDECIDABLE by Rice\'s Theorem</span></div>');
  } else {
    lines.push('<div style="margin-top:6px;"><span class="utm-badge green">DECIDABLE — Rice\'s doesn\'t apply</span></div>');
  }
  // Animate
  lines.forEach(function(l,i){
    utm_rice_timers.push(setTimeout(function(){ el.innerHTML += l; }, i*500));
  });
}

/* ====== Enhancement 8: Interactive Problem Hierarchy (utm_hier) ====== */
var utm_hier_data = [
  { name:'aⁿbⁿ', x:180, y:145, color:'#10b981', desc:'Decidable: a CFL, so decidable.' },
  { name:'All CFLs', x:300, y:155, color:'#10b981', desc:'Decidable: every CFL is decidable.' },
  { name:'HALT', x:200, y:198, color:'#3b82f6', desc:'RE but NOT decidable. We can say "yes" if it halts, but may loop forever on "no".' },
  { name:'Compl(HALT)', x:480, y:175, color:'#f59e0b', desc:'co-RE but NOT RE. If it were RE, HALT would be decidable.' },
  { name:'Ld', x:490, y:255, color:'#94a3b8', desc:'Not RE and not co-RE — completely beyond TM power.' },
  { name:'{ww}', x:350, y:135, color:'#10b981', desc:'Decidable: can be decided by a 2-tape TM.' },
  { name:'E_TM', x:380, y:200, color:'#3b82f6', desc:'RE but not decidable. We can enumerate strings M accepts, but cannot detect emptiness.' },
  { name:'EQ_TM', x:200, y:255, color:'#94a3b8', desc:'Not RE and not co-RE. Even harder than HALT.' }
];

function utm_hier_place(idx) {
  var d = utm_hier_data[idx];
  var dot = document.getElementById('utm_hier_dot');
  var label = document.getElementById('utm_hier_dotlabel');
  dot.setAttribute('cx', d.x); dot.setAttribute('cy', d.y);
  dot.setAttribute('fill', d.color); dot.setAttribute('opacity','1');
  label.setAttribute('x', d.x); label.setAttribute('y', d.y - 12);
  label.textContent = d.name; label.setAttribute('opacity','1');
  label.setAttribute('fill', d.color);
  document.getElementById('utm_hier_status').innerHTML = '<span style="color:'+d.color+';font-weight:600;">'+d.name+'</span>: '+d.desc;
  // Highlight button
  var btns = document.querySelectorAll('.utm_hier_btn');
  btns.forEach(function(b,i){ b.classList.toggle('selected', i===idx); });
}

/* ====== Enhancement 9: PCP Domino Playground (utm_pcp) ====== */
var utm_pcp_dominoes = [{t:'b',b:'ca'},{t:'a',b:'ab'},{t:'ca',b:'a'},{t:'abc',b:'c'}];
var utm_pcp_sequence = [];
var utm_pcp_attempts = 0;

function utm_pcp_add(idx) {
  utm_pcp_sequence.push(idx);
  utm_pcp_attempts++;
  utm_pcp_render();
}
function utm_pcp_render() {
  var seqEl = document.getElementById('utm_pcp_seq');
  var h = '';
  utm_pcp_sequence.forEach(function(idx,i){
    var d = utm_pcp_dominoes[idx];
    h += '<div class="utm_pcp_domino" onclick="utm_pcp_remove('+i+')" style="cursor:pointer;"><div class="top">'+d.t+'</div><div class="bot">'+d.b+'</div></div>';
  });
  seqEl.innerHTML = h || '<span style="color:#475569;font-size:0.9em;">Click dominoes above to add...</span>';

  if(utm_pcp_sequence.length===0){
    document.getElementById('utm_pcp_top').textContent='';
    document.getElementById('utm_pcp_bot').textContent='';
    document.getElementById('utm_pcp_result').innerHTML='';
    return;
  }
  var top='',bot='';
  utm_pcp_sequence.forEach(function(idx){top+=utm_pcp_dominoes[idx].t;bot+=utm_pcp_dominoes[idx].b;});
  document.getElementById('utm_pcp_top').textContent='Top:    "'+top+'"';
  document.getElementById('utm_pcp_bot').textContent='Bottom: "'+bot+'"';

  if(top===bot){
    document.getElementById('utm_pcp_result').innerHTML='<span style="color:#10b981;">MATCH FOUND!</span>';
  } else {
    // Find first difference
    var diffPos = 0;
    while(diffPos < top.length && diffPos < bot.length && top[diffPos]===bot[diffPos]) diffPos++;
    document.getElementById('utm_pcp_result').innerHTML='<span style="color:#ef4444;">No match yet</span> <span style="color:#64748b;">(differs at position '+(diffPos+1)+')</span>';
  }

  if(utm_pcp_attempts >= 6){
    document.getElementById('utm_pcp_msg').innerHTML='For this particular domino set, no solution exists — but proving that <em>in general</em> is undecidable!';
  }
}
function utm_pcp_remove(i) { utm_pcp_sequence.splice(i,1); utm_pcp_render(); }
function utm_pcp_clear() { utm_pcp_sequence=[]; utm_pcp_render(); document.getElementById('utm_pcp_msg').innerHTML=''; }
function utm_pcp_tryHint() { utm_pcp_sequence=[1,2,1,3]; utm_pcp_attempts+=4; utm_pcp_render(); }
utm_pcp_render();

/* ====== Enhancement 10: Challenge Quiz (utm_q1) ====== */
var utm_q1_pool = [
  { q:'The UTM takes two inputs: ⟨M⟩ and w. What does it do?',
    opts:['Determines if M halts','Simulates M running on w','Compiles M into binary','Counts M\'s states'],
    correct:1, explain:'The UTM is a universal interpreter — it reads M\'s code and executes it on input w.' },
  { q:'True or False: There are more Turing machines than languages.',
    opts:['True','False'],
    correct:1, explain:'There are countably many TMs but uncountably many languages. Most languages have no TM.' },
  { q:'Why is L_d not RE?',
    opts:['It contains too many strings','Any TM that tried to recognize it would contradict itself on its own index','No TM can enumerate its strings','It is empty'],
    correct:1, explain:'If M_j recognizes L_d, then asking whether w_j ∈ L_d leads to contradiction.' },
  { q:'In the halting proof, what does machine D do?',
    opts:['It decides HALT directly','It simulates all TMs in parallel','It runs H(⟨M, ⟨M⟩⟩) and does the opposite','It loops on every input'],
    correct:2, explain:'D loops when H says halt, and halts when H says loop — creating the contradiction.' },
  { q:'By Rice\'s Theorem, is "Does L(M) contain the empty string?" decidable?',
    opts:['Yes','No'],
    correct:1, explain:'It\'s a non-trivial property of L(M), so Rice\'s Theorem says undecidable.' },
  { q:'HALT is RE but not decidable. What about the complement of HALT?',
    opts:['Also RE','Decidable','co-RE but not RE','Not RE and not co-RE'],
    correct:2, explain:'If complement of HALT were RE, then HALT would be decidable (RE ∩ co-RE = decidable). But it\'s not.' }
];
var utm_q1_selected = [];
var utm_q1_idx = 0;
var utm_q1_score = 0;
var utm_q1_answered = false;

function utm_q1_init() {
  // Pick 3 random from pool
  var indices = []; for(var i=0;i<utm_q1_pool.length;i++) indices.push(i);
  for(var i=indices.length-1;i>0;i--){var j=Math.floor(Math.random()*(i+1));var t=indices[i];indices[i]=indices[j];indices[j]=t;}
  utm_q1_selected = indices.slice(0,3);
  utm_q1_idx=0; utm_q1_score=0; utm_q1_answered=false;
  document.getElementById('utm_q1_nextBtn').disabled=true;
  utm_q1_showQuestion();
}
function utm_q1_showQuestion() {
  if(utm_q1_idx >= utm_q1_selected.length){
    document.getElementById('utm_q1_question').textContent='Quiz Complete!';
    document.getElementById('utm_q1_opts').innerHTML='';
    document.getElementById('utm_q1_feedback').innerHTML='<p style="color:#10b981;font-size:1.1em;font-weight:600;">Score: '+utm_q1_score+' / '+utm_q1_selected.length+'</p>';
    document.getElementById('utm_q1_nextBtn').disabled=true;
    return;
  }
  var qd = utm_q1_pool[utm_q1_selected[utm_q1_idx]];
  document.getElementById('utm_q1_question').textContent = 'Q'+(utm_q1_idx+1)+': '+qd.q;
  var h='';
  qd.opts.forEach(function(o,i){ h+='<div class="utm_q1_opt" onclick="utm_q1_answer('+i+')">'+o+'</div>'; });
  document.getElementById('utm_q1_opts').innerHTML=h;
  document.getElementById('utm_q1_feedback').innerHTML='';
  document.getElementById('utm_q1_score').textContent = 'Score: '+utm_q1_score+' / '+utm_q1_selected.length;
  document.getElementById('utm_q1_nextBtn').disabled=true;
  utm_q1_answered=false;
}
function utm_q1_answer(idx) {
  if(utm_q1_answered) return;
  utm_q1_answered=true;
  var qd = utm_q1_pool[utm_q1_selected[utm_q1_idx]];
  var opts = document.querySelectorAll('#utm_q1_opts .utm_q1_opt');
  opts.forEach(function(o,i){
    if(i===qd.correct) o.classList.add('correct');
    else if(i===idx) o.classList.add('wrong');
    o.style.pointerEvents='none';
  });
  if(idx===qd.correct) utm_q1_score++;
  document.getElementById('utm_q1_feedback').innerHTML='<div class="'+(idx===qd.correct?'key-idea':'warning')+'" style="padding:12px 16px;"><p style="font-size:0.95em;">'+qd.explain+'</p></div>';
  document.getElementById('utm_q1_score').textContent = 'Score: '+utm_q1_score+' / '+utm_q1_selected.length;
  document.getElementById('utm_q1_nextBtn').disabled=false;
}
function utm_q1_next() {
  utm_q1_idx++;
  utm_q1_showQuestion();
}
utm_q1_init();

showSlide(1);
</script>

</body>
</html>
